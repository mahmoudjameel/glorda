{"file_contents":{"client/src/pages/auth/Register.tsx":{"content":"import { useForm, useFieldArray } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from \"@/components/ui/command\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Link, useLocation } from \"wouter\";\nimport { Store, Plus, Trash2, Loader2, ChevronsUpDown, Check, Eye, EyeOff, FileText } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport logoUrl from \"@assets/شعار_غلوردا_1764881546720.jpg\";\nimport { saudiCities } from \"@/constants/saudiCities\";\nimport { cn } from \"@/lib/utils\";\n\nconst formSchema = z.object({\n  ownerName: z.string().min(2, \"اسم المالك مطلوب\"),\n  storeName: z.string().min(3, \"اسم المتجر مطلوب\"),\n  username: z.string().min(3, \"اسم المستخدم مطلوب\").regex(/^[a-zA-Z0-9_]+$/, \"اسم المستخدم يجب أن يحتوي على أحرف إنجليزية وأرقام فقط\"),\n  mobile: z.string().min(9, \"رقم الجوال غير صالح\"),\n  email: z.string().email(\"البريد الإلكتروني غير صالح\"),\n  storeType: z.enum([\"company\", \"institution\", \"individual\"], {\n    required_error: \"يرجى اختيار نوع المتجر\",\n  }),\n  city: z.string().min(2, \"المدينة مطلوبة\"),\n  registrationNumber: z.string().min(1, \"رقم السجل / الوثيقة مطلوب\"),\n  deliveryMethod: z.enum([\"representative\", \"pickup\", \"all\"], {\n    required_error: \"يرجى اختيار طريقة التوصيل\",\n  }),\n  branches: z.array(z.object({\n    name: z.string().min(1, \"اسم الفرع مطلوب\"),\n    mapLink: z.string().url(\"رابط قوقل ماب غير صالح\"),\n  })).optional(),\n  bankName: z.string().min(2, \"اسم البنك مطلوب\"),\n  iban: z.string().min(15, \"رقم الآيبان غير صالح\").max(34, \"رقم الآيبان غير صالح\"),\n  accountHolderName: z.string().min(2, \"اسم صاحب الحساب مطلوب\"),\n  password: z.string().min(6, \"كلمة المرور يجب أن تكون 6 أحرف على الأقل\"),\n  confirmPassword: z.string(),\n  acceptTerms: z.boolean().refine(val => val === true, {\n    message: \"يجب الموافقة على الشروط والأحكام\",\n  }),\n}).refine((data) => data.password === data.confirmPassword, {\n  message: \"كلمات المرور غير متطابقة\",\n  path: [\"confirmPassword\"],\n}).refine((data) => {\n  if (data.deliveryMethod === \"pickup\" || data.deliveryMethod === \"all\") {\n    return data.branches && data.branches.length > 0;\n  }\n  return true;\n}, {\n  message: \"يجب إضافة فرع واحد على الأقل\",\n  path: [\"branches\"],\n});\n\nexport default function Register() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [showPassword, setShowPassword] = useState(false);\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\n  const [showTermsDialog, setShowTermsDialog] = useState(false);\n\n  const { data: termsData } = useQuery({\n    queryKey: [\"/api/public/settings/merchant_terms_conditions\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/public/settings/merchant_terms_conditions\");\n      if (!res.ok) return { value: \"\" };\n      return res.json();\n    },\n    staleTime: 0,\n    refetchOnMount: \"always\"\n  });\n\n  const form = useForm<z.infer<typeof formSchema>>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      ownerName: \"\",\n      storeName: \"\",\n      username: \"\",\n      mobile: \"\",\n      email: \"\",\n      city: \"\",\n      registrationNumber: \"\",\n      branches: [],\n      bankName: \"\",\n      iban: \"\",\n      accountHolderName: \"\",\n      password: \"\",\n      confirmPassword: \"\",\n      acceptTerms: false,\n    },\n  });\n\n  const { fields, append, remove } = useFieldArray({\n    control: form.control,\n    name: \"branches\",\n  });\n\n  const deliveryMethod = form.watch(\"deliveryMethod\");\n\n  async function onSubmit(values: z.infer<typeof formSchema>) {\n    setIsSubmitting(true);\n    \n    try {\n      const { confirmPassword, acceptTerms, ...registerData } = values;\n      \n      const response = await fetch(\"/api/auth/register\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify(registerData),\n      });\n      \n      const data = await response.json();\n      \n      if (!response.ok) {\n        toast({\n          variant: \"destructive\",\n          title: \"خطأ في التسجيل\",\n          description: data.error || \"حدث خطأ ما\",\n        });\n        return;\n      }\n      \n      toast({\n        title: \"تم استلام طلبك بنجاح\",\n        description: \"حسابك قيد المراجعة الآن. سيتم إشعارك عند التفعيل.\",\n      });\n      \n      setLocation(\"/\");\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"خطأ\",\n        description: \"فشل الاتصال بالخادم\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-muted/30 p-4 py-10\" dir=\"rtl\">\n      <div className=\"w-full max-w-3xl space-y-8\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"flex justify-center\">\n            <div className=\"w-24 h-24 rounded-full overflow-hidden border-4 border-white shadow-lg\">\n              <img src={logoUrl} alt=\"Logo\" className=\"w-full h-full object-cover\" data-testid=\"img-logo\" />\n            </div>\n          </div>\n          <h1 className=\"text-3xl font-bold tracking-tight font-display text-primary\">انضم إلى غلوردا</h1>\n          <p className=\"text-muted-foreground\">سجل متجرك وابدأ في بيع منتجاتك لآلاف العملاء</p>\n        </div>\n\n        <Card className=\"border-none shadow-xl overflow-hidden\">\n          <div className=\"h-2 bg-primary w-full\" />\n          <CardHeader>\n            <CardTitle>بيانات المتجر الجديد</CardTitle>\n            <CardDescription>الرجاء تعبئة جميع البيانات بدقة لتسريع عملية التفعيل</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                \n                <div className=\"grid md:grid-cols-2 gap-6\">\n                   <FormField\n                    control={form.control}\n                    name=\"ownerName\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>اسم المالك</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"الاسم الثلاثي\" {...field} data-testid=\"input-owner-name\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"storeName\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>اسم المتجر</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"اسم المتجر التجاري\" {...field} data-testid=\"input-store-name\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"username\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>اسم المستخدم</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"store_name\" {...field} className=\"font-mono text-left\" dir=\"ltr\" data-testid=\"input-username\" />\n                        </FormControl>\n                        <p className=\"text-xs text-muted-foreground\">سيكون رابط متجرك: glorda.com/{field.value || \"username\"}</p>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"mobile\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>رقم الجوال</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"05xxxxxxxx\" {...field} className=\"font-mono text-right\" data-testid=\"input-mobile\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"email\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>البريد الإلكتروني</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"name@example.com\" {...field} className=\"font-mono text-right\" data-testid=\"input-email\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"grid md:grid-cols-2 gap-6\">\n                  <FormField\n                    control={form.control}\n                    name=\"storeType\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>نوع الكيان</FormLabel>\n                        <Select onValueChange={field.onChange} defaultValue={field.value}>\n                          <FormControl>\n                            <SelectTrigger data-testid=\"select-store-type\">\n                              <SelectValue placeholder=\"اختر نوع الكيان\" />\n                            </SelectTrigger>\n                          </FormControl>\n                          <SelectContent dir=\"rtl\">\n                            <SelectItem value=\"individual\">فرد / عمل حر</SelectItem>\n                            <SelectItem value=\"institution\">مؤسسة</SelectItem>\n                            <SelectItem value=\"company\">شركة</SelectItem>\n                          </SelectContent>\n                        </Select>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"registrationNumber\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>رقم السجل / وثيقة العمل الحر</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"70xxxxxxxxx\" {...field} className=\"font-mono text-right\" data-testid=\"input-registration-number\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"city\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-col\">\n                      <FormLabel>المدينة</FormLabel>\n                      <Popover>\n                        <PopoverTrigger asChild>\n                          <FormControl>\n                            <Button\n                              variant=\"outline\"\n                              role=\"combobox\"\n                              className={cn(\n                                \"w-full justify-between\",\n                                !field.value && \"text-muted-foreground\"\n                              )}\n                              data-testid=\"select-city\"\n                            >\n                              {field.value\n                                ? saudiCities.find((city) => city.nameAr === field.value)?.nameAr + \" - \" + saudiCities.find((city) => city.nameAr === field.value)?.nameEn\n                                : \"اختر المدينة\"}\n                              <ChevronsUpDown className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n                            </Button>\n                          </FormControl>\n                        </PopoverTrigger>\n                        <PopoverContent className=\"w-full p-0\" align=\"start\" dir=\"rtl\">\n                          <Command dir=\"rtl\">\n                            <CommandInput placeholder=\"ابحث عن مدينة...\" className=\"text-right\" />\n                            <CommandList>\n                              <CommandEmpty>لم يتم العثور على مدينة</CommandEmpty>\n                              <CommandGroup className=\"max-h-[300px] overflow-y-auto\">\n                                {saudiCities.map((city, index) => (\n                                  <CommandItem\n                                    value={city.nameAr + \" \" + city.nameEn}\n                                    key={`${city.nameAr}-${city.nameEn}-${index}`}\n                                    onSelect={() => {\n                                      field.onChange(city.nameAr);\n                                    }}\n                                  >\n                                    <Check\n                                      className={cn(\n                                        \"ml-2 h-4 w-4\",\n                                        city.nameAr === field.value ? \"opacity-100\" : \"opacity-0\"\n                                      )}\n                                    />\n                                    {city.nameAr} - {city.nameEn}\n                                  </CommandItem>\n                                ))}\n                              </CommandGroup>\n                            </CommandList>\n                          </Command>\n                        </PopoverContent>\n                      </Popover>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"space-y-6\">\n                  <FormField\n                    control={form.control}\n                    name=\"deliveryMethod\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel className=\"text-base\">طريقة التوصيل / الاستلام</FormLabel>\n                        <FormControl>\n                          <RadioGroup\n                            onValueChange={field.onChange}\n                            defaultValue={field.value}\n                            className=\"grid grid-cols-1 md:grid-cols-2 gap-4\"\n                          >\n                            <FormItem>\n                              <FormControl>\n                                <RadioGroupItem value=\"representative\" className=\"peer sr-only\" />\n                              </FormControl>\n                              <FormLabel className=\"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-4 hover:bg-accent hover:text-accent-foreground peer-data-[state=checked]:border-primary [&:has([data-state=checked])]:border-primary cursor-pointer transition-all\" data-testid=\"radio-representative\">\n                                <div className=\"mb-3 rounded-full bg-primary/10 p-2 text-primary\">\n                                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"lucide lucide-truck\"><path d=\"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2\"/><path d=\"M15 18H9\"/><path d=\"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14\"/><circle cx=\"17\" cy=\"18\" r=\"2\"/><circle cx=\"7\" cy=\"18\" r=\"2\"/></svg>\n                                </div>\n                                <div className=\"text-center\">\n                                  <span className=\"block font-semibold text-lg\">مندوب توصيل</span>\n                                  <span className=\"text-xs text-muted-foreground mt-1 block\">توصيل الطلبات للعملاء عبر مندوب المتجر</span>\n                                </div>\n                              </FormLabel>\n                            </FormItem>\n                            <FormItem>\n                              <FormControl>\n                                <RadioGroupItem value=\"pickup\" className=\"peer sr-only\" />\n                              </FormControl>\n                              <FormLabel className=\"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-4 hover:bg-accent hover:text-accent-foreground peer-data-[state=checked]:border-primary [&:has([data-state=checked])]:border-primary cursor-pointer transition-all\" data-testid=\"radio-pickup\">\n                                <div className=\"mb-3 rounded-full bg-primary/10 p-2 text-primary\">\n                                  <Store className=\"w-6 h-6\" />\n                                </div>\n                                <div className=\"text-center\">\n                                  <span className=\"block font-semibold text-lg\">استلام من الفرع</span>\n                                  <span className=\"text-xs text-muted-foreground mt-1 block\">العميل يستلم الطلب من فروعكم</span>\n                                </div>\n                              </FormLabel>\n                            </FormItem>\n                            <FormItem className=\"md:col-span-2\">\n                              <FormControl>\n                                <RadioGroupItem value=\"all\" className=\"peer sr-only\" />\n                              </FormControl>\n                              <FormLabel className=\"flex flex-col items-center justify-between rounded-md border-2 border-muted bg-popover p-4 hover:bg-accent hover:text-accent-foreground peer-data-[state=checked]:border-primary [&:has([data-state=checked])]:border-primary cursor-pointer transition-all\" data-testid=\"radio-all\">\n                                <div className=\"mb-3 rounded-full bg-primary/10 p-2 text-primary\">\n                                  <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"lucide lucide-check-circle-2\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><path d=\"m9 12 2 2 4-4\"/></svg>\n                                </div>\n                                <div className=\"text-center\">\n                                  <span className=\"block font-semibold text-lg\">الكل (توصيل + استلام)</span>\n                                  <span className=\"text-xs text-muted-foreground mt-1 block\">تفعيل جميع خيارات التوصيل والاستلام للعملاء</span>\n                                </div>\n                              </FormLabel>\n                            </FormItem>\n                          </RadioGroup>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  {(deliveryMethod === \"pickup\" || deliveryMethod === \"all\") && (\n                    <div className=\"rounded-lg border border-border bg-card p-6 shadow-sm animate-in fade-in slide-in-from-top-4 duration-300\">\n                      <div className=\"flex items-center justify-between mb-6\">\n                        <div>\n                          <h4 className=\"text-lg font-semibold text-foreground flex items-center gap-2\">\n                            <Store className=\"w-5 h-5 text-primary\" />\n                            الفروع ومواقع الاستلام\n                          </h4>\n                          <p className=\"text-sm text-muted-foreground mt-1\">أضف جميع الفروع التي يمكن للعملاء الاستلام منها</p>\n                        </div>\n                        <Button\n                          type=\"button\"\n                          variant=\"default\"\n                          size=\"sm\"\n                          onClick={() => append({ name: \"\", mapLink: \"\" })}\n                          className=\"gap-2 shadow-sm\"\n                          data-testid=\"button-add-branch\"\n                        >\n                          <Plus className=\"w-4 h-4\" /> إضافة فرع جديد\n                        </Button>\n                      </div>\n                      \n                      {fields.length === 0 ? (\n                        <div className=\"text-center py-12 border-2 border-dashed rounded-lg bg-muted/10\">\n                          <div className=\"w-12 h-12 rounded-full bg-muted flex items-center justify-center mx-auto mb-3\">\n                            <Store className=\"w-6 h-6 text-muted-foreground\" />\n                          </div>\n                          <p className=\"text-sm font-medium text-muted-foreground mb-1\">لا توجد فروع مضافة</p>\n                          <p className=\"text-xs text-muted-foreground\">يجب إضافة فرع واحد على الأقل للمتابعة</p>\n                        </div>\n                      ) : (\n                        <div className=\"space-y-4\">\n                          {fields.map((field, index) => (\n                            <div key={field.id} className=\"group relative grid grid-cols-1 md:grid-cols-2 gap-4 p-4 rounded-lg border bg-background/50 hover:bg-background transition-colors\">\n                              <div className=\"absolute -left-2 -top-2 md:static md:col-span-2 md:hidden\">\n                                <Button\n                                  type=\"button\"\n                                  variant=\"destructive\"\n                                  size=\"icon\"\n                                  className=\"h-6 w-6 rounded-full shadow-sm\"\n                                  onClick={() => remove(index)}\n                                  data-testid={`button-remove-branch-${index}`}\n                                >\n                                  <Trash2 className=\"w-3 h-3\" />\n                                </Button>\n                              </div>\n                              \n                              <FormField\n                                control={form.control}\n                                name={`branches.${index}.name`}\n                                render={({ field }) => (\n                                  <FormItem>\n                                    <FormLabel className=\"text-xs text-muted-foreground\">اسم الفرع</FormLabel>\n                                    <FormControl>\n                                      <Input placeholder=\"مثال: فرع العليا - الرياض\" {...field} className=\"bg-background\" data-testid={`input-branch-name-${index}`} />\n                                    </FormControl>\n                                    <FormMessage />\n                                  </FormItem>\n                                )}\n                              />\n                              \n                              <div className=\"flex items-end gap-2\">\n                                <div className=\"flex-1\">\n                                  <FormField\n                                    control={form.control}\n                                    name={`branches.${index}.mapLink`}\n                                    render={({ field }) => (\n                                      <FormItem>\n                                        <FormLabel className=\"text-xs text-muted-foreground\">رابط الموقع (Google Maps)</FormLabel>\n                                        <FormControl>\n                                          <Input placeholder=\"https://maps.google.com/...\" {...field} className=\"bg-background font-mono text-xs\" dir=\"ltr\" data-testid={`input-branch-map-${index}`} />\n                                        </FormControl>\n                                        <FormMessage />\n                                      </FormItem>\n                                    )}\n                                  />\n                                </div>\n                                <Button\n                                  type=\"button\"\n                                  variant=\"ghost\"\n                                  size=\"icon\"\n                                  className=\"text-muted-foreground hover:text-destructive hover:bg-destructive/10 hidden md:flex\"\n                                  onClick={() => remove(index)}\n                                  data-testid={`button-remove-branch-desktop-${index}`}\n                                >\n                                  <Trash2 className=\"w-4 h-4\" />\n                                </Button>\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                      )}\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"rounded-lg border border-border bg-card p-6 shadow-sm\">\n                  <div className=\"mb-6\">\n                    <h4 className=\"text-lg font-semibold text-foreground flex items-center gap-2\">\n                      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" className=\"text-primary\"><rect width=\"20\" height=\"14\" x=\"2\" y=\"5\" rx=\"2\"/><line x1=\"2\" x2=\"22\" y1=\"10\" y2=\"10\"/></svg>\n                      البيانات البنكية\n                    </h4>\n                    <p className=\"text-sm text-muted-foreground mt-1\">لتحويل أرباحك من المبيعات</p>\n                  </div>\n                  <div className=\"grid md:grid-cols-2 gap-6\">\n                    <FormField\n                      control={form.control}\n                      name=\"bankName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>اسم البنك</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"مثال: البنك الأهلي\" {...field} data-testid=\"input-bank-name\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"accountHolderName\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>اسم صاحب الحساب</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"الاسم كما يظهر في الحساب البنكي\" {...field} data-testid=\"input-account-holder\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"iban\"\n                      render={({ field }) => (\n                        <FormItem className=\"md:col-span-2\">\n                          <FormLabel>رقم الآيبان (IBAN)</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"SA0000000000000000000000\" {...field} className=\"font-mono text-left\" dir=\"ltr\" data-testid=\"input-iban\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                </div>\n\n                <div className=\"grid md:grid-cols-2 gap-6\">\n                  <FormField\n                    control={form.control}\n                    name=\"password\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>كلمة المرور</FormLabel>\n                        <FormControl>\n                          <div className=\"relative\">\n                            <Input \n                              type={showPassword ? \"text\" : \"password\"} \n                              placeholder=\"••••••••\" \n                              {...field} \n                              className=\"pl-10\"\n                              data-testid=\"input-password\" \n                            />\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"absolute left-1 top-1/2 -translate-y-1/2 h-7 w-7\"\n                              onClick={() => setShowPassword(!showPassword)}\n                              data-testid=\"button-toggle-password\"\n                            >\n                              {showPassword ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n                            </Button>\n                          </div>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"confirmPassword\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>تأكيد الكلمة</FormLabel>\n                        <FormControl>\n                          <div className=\"relative\">\n                            <Input \n                              type={showConfirmPassword ? \"text\" : \"password\"} \n                              placeholder=\"••••••••\" \n                              {...field} \n                              className=\"pl-10\"\n                              data-testid=\"input-confirm-password\" \n                            />\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"absolute left-1 top-1/2 -translate-y-1/2 h-7 w-7\"\n                              onClick={() => setShowConfirmPassword(!showConfirmPassword)}\n                              data-testid=\"button-toggle-confirm-password\"\n                            >\n                              {showConfirmPassword ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n                            </Button>\n                          </div>\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <FormField\n                  control={form.control}\n                  name=\"acceptTerms\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-row items-start space-x-3 space-x-reverse space-y-0 rounded-md border p-4 bg-muted/30\">\n                      <FormControl>\n                        <Checkbox\n                          checked={field.value}\n                          onCheckedChange={field.onChange}\n                          data-testid=\"checkbox-accept-terms\"\n                        />\n                      </FormControl>\n                      <div className=\"space-y-1 leading-none\">\n                        <FormLabel className=\"cursor-pointer\">\n                          أوافق على{\" \"}\n                          <Button\n                            type=\"button\"\n                            variant=\"link\"\n                            className=\"p-0 h-auto text-primary underline\"\n                            onClick={() => setShowTermsDialog(true)}\n                            data-testid=\"button-read-terms\"\n                          >\n                            الشروط والأحكام\n                          </Button>\n                        </FormLabel>\n                        <FormMessage />\n                      </div>\n                    </FormItem>\n                  )}\n                />\n\n                <Button type=\"submit\" className=\"w-full h-14 text-lg font-display rounded-xl bg-primary hover:bg-primary/90 shadow-lg shadow-primary/25 transition-all duration-200 mt-4\" disabled={isSubmitting} data-testid=\"button-submit\">\n                  {isSubmitting ? (\n                    <>\n                      <Loader2 className=\"w-5 h-5 ml-2 animate-spin\" />\n                      جاري التسجيل...\n                    </>\n                  ) : (\n                    \"تسجيل حساب جديد\"\n                  )}\n                </Button>\n              </form>\n            </Form>\n            <div className=\"mt-6 text-center text-sm text-muted-foreground\">\n              لديك حساب بالفعل؟{\" \"}\n              <Link href=\"/\" className=\"text-primary hover:underline font-medium\" data-testid=\"link-login\">\n                سجل دخولك هنا\n              </Link>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Dialog open={showTermsDialog} onOpenChange={setShowTermsDialog}>\n          <DialogContent className=\"max-w-2xl max-h-[80vh]\" dir=\"rtl\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <FileText className=\"w-5 h-5\" />\n                الشروط والأحكام\n              </DialogTitle>\n            </DialogHeader>\n            <ScrollArea className=\"h-[60vh] pr-4\">\n              <div className=\"prose prose-sm max-w-none text-right whitespace-pre-wrap\">\n                {termsData?.value || \"لم يتم إضافة الشروط والأحكام بعد.\"}\n              </div>\n            </ScrollArea>\n            <div className=\"flex justify-end pt-4 border-t\">\n              <Button onClick={() => setShowTermsDialog(false)} data-testid=\"button-close-terms\">\n                إغلاق\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":35641,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue | null>(null)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  if (!itemContext) {\n    throw new Error(\"useFormField should be used within <FormItem>\")\n  }\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue | null>(null)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-[0.8rem] text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-[0.8rem] font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4175,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Minus } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-9 w-9 items-center justify-center border-y border-r border-input text-sm shadow-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-1 ring-ring\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Minus />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2143,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"vite-plugin-meta-images.ts":{"content":"import type { Plugin } from 'vite';\nimport fs from 'fs';\nimport path from 'path';\n\n/**\n * Vite plugin that updates og:image and twitter:image meta tags\n * to point to the app's opengraph image with the correct Replit domain.\n */\nexport function metaImagesPlugin(): Plugin {\n  return {\n    name: 'vite-plugin-meta-images',\n    transformIndexHtml(html) {\n      const baseUrl = getDeploymentUrl();\n      if (!baseUrl) {\n        log('[meta-images] no Replit deployment domain found, skipping meta tag updates');\n        return html;\n      }\n\n      // Check if opengraph image exists in public directory\n      const publicDir = path.resolve(process.cwd(), 'client', 'public');\n      const opengraphPngPath = path.join(publicDir, 'opengraph.png');\n      const opengraphJpgPath = path.join(publicDir, 'opengraph.jpg');\n      const opengraphJpegPath = path.join(publicDir, 'opengraph.jpeg');\n\n      let imageExt: string | null = null;\n      if (fs.existsSync(opengraphPngPath)) {\n        imageExt = 'png';\n      } else if (fs.existsSync(opengraphJpgPath)) {\n        imageExt = 'jpg';\n      } else if (fs.existsSync(opengraphJpegPath)) {\n        imageExt = 'jpeg';\n      }\n\n      if (!imageExt) {\n        log('[meta-images] OpenGraph image not found, skipping meta tag updates');\n        return html;\n      }\n\n      const imageUrl = `${baseUrl}/opengraph.${imageExt}`;\n\n      log('[meta-images] updating meta image tags to:', imageUrl);\n\n      html = html.replace(\n        /<meta\\s+property=\"og:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta property=\"og:image\" content=\"${imageUrl}\" />`\n      );\n\n      html = html.replace(\n        /<meta\\s+name=\"twitter:image\"\\s+content=\"[^\"]*\"\\s*\\/>/g,\n        `<meta name=\"twitter:image\" content=\"${imageUrl}\" />`\n      );\n\n      return html;\n    },\n  };\n}\n\nfunction getDeploymentUrl(): string | null {\n  if (process.env.REPLIT_INTERNAL_APP_DOMAIN) {\n    const url = `https://${process.env.REPLIT_INTERNAL_APP_DOMAIN}`;\n    log('[meta-images] using internal app domain:', url);\n    return url;\n  }\n\n  if (process.env.REPLIT_DEV_DOMAIN) {\n    const url = `https://${process.env.REPLIT_DEV_DOMAIN}`;\n    log('[meta-images] using dev domain:', url);\n    return url;\n  }\n\n  return null;\n}\n\nfunction log(...args: any[]): void {\n  if (process.env.NODE_ENV === 'production') {\n    console.log(...args);\n  }\n}\n","path":null,"size_bytes":2333,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":768,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n      {children}\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4280,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/pages/merchant/Dashboard.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { \n  BarChart, \n  Bar, \n  XAxis, \n  YAxis, \n  CartesianGrid, \n  Tooltip, \n  ResponsiveContainer\n} from \"recharts\";\nimport { DollarSign, ShoppingBag, Package, Loader2, Clock } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Badge } from \"@/components/ui/badge\";\n\ninterface MerchantStats {\n  productsCount: number;\n  ordersCount: number;\n  pendingOrders: number;\n  completedOrders: number;\n  totalSales: number;\n  balance: number;\n  recentOrders: any[];\n  recentTransactions: any[];\n}\n\nconst StatsCard = ({ title, value, icon: Icon, description, loading }: any) => (\n  <Card>\n    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n      <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n        {title}\n      </CardTitle>\n      <Icon className=\"h-4 w-4 text-muted-foreground\" />\n    </CardHeader>\n    <CardContent>\n      {loading ? (\n        <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n      ) : (\n        <>\n          <div className=\"text-2xl font-bold font-display\" data-testid={`stat-${title}`}>{value}</div>\n          {description && (\n            <p className=\"text-xs text-muted-foreground mt-1\">{description}</p>\n          )}\n        </>\n      )}\n    </CardContent>\n  </Card>\n);\n\nconst orderStatusLabels: Record<string, string> = {\n  pending: \"قيد الانتظار\",\n  confirmed: \"مؤكد\",\n  preparing: \"قيد التحضير\",\n  ready: \"جاهز\",\n  delivered: \"تم التسليم\",\n  completed: \"مكتمل\",\n  cancelled: \"ملغي\"\n};\n\nconst orderStatusColors: Record<string, string> = {\n  pending: \"bg-amber-100 text-amber-800\",\n  confirmed: \"bg-blue-100 text-blue-800\",\n  preparing: \"bg-purple-100 text-purple-800\",\n  ready: \"bg-cyan-100 text-cyan-800\",\n  delivered: \"bg-emerald-100 text-emerald-800\",\n  completed: \"bg-green-100 text-green-800\",\n  cancelled: \"bg-red-100 text-red-800\"\n};\n\nexport default function MerchantDashboard() {\n  const { data: stats, isLoading } = useQuery<MerchantStats>({\n    queryKey: [\"/api/merchant/stats\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/merchant/stats\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch stats\");\n      return res.json();\n    }\n  });\n\n  const chartData = [\n    { name: \"المنتجات\", total: stats?.productsCount || 0 },\n    { name: \"الطلبات\", total: stats?.ordersCount || 0 },\n    { name: \"المكتملة\", total: stats?.completedOrders || 0 },\n    { name: \"المعلقة\", total: stats?.pendingOrders || 0 }\n  ];\n\n  return (\n    <DashboardLayout role=\"merchant\">\n      <div className=\"space-y-8\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight font-display\">نظرة عامة</h2>\n          <p className=\"text-muted-foreground mt-2\">أهلاً بك في لوحة تحكم متجرك. إليك ملخص أداء اليوم.</p>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n          <StatsCard \n            title=\"إجمالي المبيعات\" \n            value={`${((stats?.totalSales || 0) / 100).toFixed(2)} ر.س`}\n            icon={DollarSign}\n            description=\"مجموع المبيعات المكتملة\"\n            loading={isLoading}\n          />\n          <StatsCard \n            title=\"الرصيد الحالي\" \n            value={`${((stats?.balance || 0) / 100).toFixed(2)} ر.س`}\n            icon={DollarSign}\n            description=\"المتاح للسحب\"\n            loading={isLoading}\n          />\n          <StatsCard \n            title=\"المنتجات\" \n            value={stats?.productsCount || 0}\n            icon={Package}\n            description=\"عدد المنتجات في متجرك\"\n            loading={isLoading}\n          />\n          <StatsCard \n            title=\"الطلبات\" \n            value={stats?.ordersCount || 0}\n            icon={ShoppingBag}\n            description={`${stats?.pendingOrders || 0} طلبات معلقة`}\n            loading={isLoading}\n          />\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-7\">\n          <Card className=\"col-span-4\">\n            <CardHeader>\n              <CardTitle>نظرة عامة</CardTitle>\n            </CardHeader>\n            <CardContent className=\"pl-2\">\n              <div className=\"h-[350px]\">\n                {isLoading ? (\n                  <div className=\"flex items-center justify-center h-full\">\n                    <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n                  </div>\n                ) : (\n                  <ResponsiveContainer width=\"100%\" height=\"100%\">\n                    <BarChart data={chartData}>\n                      <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" vertical={false} />\n                      <XAxis \n                        dataKey=\"name\" \n                        stroke=\"#888888\" \n                        fontSize={12} \n                        tickLine={false} \n                        axisLine={false} \n                      />\n                      <YAxis \n                        stroke=\"#888888\" \n                        fontSize={12} \n                        tickLine={false} \n                        axisLine={false} \n                      />\n                      <Tooltip \n                        contentStyle={{ backgroundColor: 'hsl(var(--popover))', borderRadius: '8px', border: '1px solid hsl(var(--border))' }}\n                        itemStyle={{ color: 'hsl(var(--foreground))' }}\n                      />\n                      <Bar dataKey=\"total\" fill=\"hsl(var(--primary))\" radius={[4, 4, 0, 0]} />\n                    </BarChart>\n                  </ResponsiveContainer>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card className=\"col-span-3\">\n            <CardHeader>\n              <CardTitle>أحدث الطلبات</CardTitle>\n              <CardDescription>\n                آخر الطلبات الواردة لمتجرك\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {isLoading ? (\n                <div className=\"flex justify-center py-8\">\n                  <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n                </div>\n              ) : stats?.recentOrders && stats.recentOrders.length > 0 ? (\n                <div className=\"space-y-4\">\n                  {stats.recentOrders.map((order: any) => (\n                    <div className=\"flex items-center justify-between p-3 bg-muted/30 rounded-lg\" key={order.id} data-testid={`order-card-${order.id}`}>\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary\">\n                          <ShoppingBag className=\"w-5 h-5\" />\n                        </div>\n                        <div>\n                          <p className=\"font-medium text-sm\">طلب #{order.orderNumber}</p>\n                          <p className=\"text-xs text-muted-foreground\">\n                            {new Date(order.createdAt).toLocaleDateString('ar-SA')}\n                          </p>\n                        </div>\n                      </div>\n                      <div className=\"flex flex-col items-end gap-1\">\n                        <Badge variant=\"outline\" className={orderStatusColors[order.status]}>\n                          {orderStatusLabels[order.status]}\n                        </Badge>\n                        <span className=\"text-sm font-mono\">{(order.totalAmount / 100).toFixed(2)} ر.س</span>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <Clock className=\"w-12 h-12 text-muted-foreground mx-auto mb-2\" />\n                  <p className=\"text-muted-foreground\">لا توجد طلبات بعد</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":8353,"size_tokens":null},"client/src/components/ui/button-group.tsx":{"content":"import { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nconst buttonGroupVariants = cva(\n  \"flex w-fit items-stretch has-[>[data-slot=button-group]]:gap-2 [&>*]:focus-visible:relative [&>*]:focus-visible:z-10 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1\",\n  {\n    variants: {\n      orientation: {\n        horizontal:\n          \"[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none\",\n        vertical:\n          \"flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none\",\n      },\n    },\n    defaultVariants: {\n      orientation: \"horizontal\",\n    },\n  }\n)\n\nfunction ButtonGroup({\n  className,\n  orientation,\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof buttonGroupVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"button-group\"\n      data-orientation={orientation}\n      className={cn(buttonGroupVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupText({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  asChild?: boolean\n}) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      className={cn(\n        \"bg-muted shadow-xs flex items-center gap-2 rounded-md border px-4 text-sm font-medium [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ButtonGroupSeparator({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"button-group-separator\"\n      orientation={orientation}\n      className={cn(\n        \"bg-input relative !m-0 self-stretch data-[orientation=vertical]:h-auto\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  ButtonGroup,\n  ButtonGroupSeparator,\n  ButtonGroupText,\n  buttonGroupVariants,\n}\n","path":null,"size_bytes":2209,"size_tokens":null},"server/vite.ts":{"content":"import { type Express } from \"express\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport async function setupVite(server: Server, app: Express) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server, path: \"/vite-hmr\" },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n","path":null,"size_bytes":1534,"size_tokens":null},"client/src/pages/admin/Login.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useLocation } from \"wouter\";\nimport { ShieldCheck, Loader2, Eye, EyeOff } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport logoUrl from \"@assets/شعار_غلوردا_1764881546720.jpg\";\n\nconst formSchema = z.object({\n  email: z.string().email({ message: \"البريد الإلكتروني غير صالح\" }),\n  password: z.string().min(1, { message: \"كلمة المرور مطلوبة\" }),\n});\n\nexport default function AdminLogin() {\n  const [, setLocation] = useLocation();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [showPassword, setShowPassword] = useState(false);\n  const { toast } = useToast();\n  const { refetch } = useAuth();\n\n  const form = useForm<z.infer<typeof formSchema>>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      email: \"\",\n      password: \"\",\n    },\n  });\n\n  async function onSubmit(values: z.infer<typeof formSchema>) {\n    setIsSubmitting(true);\n    \n    try {\n      const response = await fetch(\"/api/auth/login/admin\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify(values),\n      });\n      \n      const data = await response.json();\n      \n      if (!response.ok) {\n        toast({\n          variant: \"destructive\",\n          title: \"خطأ في تسجيل الدخول\",\n          description: data.error || \"حدث خطأ ما\",\n        });\n        return;\n      }\n      \n      toast({\n        title: \"تم تسجيل الدخول بنجاح\",\n        description: `مرحباً ${data.admin.name}`,\n      });\n      \n      await refetch();\n      setTimeout(() => {\n        setLocation(\"/admin\");\n      }, 100);\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"خطأ\",\n        description: \"فشل الاتصال بالخادم\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-background p-4\" dir=\"rtl\">\n      <div className=\"w-full max-w-md space-y-8\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"flex justify-center\">\n            <div className=\"w-20 h-20 rounded-2xl bg-primary/5 flex items-center justify-center mb-4 border border-primary/10\">\n              <ShieldCheck className=\"w-10 h-10 text-primary\" />\n            </div>\n          </div>\n          <h1 className=\"text-2xl font-bold tracking-tight font-display\">إدارة النظام</h1>\n          <p className=\"text-muted-foreground text-sm\">تسجيل الدخول المخصص لمشرفي النظام</p>\n        </div>\n\n        <Card className=\"border-muted/40 shadow-lg\">\n          <CardHeader className=\"space-y-1\">\n            <CardTitle className=\"text-xl\">تسجيل الدخول</CardTitle>\n            <CardDescription>أدخل بيانات المشرف للمتابعة</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>البريد الإلكتروني</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"admin@glorda.com\" {...field} className=\"font-mono text-right\" data-testid=\"input-admin-email\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"password\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>كلمة المرور</FormLabel>\n                      <FormControl>\n                        <div className=\"relative\">\n                          <Input \n                            type={showPassword ? \"text\" : \"password\"} \n                            placeholder=\"••••••••\" \n                            {...field} \n                            className=\"pl-10\" \n                            data-testid=\"input-admin-password\" \n                          />\n                          <Button\n                            type=\"button\"\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            className=\"absolute left-1 top-1/2 -translate-y-1/2 h-7 w-7\"\n                            onClick={() => setShowPassword(!showPassword)}\n                            data-testid=\"button-toggle-password\"\n                          >\n                            {showPassword ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n                          </Button>\n                        </div>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <Button type=\"submit\" className=\"w-full h-12 text-base font-display rounded-xl bg-primary hover:bg-primary/90 shadow-lg shadow-primary/25 transition-all duration-200 mt-2\" disabled={isSubmitting} data-testid=\"button-admin-submit\">\n                  {isSubmitting ? <Loader2 className=\"w-5 h-5 animate-spin\" /> : \"الدخول للوحة التحكم\"}\n                </Button>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n        \n        <div className=\"text-center\">\n          <p className=\"text-xs text-muted-foreground\">\n            هذه الصفحة مخصصة للموظفين المصرح لهم فقط.\n          </p>\n          <p className=\"text-xs text-muted-foreground mt-2\">\n            بيانات الدخول الافتراضية: admin@glorda.com / admin123\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":6483,"size_tokens":null},"server/storage.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport { eq, and, desc, asc, sql } from \"drizzle-orm\";\nimport pg from \"pg\";\nimport { \n  merchants, \n  products, \n  transactions, \n  admins,\n  customers,\n  orders,\n  orderMessages,\n  reviews,\n  banners,\n  categories,\n  cities,\n  appSettings,\n  type Merchant, \n  type InsertMerchant,\n  type Product,\n  type InsertProduct,\n  type Transaction,\n  type InsertTransaction,\n  type Admin,\n  type InsertAdmin,\n  type Customer,\n  type InsertCustomer,\n  type Order,\n  type InsertOrder,\n  type OrderMessage,\n  type InsertOrderMessage,\n  type Review,\n  type InsertReview,\n  type Banner,\n  type InsertBanner,\n  type Category,\n  type InsertCategory,\n  type City,\n  type InsertCity,\n  type AppSetting,\n  type InsertAppSetting\n} from \"@shared/schema\";\n\nconst { Pool } = pg;\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n});\n\nconst db = drizzle(pool);\n\nexport interface IStorage {\n  // Merchants\n  getMerchant(id: number): Promise<Merchant | undefined>;\n  getMerchantByEmail(email: string): Promise<Merchant | undefined>;\n  createMerchant(merchant: InsertMerchant): Promise<Merchant>;\n  updateMerchant(id: number, data: Partial<Merchant>): Promise<void>;\n  updateMerchantStatus(id: number, status: string): Promise<void>;\n  updateMerchantBalance(id: number, amount: number): Promise<void>;\n  getAllMerchants(): Promise<Merchant[]>;\n  \n  // Products\n  getProduct(id: number): Promise<Product | undefined>;\n  getProductsByMerchant(merchantId: number): Promise<Product[]>;\n  createProduct(product: InsertProduct): Promise<Product>;\n  updateProduct(id: number, product: Partial<InsertProduct>): Promise<void>;\n  deleteProduct(id: number): Promise<void>;\n  \n  // Customers\n  getCustomer(id: number): Promise<Customer | undefined>;\n  getAllCustomers(): Promise<Customer[]>;\n  createCustomer(customer: InsertCustomer): Promise<Customer>;\n  \n  // Orders\n  getOrder(id: number): Promise<Order | undefined>;\n  getOrdersByMerchant(merchantId: number): Promise<Order[]>;\n  getOrdersByCustomer(customerId: number): Promise<Order[]>;\n  getAllOrders(): Promise<Order[]>;\n  createOrder(order: InsertOrder): Promise<Order>;\n  updateOrderStatus(id: number, status: string): Promise<void>;\n  updateOrderPaid(id: number, isPaid: boolean): Promise<void>;\n  \n  // Order Messages\n  getMessagesByOrder(orderId: number): Promise<OrderMessage[]>;\n  createMessage(message: InsertOrderMessage): Promise<OrderMessage>;\n  \n  // Reviews\n  getReviewsByProduct(productId: number): Promise<Review[]>;\n  getReviewsByMerchant(merchantId: number): Promise<Review[]>;\n  createReview(review: InsertReview): Promise<Review>;\n  \n  // Transactions\n  getTransactionsByMerchant(merchantId: number): Promise<Transaction[]>;\n  getAllTransactions(): Promise<Transaction[]>;\n  createTransaction(transaction: InsertTransaction): Promise<Transaction>;\n  updateTransactionStatus(id: number, status: string): Promise<void>;\n  getPendingWithdrawals(): Promise<Transaction[]>;\n  \n  // Admins\n  getAdmin(id: number): Promise<Admin | undefined>;\n  getAdminByEmail(email: string): Promise<Admin | undefined>;\n  getAllAdmins(): Promise<Admin[]>;\n  createAdmin(admin: InsertAdmin): Promise<Admin>;\n  deleteAdmin(id: number): Promise<void>;\n  updateAdminPassword(id: number, password: string): Promise<void>;\n  \n  // Banners\n  getBanner(id: number): Promise<Banner | undefined>;\n  getAllBanners(): Promise<Banner[]>;\n  getActiveBanners(): Promise<Banner[]>;\n  createBanner(banner: InsertBanner): Promise<Banner>;\n  updateBanner(id: number, banner: Partial<InsertBanner>): Promise<void>;\n  deleteBanner(id: number): Promise<void>;\n  \n  // Categories\n  getCategory(id: number): Promise<Category | undefined>;\n  getAllCategories(): Promise<Category[]>;\n  getActiveCategories(): Promise<Category[]>;\n  createCategory(category: InsertCategory): Promise<Category>;\n  updateCategory(id: number, category: Partial<InsertCategory>): Promise<void>;\n  deleteCategory(id: number): Promise<void>;\n  \n  // Cities\n  getCity(id: number): Promise<City | undefined>;\n  getAllCities(): Promise<City[]>;\n  getActiveCities(): Promise<City[]>;\n  createCity(city: InsertCity): Promise<City>;\n  updateCity(id: number, city: Partial<InsertCity>): Promise<void>;\n  deleteCity(id: number): Promise<void>;\n  \n  // App Settings\n  getSetting(key: string): Promise<AppSetting | undefined>;\n  getAllSettings(): Promise<AppSetting[]>;\n  setSetting(key: string, value?: string, valueJson?: any): Promise<AppSetting>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // ========== Merchants ==========\n  async getMerchant(id: number): Promise<Merchant | undefined> {\n    const result = await db.select().from(merchants).where(eq(merchants.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getMerchantByEmail(email: string): Promise<Merchant | undefined> {\n    const result = await db.select().from(merchants).where(eq(merchants.email, email)).limit(1);\n    return result[0];\n  }\n\n  async createMerchant(merchant: InsertMerchant): Promise<Merchant> {\n    const result = await db.insert(merchants).values(merchant as any).returning();\n    return result[0];\n  }\n\n  async updateMerchant(id: number, data: Partial<Merchant>): Promise<void> {\n    await db.update(merchants).set(data).where(eq(merchants.id, id));\n  }\n\n  async updateMerchantStatus(id: number, status: string): Promise<void> {\n    await db.update(merchants).set({ status }).where(eq(merchants.id, id));\n  }\n\n  async updateMerchantBalance(id: number, amount: number): Promise<void> {\n    await db.update(merchants).set({ balance: amount }).where(eq(merchants.id, id));\n  }\n\n  async getAllMerchants(): Promise<Merchant[]> {\n    return await db.select().from(merchants).orderBy(desc(merchants.createdAt));\n  }\n\n  // ========== Products ==========\n  async getProduct(id: number): Promise<Product | undefined> {\n    const result = await db.select().from(products).where(eq(products.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getProductsByMerchant(merchantId: number): Promise<Product[]> {\n    return await db.select().from(products).where(eq(products.merchantId, merchantId)).orderBy(desc(products.createdAt));\n  }\n\n  async createProduct(product: InsertProduct): Promise<Product> {\n    const result = await db.insert(products).values(product as any).returning();\n    return result[0];\n  }\n\n  async updateProduct(id: number, product: Partial<InsertProduct>): Promise<void> {\n    await db.update(products).set(product as any).where(eq(products.id, id));\n  }\n\n  async deleteProduct(id: number): Promise<void> {\n    await db.delete(products).where(eq(products.id, id));\n  }\n\n  // ========== Customers ==========\n  async getCustomer(id: number): Promise<Customer | undefined> {\n    const result = await db.select().from(customers).where(eq(customers.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getAllCustomers(): Promise<Customer[]> {\n    return await db.select().from(customers).orderBy(desc(customers.createdAt));\n  }\n\n  async createCustomer(customer: InsertCustomer): Promise<Customer> {\n    const result = await db.insert(customers).values(customer).returning();\n    return result[0];\n  }\n\n  // ========== Orders ==========\n  async getOrder(id: number): Promise<Order | undefined> {\n    const result = await db.select().from(orders).where(eq(orders.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getOrdersByMerchant(merchantId: number): Promise<Order[]> {\n    return await db.select().from(orders).where(eq(orders.merchantId, merchantId)).orderBy(desc(orders.createdAt));\n  }\n\n  async getOrdersByCustomer(customerId: number): Promise<Order[]> {\n    return await db.select().from(orders).where(eq(orders.customerId, customerId)).orderBy(desc(orders.createdAt));\n  }\n\n  async getAllOrders(): Promise<Order[]> {\n    return await db.select().from(orders).orderBy(desc(orders.createdAt));\n  }\n\n  async createOrder(order: InsertOrder): Promise<Order> {\n    const result = await db.insert(orders).values(order).returning();\n    return result[0];\n  }\n\n  async updateOrderStatus(id: number, status: string): Promise<void> {\n    await db.update(orders).set({ status, updatedAt: new Date() }).where(eq(orders.id, id));\n  }\n\n  async updateOrderPaid(id: number, isPaid: boolean): Promise<void> {\n    await db.update(orders).set({ isPaid, updatedAt: new Date() }).where(eq(orders.id, id));\n  }\n\n  // ========== Order Messages ==========\n  async getMessagesByOrder(orderId: number): Promise<OrderMessage[]> {\n    return await db.select().from(orderMessages).where(eq(orderMessages.orderId, orderId)).orderBy(asc(orderMessages.createdAt));\n  }\n\n  async createMessage(message: InsertOrderMessage): Promise<OrderMessage> {\n    const result = await db.insert(orderMessages).values(message).returning();\n    return result[0];\n  }\n\n  // ========== Reviews ==========\n  async getReviewsByProduct(productId: number): Promise<Review[]> {\n    return await db.select().from(reviews).where(eq(reviews.productId, productId)).orderBy(desc(reviews.createdAt));\n  }\n\n  async getReviewsByMerchant(merchantId: number): Promise<Review[]> {\n    const merchantProducts = await this.getProductsByMerchant(merchantId);\n    const productIds = merchantProducts.map(p => p.id);\n    if (productIds.length === 0) return [];\n    \n    const allReviews: Review[] = [];\n    for (const productId of productIds) {\n      const productReviews = await db.select().from(reviews).where(eq(reviews.productId, productId));\n      allReviews.push(...productReviews);\n    }\n    return allReviews.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n  }\n\n  async createReview(review: InsertReview): Promise<Review> {\n    const result = await db.insert(reviews).values(review).returning();\n    return result[0];\n  }\n\n  // ========== Transactions ==========\n  async getTransactionsByMerchant(merchantId: number): Promise<Transaction[]> {\n    return await db.select().from(transactions).where(eq(transactions.merchantId, merchantId)).orderBy(desc(transactions.createdAt));\n  }\n\n  async getAllTransactions(): Promise<Transaction[]> {\n    return await db.select().from(transactions).orderBy(desc(transactions.createdAt));\n  }\n\n  async createTransaction(transaction: InsertTransaction): Promise<Transaction> {\n    const result = await db.insert(transactions).values(transaction).returning();\n    return result[0];\n  }\n\n  async updateTransactionStatus(id: number, status: string): Promise<void> {\n    await db.update(transactions).set({ status }).where(eq(transactions.id, id));\n  }\n\n  async getPendingWithdrawals(): Promise<Transaction[]> {\n    return await db.select().from(transactions).where(\n      and(\n        eq(transactions.type, \"withdrawal\"),\n        eq(transactions.status, \"pending\")\n      )\n    ).orderBy(desc(transactions.createdAt));\n  }\n\n  // ========== Admins ==========\n  async getAdmin(id: number): Promise<Admin | undefined> {\n    const result = await db.select().from(admins).where(eq(admins.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getAdminByEmail(email: string): Promise<Admin | undefined> {\n    const result = await db.select().from(admins).where(eq(admins.email, email)).limit(1);\n    return result[0];\n  }\n\n  async createAdmin(admin: InsertAdmin): Promise<Admin> {\n    const result = await db.insert(admins).values(admin).returning();\n    return result[0];\n  }\n\n  async getAllAdmins(): Promise<Admin[]> {\n    return await db.select().from(admins).orderBy(desc(admins.createdAt));\n  }\n\n  async deleteAdmin(id: number): Promise<void> {\n    await db.delete(admins).where(eq(admins.id, id));\n  }\n\n  async updateAdminPassword(id: number, password: string): Promise<void> {\n    await db.update(admins).set({ password }).where(eq(admins.id, id));\n  }\n\n  // ========== Banners ==========\n  async getBanner(id: number): Promise<Banner | undefined> {\n    const result = await db.select().from(banners).where(eq(banners.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getAllBanners(): Promise<Banner[]> {\n    return await db.select().from(banners).orderBy(asc(banners.sortOrder));\n  }\n\n  async getActiveBanners(): Promise<Banner[]> {\n    return await db.select().from(banners).where(eq(banners.isActive, true)).orderBy(asc(banners.sortOrder));\n  }\n\n  async createBanner(banner: InsertBanner): Promise<Banner> {\n    const result = await db.insert(banners).values(banner).returning();\n    return result[0];\n  }\n\n  async updateBanner(id: number, banner: Partial<InsertBanner>): Promise<void> {\n    await db.update(banners).set(banner).where(eq(banners.id, id));\n  }\n\n  async deleteBanner(id: number): Promise<void> {\n    await db.delete(banners).where(eq(banners.id, id));\n  }\n\n  // ========== Categories ==========\n  async getCategory(id: number): Promise<Category | undefined> {\n    const result = await db.select().from(categories).where(eq(categories.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getAllCategories(): Promise<Category[]> {\n    return await db.select().from(categories).orderBy(asc(categories.sortOrder));\n  }\n\n  async getActiveCategories(): Promise<Category[]> {\n    return await db.select().from(categories).where(eq(categories.isActive, true)).orderBy(asc(categories.sortOrder));\n  }\n\n  async createCategory(category: InsertCategory): Promise<Category> {\n    const result = await db.insert(categories).values(category).returning();\n    return result[0];\n  }\n\n  async updateCategory(id: number, category: Partial<InsertCategory>): Promise<void> {\n    await db.update(categories).set(category).where(eq(categories.id, id));\n  }\n\n  async deleteCategory(id: number): Promise<void> {\n    await db.delete(categories).where(eq(categories.id, id));\n  }\n\n  // ========== Cities ==========\n  async getCity(id: number): Promise<City | undefined> {\n    const result = await db.select().from(cities).where(eq(cities.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getAllCities(): Promise<City[]> {\n    return await db.select().from(cities).orderBy(asc(cities.sortOrder));\n  }\n\n  async getActiveCities(): Promise<City[]> {\n    return await db.select().from(cities).where(eq(cities.isActive, true)).orderBy(asc(cities.sortOrder));\n  }\n\n  async createCity(city: InsertCity): Promise<City> {\n    const result = await db.insert(cities).values(city).returning();\n    return result[0];\n  }\n\n  async updateCity(id: number, city: Partial<InsertCity>): Promise<void> {\n    await db.update(cities).set(city).where(eq(cities.id, id));\n  }\n\n  async deleteCity(id: number): Promise<void> {\n    await db.delete(cities).where(eq(cities.id, id));\n  }\n\n  // ========== App Settings ==========\n  async getSetting(key: string): Promise<AppSetting | undefined> {\n    const result = await db.select().from(appSettings).where(eq(appSettings.key, key)).limit(1);\n    return result[0];\n  }\n\n  async getAllSettings(): Promise<AppSetting[]> {\n    return await db.select().from(appSettings);\n  }\n\n  async setSetting(key: string, value?: string, valueJson?: any): Promise<AppSetting> {\n    const existing = await this.getSetting(key);\n    if (existing) {\n      await db.update(appSettings).set({ value, valueJson, updatedAt: new Date() }).where(eq(appSettings.key, key));\n      return (await this.getSetting(key))!;\n    }\n    const result = await db.insert(appSettings).values({ key, value, valueJson }).returning();\n    return result[0];\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":15336,"size_tokens":null},"replit.md":{"content":"# Overview\n\nThis is a multi-tenant e-commerce platform built with React, Express, and PostgreSQL. The application provides separate dashboards for merchants and administrators, with features for product management, transaction processing, and user management. The platform supports Arabic language (RTL layout) and uses session-based authentication.\n\n# User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n# System Architecture\n\n## Frontend Architecture\n\n**Technology Stack**: React with TypeScript, Vite as build tool, Wouter for routing, TanStack Query for data fetching.\n\n**UI Framework**: Shadcn/ui components with Radix UI primitives, TailwindCSS for styling, Cairo and Outfit fonts for Arabic and English text.\n\n**State Management**: React Query handles server state with configured defaults (no refetch on window focus, infinite stale time). Form state managed by React Hook Form with Zod validation.\n\n**Routing Strategy**: Client-side routing using Wouter with separate route hierarchies for merchants (`/dashboard/*`) and admins (`/admin/*`). Authentication pages at root level.\n\n**Component Structure**: Layout components wrap page content (DashboardLayout), UI components follow atomic design pattern with shadcn/ui conventions. RTL support built into all components via `dir=\"rtl\"` on root HTML.\n\n## Backend Architecture\n\n**Runtime**: Node.js with Express framework, TypeScript throughout.\n\n**API Design**: RESTful API with `/api/*` prefix. Session-based authentication with middleware guards (`requireMerchant`, `requireAdmin`).\n\n**Session Management**: Express sessions with secure cookies in production. Session data stores userId and userType (merchant/admin).\n\n**Authentication Flow**: Separate login endpoints for merchants and admins. Password hashing with bcryptjs. No JWT tokens - sessions only.\n\n**Request Processing**: JSON body parsing with raw body buffer for webhook verification. Logging middleware tracks request duration and response status.\n\n**Build System**: ESBuild bundles server with allowlisted dependencies for cold start optimization. Vite builds client with HMR in development.\n\n## Data Layer\n\n**ORM**: Drizzle ORM with PostgreSQL dialect configured for migrations in `./migrations` directory.\n\n**Schema Design**: \n- Merchants table with owner info, store details, status (pending/active/rejected), balance tracking, social links (JSONB)\n- Products table linked to merchants\n- Transactions for payment/withdrawal tracking\n- Admins table for platform administrators\n- Supporting tables: customers, orders, orderMessages, reviews, banners, categories, cities, appSettings\n\n**Database Access**: Connection pooling via node-postgres (pg). All queries through Drizzle with type safety from schema definitions.\n\n**Validation**: Zod schemas generated from Drizzle schema using drizzle-zod for insert operations. Validation errors formatted with zod-validation-error.\n\n## External Dependencies\n\n**Database**: PostgreSQL (configured via DATABASE_URL environment variable, required for application startup)\n\n**Session Store**: In-memory sessions in development. Production uses either connect-pg-simple for PostgreSQL-backed sessions or memorystore as fallback.\n\n**File Storage**: Local filesystem for uploads (merchant store images, product images). Files served from dist/public in production.\n\n**Asset Management**: Attached assets stored in separate directory, aliased as @assets in Vite config.\n\n**OpenGraph Images**: Custom Vite plugin updates meta tags with Replit deployment domain for social sharing.\n\n**Development Tools**: \n- Replit-specific plugins (cartographer, dev-banner, runtime-error-modal) conditionally loaded in development\n- Vite HMR over WebSocket at `/vite-hmr` path\n\n**Build Output**: Client builds to `dist/public`, server bundles to `dist/index.cjs`. Static files served by Express in production with SPA fallback to index.html.","path":null,"size_bytes":3907,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4419,"size_tokens":null},"client/src/components/ui/input-group.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Textarea } from \"@/components/ui/textarea\"\n\nfunction InputGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"input-group\"\n      role=\"group\"\n      className={cn(\n        \"group/input-group border-input dark:bg-input/30 shadow-xs relative flex w-full items-center rounded-md border outline-none transition-[color,box-shadow]\",\n        \"h-9 has-[>textarea]:h-auto\",\n\n        // Variants based on alignment.\n        \"has-[>[data-align=inline-start]]:[&>input]:pl-2\",\n        \"has-[>[data-align=inline-end]]:[&>input]:pr-2\",\n        \"has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3\",\n        \"has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3\",\n\n        // Focus state.\n        \"has-[[data-slot=input-group-control]:focus-visible]:ring-ring has-[[data-slot=input-group-control]:focus-visible]:ring-1\",\n\n        // Error state.\n        \"has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40\",\n\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupAddonVariants = cva(\n  \"text-muted-foreground flex h-auto cursor-text select-none items-center justify-center gap-2 py-1.5 text-sm font-medium group-data-[disabled=true]/input-group:opacity-50 [&>kbd]:rounded-[calc(var(--radius)-5px)] [&>svg:not([class*='size-'])]:size-4\",\n  {\n    variants: {\n      align: {\n        \"inline-start\":\n          \"order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]\",\n        \"inline-end\":\n          \"order-last pr-3 has-[>button]:mr-[-0.4rem] has-[>kbd]:mr-[-0.35rem]\",\n        \"block-start\":\n          \"[.border-b]:pb-3 order-first w-full justify-start px-3 pt-3 group-has-[>input]/input-group:pt-2.5\",\n        \"block-end\":\n          \"[.border-t]:pt-3 order-last w-full justify-start px-3 pb-3 group-has-[>input]/input-group:pb-2.5\",\n      },\n    },\n    defaultVariants: {\n      align: \"inline-start\",\n    },\n  }\n)\n\nfunction InputGroupAddon({\n  className,\n  align = \"inline-start\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof inputGroupAddonVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"input-group-addon\"\n      data-align={align}\n      className={cn(inputGroupAddonVariants({ align }), className)}\n      onClick={(e) => {\n        if ((e.target as HTMLElement).closest(\"button\")) {\n          return\n        }\n        e.currentTarget.parentElement?.querySelector(\"input\")?.focus()\n      }}\n      {...props}\n    />\n  )\n}\n\nconst inputGroupButtonVariants = cva(\n  \"flex items-center gap-2 text-sm shadow-none\",\n  {\n    variants: {\n      size: {\n        xs: \"h-6 gap-1 rounded-[calc(var(--radius)-5px)] px-2 has-[>svg]:px-2 [&>svg:not([class*='size-'])]:size-3.5\",\n        sm: \"h-8 gap-1.5 rounded-md px-2.5 has-[>svg]:px-2.5\",\n        \"icon-xs\":\n          \"size-6 rounded-[calc(var(--radius)-5px)] p-0 has-[>svg]:p-0\",\n        \"icon-sm\": \"size-8 p-0 has-[>svg]:p-0\",\n      },\n    },\n    defaultVariants: {\n      size: \"xs\",\n    },\n  }\n)\n\nfunction InputGroupButton({\n  className,\n  type = \"button\",\n  variant = \"ghost\",\n  size = \"xs\",\n  ...props\n}: Omit<React.ComponentProps<typeof Button>, \"size\"> &\n  VariantProps<typeof inputGroupButtonVariants>) {\n  return (\n    <Button\n      type={type}\n      data-size={size}\n      variant={variant}\n      className={cn(inputGroupButtonVariants({ size }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupText({ className, ...props }: React.ComponentProps<\"span\">) {\n  return (\n    <span\n      className={cn(\n        \"text-muted-foreground flex items-center gap-2 text-sm [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupInput({\n  className,\n  ...props\n}: React.ComponentProps<\"input\">) {\n  return (\n    <Input\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction InputGroupTextarea({\n  className,\n  ...props\n}: React.ComponentProps<\"textarea\">) {\n  return (\n    <Textarea\n      data-slot=\"input-group-control\"\n      className={cn(\n        \"flex-1 resize-none rounded-none border-0 bg-transparent py-3 shadow-none focus-visible:ring-0 dark:bg-transparent\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  InputGroup,\n  InputGroupAddon,\n  InputGroupButton,\n  InputGroupText,\n  InputGroupInput,\n  InputGroupTextarea,\n}\n","path":null,"size_bytes":4971,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport {\n  ChevronDownIcon,\n  ChevronLeftIcon,\n  ChevronRightIcon,\n} from \"lucide-react\"\nimport { DayButton, DayPicker, getDefaultClassNames } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button, buttonVariants } from \"@/components/ui/button\"\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  captionLayout = \"label\",\n  buttonVariant = \"ghost\",\n  formatters,\n  components,\n  ...props\n}: React.ComponentProps<typeof DayPicker> & {\n  buttonVariant?: React.ComponentProps<typeof Button>[\"variant\"]\n}) {\n  const defaultClassNames = getDefaultClassNames()\n\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\n        \"bg-background group/calendar p-3 [--cell-size:2rem] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent\",\n        String.raw`rtl:**:[.rdp-button\\_next>svg]:rotate-180`,\n        String.raw`rtl:**:[.rdp-button\\_previous>svg]:rotate-180`,\n        className\n      )}\n      captionLayout={captionLayout}\n      formatters={{\n        formatMonthDropdown: (date) =>\n          date.toLocaleString(\"default\", { month: \"short\" }),\n        ...formatters,\n      }}\n      classNames={{\n        root: cn(\"w-fit\", defaultClassNames.root),\n        months: cn(\n          \"relative flex flex-col gap-4 md:flex-row\",\n          defaultClassNames.months\n        ),\n        month: cn(\"flex w-full flex-col gap-4\", defaultClassNames.month),\n        nav: cn(\n          \"absolute inset-x-0 top-0 flex w-full items-center justify-between gap-1\",\n          defaultClassNames.nav\n        ),\n        button_previous: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_previous\n        ),\n        button_next: cn(\n          buttonVariants({ variant: buttonVariant }),\n          \"h-[--cell-size] w-[--cell-size] select-none p-0 aria-disabled:opacity-50\",\n          defaultClassNames.button_next\n        ),\n        month_caption: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center px-[--cell-size]\",\n          defaultClassNames.month_caption\n        ),\n        dropdowns: cn(\n          \"flex h-[--cell-size] w-full items-center justify-center gap-1.5 text-sm font-medium\",\n          defaultClassNames.dropdowns\n        ),\n        dropdown_root: cn(\n          \"has-focus:border-ring border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] relative rounded-md border\",\n          defaultClassNames.dropdown_root\n        ),\n        dropdown: cn(\n          \"bg-popover absolute inset-0 opacity-0\",\n          defaultClassNames.dropdown\n        ),\n        caption_label: cn(\n          \"select-none font-medium\",\n          captionLayout === \"label\"\n            ? \"text-sm\"\n            : \"[&>svg]:text-muted-foreground flex h-8 items-center gap-1 rounded-md pl-2 pr-1 text-sm [&>svg]:size-3.5\",\n          defaultClassNames.caption_label\n        ),\n        table: \"w-full border-collapse\",\n        weekdays: cn(\"flex\", defaultClassNames.weekdays),\n        weekday: cn(\n          \"text-muted-foreground flex-1 select-none rounded-md text-[0.8rem] font-normal\",\n          defaultClassNames.weekday\n        ),\n        week: cn(\"mt-2 flex w-full\", defaultClassNames.week),\n        week_number_header: cn(\n          \"w-[--cell-size] select-none\",\n          defaultClassNames.week_number_header\n        ),\n        week_number: cn(\n          \"text-muted-foreground select-none text-[0.8rem]\",\n          defaultClassNames.week_number\n        ),\n        day: cn(\n          \"group/day relative aspect-square h-full w-full select-none p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md\",\n          defaultClassNames.day\n        ),\n        range_start: cn(\n          \"bg-accent rounded-l-md\",\n          defaultClassNames.range_start\n        ),\n        range_middle: cn(\"rounded-none\", defaultClassNames.range_middle),\n        range_end: cn(\"bg-accent rounded-r-md\", defaultClassNames.range_end),\n        today: cn(\n          \"bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none\",\n          defaultClassNames.today\n        ),\n        outside: cn(\n          \"text-muted-foreground aria-selected:text-muted-foreground\",\n          defaultClassNames.outside\n        ),\n        disabled: cn(\n          \"text-muted-foreground opacity-50\",\n          defaultClassNames.disabled\n        ),\n        hidden: cn(\"invisible\", defaultClassNames.hidden),\n        ...classNames,\n      }}\n      components={{\n        Root: ({ className, rootRef, ...props }) => {\n          return (\n            <div\n              data-slot=\"calendar\"\n              ref={rootRef}\n              className={cn(className)}\n              {...props}\n            />\n          )\n        },\n        Chevron: ({ className, orientation, ...props }) => {\n          if (orientation === \"left\") {\n            return (\n              <ChevronLeftIcon className={cn(\"size-4\", className)} {...props} />\n            )\n          }\n\n          if (orientation === \"right\") {\n            return (\n              <ChevronRightIcon\n                className={cn(\"size-4\", className)}\n                {...props}\n              />\n            )\n          }\n\n          return (\n            <ChevronDownIcon className={cn(\"size-4\", className)} {...props} />\n          )\n        },\n        DayButton: CalendarDayButton,\n        WeekNumber: ({ children, ...props }) => {\n          return (\n            <td {...props}>\n              <div className=\"flex size-[--cell-size] items-center justify-center text-center\">\n                {children}\n              </div>\n            </td>\n          )\n        },\n        ...components,\n      }}\n      {...props}\n    />\n  )\n}\n\nfunction CalendarDayButton({\n  className,\n  day,\n  modifiers,\n  ...props\n}: React.ComponentProps<typeof DayButton>) {\n  const defaultClassNames = getDefaultClassNames()\n\n  const ref = React.useRef<HTMLButtonElement>(null)\n  React.useEffect(() => {\n    if (modifiers.focused) ref.current?.focus()\n  }, [modifiers.focused])\n\n  return (\n    <Button\n      ref={ref}\n      variant=\"ghost\"\n      size=\"icon\"\n      data-day={day.date.toLocaleDateString()}\n      data-selected-single={\n        modifiers.selected &&\n        !modifiers.range_start &&\n        !modifiers.range_end &&\n        !modifiers.range_middle\n      }\n      data-range-start={modifiers.range_start}\n      data-range-end={modifiers.range_end}\n      data-range-middle={modifiers.range_middle}\n      className={cn(\n        \"data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 flex aspect-square h-auto w-full min-w-[--cell-size] flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70\",\n        defaultClassNames.day,\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport { Calendar, CalendarDayButton }\n","path":null,"size_bytes":7569,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-xl border bg-card text-card-foreground shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","path":null,"size_bytes":1828,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4887,"size_tokens":null},"client/src/components/ui/empty.tsx":{"content":"import { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Empty({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty\"\n      className={cn(\n        \"flex min-w-0 flex-1 flex-col items-center justify-center gap-6 text-balance rounded-lg border-dashed p-6 text-center md:p-12\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-header\"\n      className={cn(\n        \"flex max-w-sm flex-col items-center gap-2 text-center\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst emptyMediaVariants = cva(\n  \"mb-2 flex shrink-0 items-center justify-center [&_svg]:pointer-events-none [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted text-foreground flex size-10 shrink-0 items-center justify-center rounded-lg [&_svg:not([class*='size-'])]:size-6\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction EmptyMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof emptyMediaVariants>) {\n  return (\n    <div\n      data-slot=\"empty-icon\"\n      data-variant={variant}\n      className={cn(emptyMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-title\"\n      className={cn(\"text-lg font-medium tracking-tight\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <div\n      data-slot=\"empty-description\"\n      className={cn(\n        \"text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction EmptyContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"empty-content\"\n      className={cn(\n        \"flex w-full min-w-0 max-w-sm flex-col items-center gap-4 text-balance text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Empty,\n  EmptyHeader,\n  EmptyTitle,\n  EmptyDescription,\n  EmptyContent,\n  EmptyMedia,\n}\n","path":null,"size_bytes":2396,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n\" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n           // @replit: no hover, and add primary border\n           \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-sm border-destructive-border\",\n        outline:\n          // @replit Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color. Uses shadow-xs. no shadow on active\n          // No hover state\n          \" border [border-color:var(--button-outline)] shadow-xs active:shadow-none \",\n        secondary:\n          // @replit border, no hover, no shadow, secondary border.\n          \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // @replit no hover, transparent border\n        ghost: \"border border-transparent\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        // @replit changed sizes\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2356,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/layout/DashboardLayout.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  LayoutDashboard,\n  Package,\n  Settings,\n  Users,\n  Store,\n  LogOut,\n  Menu,\n  X,\n  Wallet,\n  Shield,\n  ClipboardList,\n  Smartphone,\n  MapPin,\n  FileText,\n  ShoppingBag,\n  MessageCircle,\n  Star\n} from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport logoUrl from \"@assets/شعار_غلوردا_1764881546720.jpg\";\n\ninterface DashboardLayoutProps {\n  children: React.ReactNode;\n  role: \"merchant\" | \"admin\";\n}\n\nexport default function DashboardLayout({ children, role }: DashboardLayoutProps) {\n  const [location] = useLocation();\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n\n  const merchantLinks = [\n    { href: \"/dashboard\", label: \"لوحة التحكم\", icon: LayoutDashboard },\n    { href: \"/dashboard/products\", label: \"المنتجات\", icon: Package },\n    { href: \"/dashboard/orders\", label: \"الطلبات\", icon: ShoppingBag },\n    { href: \"/dashboard/reviews\", label: \"التقييمات\", icon: Star },\n    { href: \"/dashboard/messages\", label: \"الرسائل\", icon: MessageCircle },\n    { href: \"/dashboard/wallet\", label: \"المحفظة\", icon: Wallet },\n    { href: \"/dashboard/settings\", label: \"إعدادات المتجر\", icon: Settings },\n  ];\n\n  const adminLinks = [\n    { href: \"/admin\", label: \"نظرة عامة\", icon: LayoutDashboard },\n    { href: \"/admin/pending\", label: \"طلبات التسجيل\", icon: ClipboardList },\n    { href: \"/admin/merchants\", label: \"التجار\", icon: Store },\n    { href: \"/admin/customers\", label: \"العملاء\", icon: Users },\n    { href: \"/admin/orders\", label: \"الطلبات\", icon: ShoppingBag },\n    { href: \"/admin/withdrawals\", label: \"المحافظ والسحب\", icon: Wallet },\n    { href: \"/admin/app-settings\", label: \"إعدادات التطبيق\", icon: Smartphone },\n    { href: \"/admin/cities\", label: \"المدن\", icon: MapPin },\n    { href: \"/admin/policies\", label: \"السياسات والشروط\", icon: FileText },\n    { href: \"/admin/settings\", label: \"الإعدادات\", icon: Settings },\n  ];\n\n  const links = role === \"admin\" ? adminLinks : merchantLinks;\n\n  return (\n    <div className=\"min-h-screen bg-muted/10 flex\" dir=\"rtl\">\n      {/* Mobile Sidebar Overlay */}\n      {sidebarOpen && (\n        <div \n          className=\"fixed inset-0 bg-black/50 z-40 md:hidden backdrop-blur-sm\"\n          onClick={() => setSidebarOpen(false)}\n        />\n      )}\n\n      {/* Sidebar */}\n      <aside \n        className={cn(\n          \"fixed inset-y-0 right-0 z-50 w-64 bg-sidebar border-l border-sidebar-border transition-transform duration-200 ease-in-out md:translate-x-0 md:static md:flex md:flex-col shadow-xl md:shadow-none\",\n          sidebarOpen ? \"translate-x-0\" : \"translate-x-full\"\n        )}\n      >\n        <div className=\"h-20 flex items-center px-6 border-b border-sidebar-border bg-sidebar\">\n          <div className=\"flex items-center gap-3 font-bold text-xl text-sidebar-primary\">\n            <div className=\"w-10 h-10 rounded-full overflow-hidden border-2 border-sidebar-primary/20\">\n              <img src={logoUrl} alt=\"Logo\" className=\"w-full h-full object-cover\" />\n            </div>\n            <span className=\"font-display text-foreground\">غلوردا</span>\n          </div>\n          <Button \n            variant=\"ghost\" \n            size=\"icon\" \n            className=\"mr-auto md:hidden\"\n            onClick={() => setSidebarOpen(false)}\n          >\n            <X className=\"w-5 h-5\" />\n          </Button>\n        </div>\n\n        <div className=\"flex-1 overflow-y-auto py-6 px-4\">\n          <nav className=\"space-y-1\">\n            {links.map((link) => {\n              const Icon = link.icon;\n              const isActive = location === link.href;\n              return (\n                <Link key={link.href} href={link.href}>\n                  <div \n                    className={cn(\n                      \"flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all cursor-pointer\",\n                      isActive \n                        ? \"bg-sidebar-primary text-sidebar-primary-foreground shadow-md shadow-sidebar-primary/20\" \n                        : \"text-sidebar-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\"\n                    )}\n                  >\n                    <Icon className=\"w-5 h-5\" />\n                    {link.label}\n                  </div>\n                </Link>\n              );\n            })}\n          </nav>\n        </div>\n\n        <div className=\"p-4 border-t border-sidebar-border bg-sidebar-accent/10\">\n          <div className=\"flex items-center gap-3 p-2 rounded-md hover:bg-sidebar-accent/50 transition-colors cursor-pointer group\">\n            <Avatar className=\"w-9 h-9 border border-border\">\n              <AvatarImage src=\"https://github.com/shadcn.png\" />\n              <AvatarFallback>AD</AvatarFallback>\n            </Avatar>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-sm font-medium truncate text-sidebar-foreground\">أحمد محمد</p>\n              <p className=\"text-xs text-muted-foreground truncate\">\n                {role === 'admin' ? 'مدير النظام' : 'متجر الأناقة'}\n              </p>\n            </div>\n            <Link href=\"/\">\n              <LogOut className=\"w-4 h-4 text-muted-foreground group-hover:text-destructive transition-colors\" />\n            </Link>\n          </div>\n        </div>\n      </aside>\n\n      {/* Main Content */}\n      <main className=\"flex-1 flex flex-col min-w-0 overflow-hidden\">\n        <header className=\"h-16 border-b bg-background/80 backdrop-blur-md flex items-center justify-between px-6 md:px-8 sticky top-0 z-30\">\n          <Button \n            variant=\"ghost\" \n            size=\"icon\" \n            className=\"md:hidden -mr-2\"\n            onClick={() => setSidebarOpen(true)}\n          >\n            <Menu className=\"w-5 h-5\" />\n          </Button>\n\n          <div className=\"flex items-center gap-4 mr-auto\">\n            {/* Add Header Actions here if needed */}\n          </div>\n        </header>\n\n        <div className=\"flex-1 overflow-y-auto p-4 md:p-8 scroll-smooth\">\n          <div className=\"max-w-6xl mx-auto animate-in fade-in slide-in-from-bottom-4 duration-500\">\n            {children}\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":6530,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/index.css":{"content":"@import \"tailwindcss\";\n@import \"tw-animate-css\";\n\n@custom-variant dark (&:is(.dark *));\n\n@theme inline {\n  --radius-sm: calc(var(--radius) - 4px);\n  --radius-md: calc(var(--radius) - 2px);\n  --radius-lg: var(--radius);\n  --radius-xl: calc(var(--radius) + 4px);\n  \n  --color-background: hsl(var(--background));\n  --color-foreground: hsl(var(--foreground));\n  \n  --color-card: hsl(var(--card));\n  --color-card-foreground: hsl(var(--card-foreground));\n  \n  --color-popover: hsl(var(--popover));\n  --color-popover-foreground: hsl(var(--popover-foreground));\n  \n  --color-primary: hsl(var(--primary));\n  --color-primary-foreground: hsl(var(--primary-foreground));\n  \n  --color-secondary: hsl(var(--secondary));\n  --color-secondary-foreground: hsl(var(--secondary-foreground));\n  \n  --color-muted: hsl(var(--muted));\n  --color-muted-foreground: hsl(var(--muted-foreground));\n  \n  --color-accent: hsl(var(--accent));\n  --color-accent-foreground: hsl(var(--accent-foreground));\n  \n  --color-destructive: hsl(var(--destructive));\n  --color-destructive-foreground: hsl(var(--destructive-foreground));\n  \n  --color-border: hsl(var(--border));\n  --color-input: hsl(var(--input));\n  --color-ring: hsl(var(--ring));\n  \n  --color-chart-1: hsl(var(--chart-1));\n  --color-chart-2: hsl(var(--chart-2));\n  --color-chart-3: hsl(var(--chart-3));\n  --color-chart-4: hsl(var(--chart-4));\n  --color-chart-5: hsl(var(--chart-5));\n  \n  --color-sidebar: hsl(var(--sidebar));\n  --color-sidebar-foreground: hsl(var(--sidebar-foreground));\n  --color-sidebar-primary: hsl(var(--sidebar-primary));\n  --color-sidebar-primary-foreground: hsl(var(--sidebar-primary-foreground));\n  --color-sidebar-accent: hsl(var(--sidebar-accent));\n  --color-sidebar-accent-foreground: hsl(var(--sidebar-accent-foreground));\n  --color-sidebar-border: hsl(var(--sidebar-border));\n  --color-sidebar-ring: hsl(var(--sidebar-ring));\n\n  --font-sans: 'Cairo', sans-serif;\n  --font-display: 'Cairo', sans-serif;\n}\n\n:root {\n  /* Brand Theme - Based on Logo (Crimson/Red) */\n  --background: 0 0% 100%;\n  --foreground: 345 40% 10%;\n\n  --card: 0 0% 100%;\n  --card-foreground: 345 40% 10%;\n\n  --popover: 0 0% 100%;\n  --popover-foreground: 345 40% 10%;\n\n  /* Brand Red from Logo */\n  --primary: 345 85% 45%;\n  --primary-foreground: 0 0% 100%;\n\n  --secondary: 345 10% 96%;\n  --secondary-foreground: 345 40% 10%;\n\n  --muted: 345 10% 96%;\n  --muted-foreground: 345 10% 50%;\n\n  --accent: 345 10% 96%;\n  --accent-foreground: 345 85% 45%;\n\n  --destructive: 0 84% 60%;\n  --destructive-foreground: 0 0% 98%;\n\n  --border: 345 10% 90%;\n  --input: 345 10% 90%;\n  --ring: 345 85% 45%;\n\n  --radius: 0.75rem;\n\n  /* Sidebar */\n  --sidebar: 0 0% 99%;\n  --sidebar-foreground: 345 40% 15%;\n  --sidebar-primary: 345 85% 45%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 345 10% 94%;\n  --sidebar-accent-foreground: 345 85% 45%;\n  --sidebar-border: 345 10% 90%;\n  --sidebar-ring: 345 85% 45%;\n\n  /* Charts */\n  --chart-1: 345 85% 45%;\n  --chart-2: 330 60% 45%;\n  --chart-3: 300 50% 45%;\n  --chart-4: 345 85% 70%;\n  --chart-5: 345 85% 85%;\n}\n\n.dark {\n  --background: 345 40% 5%;\n  --foreground: 345 10% 98%;\n\n  --card: 345 40% 8%;\n  --card-foreground: 345 10% 98%;\n\n  --popover: 345 40% 8%;\n  --popover-foreground: 345 10% 98%;\n\n  --primary: 345 85% 55%;\n  --primary-foreground: 0 0% 100%;\n\n  --secondary: 345 20% 15%;\n  --secondary-foreground: 345 10% 98%;\n\n  --muted: 345 20% 15%;\n  --muted-foreground: 345 10% 65%;\n\n  --accent: 345 20% 15%;\n  --accent-foreground: 345 10% 98%;\n\n  --destructive: 0 62% 30%;\n  --destructive-foreground: 345 10% 98%;\n\n  --border: 345 20% 15%;\n  --input: 345 20% 15%;\n  --ring: 345 85% 55%;\n\n  --sidebar: 345 40% 8%;\n  --sidebar-foreground: 345 10% 98%;\n  --sidebar-primary: 345 85% 55%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 345 20% 15%;\n  --sidebar-accent-foreground: 345 10% 98%;\n  --sidebar-border: 345 20% 15%;\n  --sidebar-ring: 345 85% 55%;\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n","path":null,"size_bytes":4068,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-primary/20\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":792,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Portal>\n    <TooltipPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </TooltipPrimitive.Portal>\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1267,"size_tokens":null},"client/src/pages/auth/Login.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Link, useLocation } from \"wouter\";\nimport { Store, ShieldCheck, Loader2, Eye, EyeOff, FileText } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport logoUrl from \"@assets/شعار_غلوردا_1764881546720.jpg\";\n\nconst formSchema = z.object({\n  email: z.string().email({ message: \"البريد الإلكتروني غير صالح\" }),\n  password: z.string().min(1, { message: \"كلمة المرور مطلوبة\" }),\n});\n\nexport default function Login() {\n  const [, setLocation] = useLocation();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [showPassword, setShowPassword] = useState(false);\n  const [showTermsDialog, setShowTermsDialog] = useState(false);\n  const { toast } = useToast();\n  const { refetch } = useAuth();\n\n  const { data: termsData } = useQuery({\n    queryKey: [\"/api/public/settings/merchant_terms_conditions\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/public/settings/merchant_terms_conditions\");\n      if (!res.ok) return { value: \"\" };\n      return res.json();\n    },\n    staleTime: 0,\n    refetchOnMount: \"always\"\n  });\n\n  const form = useForm<z.infer<typeof formSchema>>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      email: \"\",\n      password: \"\",\n    },\n  });\n\n  async function onSubmit(values: z.infer<typeof formSchema>) {\n    setIsSubmitting(true);\n    \n    try {\n      const response = await fetch(\"/api/auth/login/merchant\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify(values),\n      });\n      \n      const data = await response.json();\n      \n      if (!response.ok) {\n        toast({\n          variant: \"destructive\",\n          title: \"خطأ في تسجيل الدخول\",\n          description: data.error || \"حدث خطأ ما\",\n        });\n        return;\n      }\n      \n      toast({\n        title: \"تم تسجيل الدخول بنجاح\",\n        description: `مرحباً ${data.merchant.storeName}`,\n      });\n      \n      await refetch();\n      setTimeout(() => {\n        setLocation(\"/dashboard\");\n      }, 100);\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"خطأ\",\n        description: \"فشل الاتصال بالخادم\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-muted/30 p-4\" dir=\"rtl\">\n      <div className=\"w-full max-w-md space-y-8\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"flex justify-center\">\n            <div className=\"w-24 h-24 rounded-full overflow-hidden border-4 border-white shadow-lg animate-in zoom-in duration-500\">\n              <img src={logoUrl} alt=\"Logo\" className=\"w-full h-full object-cover\" data-testid=\"img-logo\" />\n            </div>\n          </div>\n          <h1 className=\"text-3xl font-bold tracking-tight font-display text-primary\">أهلاً بك</h1>\n          <p className=\"text-muted-foreground\">سجل دخولك للمتابعة إلى لوحة التحكم</p>\n        </div>\n\n        <Card className=\"border-none shadow-xl overflow-hidden\">\n          <div className=\"h-1 bg-primary w-full\" />\n          <CardHeader>\n            <CardTitle>تسجيل الدخول</CardTitle>\n            <CardDescription>أدخل بيانات حسابك</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>البريد الإلكتروني</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"name@example.com\" {...field} className=\"bg-background/50 font-mono text-right\" data-testid=\"input-email\" />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"password\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>كلمة المرور</FormLabel>\n                      <FormControl>\n                        <div className=\"relative\">\n                          <Input \n                            type={showPassword ? \"text\" : \"password\"} \n                            placeholder=\"••••••••\" \n                            {...field} \n                            className=\"bg-background/50 pl-10\" \n                            data-testid=\"input-password\" \n                          />\n                          <Button\n                            type=\"button\"\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            className=\"absolute left-1 top-1/2 -translate-y-1/2 h-7 w-7\"\n                            onClick={() => setShowPassword(!showPassword)}\n                            data-testid=\"button-toggle-password\"\n                          >\n                            {showPassword ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n                          </Button>\n                        </div>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                <Button type=\"submit\" className=\"w-full h-12 text-base font-display rounded-xl bg-primary hover:bg-primary/90 shadow-lg shadow-primary/25 transition-all duration-200\" disabled={isSubmitting} data-testid=\"button-submit\">\n                  {isSubmitting ? <Loader2 className=\"w-5 h-5 animate-spin\" /> : \"تسجيل الدخول\"}\n                </Button>\n                \n                <div className=\"text-center\">\n                  <Link href=\"/forgot-password\" className=\"text-sm text-muted-foreground hover:text-primary transition-colors\" data-testid=\"link-forgot-password\">\n                    نسيت كلمة المرور؟\n                  </Link>\n                </div>\n              </form>\n            </Form>\n            <div className=\"mt-6 text-center text-sm text-muted-foreground space-y-3\">\n              <div>\n                ليس لديك حساب؟{\" \"}\n                <Link href=\"/register\" className=\"text-primary hover:underline font-medium\" data-testid=\"link-register\">\n                  سجل الآن كتاجر\n                </Link>\n              </div>\n              <div>\n                <Button\n                  type=\"button\"\n                  variant=\"link\"\n                  className=\"text-muted-foreground hover:text-primary text-sm p-0 h-auto\"\n                  onClick={() => setShowTermsDialog(true)}\n                  data-testid=\"button-view-terms\"\n                >\n                  <FileText className=\"w-3 h-3 ml-1\" />\n                  الشروط والأحكام\n                </Button>\n              </div>\n              <div className=\"pt-3 border-t\">\n                <Link href=\"/admin/login\">\n                  <Button variant=\"ghost\" size=\"sm\" className=\"gap-2 text-muted-foreground hover:text-foreground\" data-testid=\"link-admin-login\">\n                    <ShieldCheck className=\"w-4 h-4\" />\n                    دخول الإدارة\n                  </Button>\n                </Link>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Dialog open={showTermsDialog} onOpenChange={setShowTermsDialog}>\n          <DialogContent className=\"max-w-2xl max-h-[80vh]\" dir=\"rtl\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <FileText className=\"w-5 h-5\" />\n                الشروط والأحكام\n              </DialogTitle>\n            </DialogHeader>\n            <ScrollArea className=\"h-[60vh] pr-4\">\n              <div className=\"prose prose-sm max-w-none text-right whitespace-pre-wrap\">\n                {termsData?.value || \"لم يتم إضافة الشروط والأحكام بعد.\"}\n              </div>\n            </ScrollArea>\n            <div className=\"flex justify-end pt-4 border-t\">\n              <Button onClick={() => setShowTermsDialog(false)} data-testid=\"button-close-terms\">\n                إغلاق\n              </Button>\n            </div>\n          </DialogContent>\n        </Dialog>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":9332,"size_tokens":null},"client/src/pages/admin/Admins.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport { \n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogTrigger,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Plus, Trash2, Loader2, Shield, UserPlus } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\n\ninterface Admin {\n  id: number;\n  email: string;\n  name: string;\n  createdAt: string;\n}\n\nexport default function AdminAdmins() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [isAddOpen, setIsAddOpen] = useState(false);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    email: \"\",\n    password: \"\"\n  });\n\n  const { data: admins = [], isLoading } = useQuery<Admin[]>({\n    queryKey: [\"/api/admin/admins\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/admins\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch admins\");\n      return res.json();\n    }\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await fetch(\"/api/admin/admins\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify(data)\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to create admin\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/admins\"] });\n      toast({ title: \"تم إضافة المسؤول بنجاح\", className: \"bg-emerald-50 border-emerald-200 text-emerald-800\" });\n      setIsAddOpen(false);\n      setFormData({ name: \"\", email: \"\", password: \"\" });\n    },\n    onError: (error: Error) => {\n      toast({ variant: \"destructive\", title: error.message });\n    }\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const res = await fetch(`/api/admin/admins/${id}`, {\n        method: \"DELETE\",\n        credentials: \"include\"\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to delete admin\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/admins\"] });\n      toast({ title: \"تم حذف المسؤول\" });\n    },\n    onError: (error: Error) => {\n      toast({ variant: \"destructive\", title: error.message });\n    }\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!formData.name || !formData.email || !formData.password) {\n      toast({ variant: \"destructive\", title: \"جميع الحقول مطلوبة\" });\n      return;\n    }\n    if (formData.password.length < 6) {\n      toast({ variant: \"destructive\", title: \"كلمة المرور يجب أن تكون 6 أحرف على الأقل\" });\n      return;\n    }\n    createMutation.mutate(formData);\n  };\n\n  return (\n    <DashboardLayout role=\"admin\">\n      <div className=\"space-y-8\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight font-display\">المسؤولين</h2>\n            <p className=\"text-muted-foreground mt-2\">إدارة حسابات مسؤولي لوحة التحكم</p>\n          </div>\n          \n          <Dialog open={isAddOpen} onOpenChange={setIsAddOpen}>\n            <DialogTrigger asChild>\n              <Button className=\"gap-2\" data-testid=\"button-add-admin\">\n                <UserPlus className=\"w-4 h-4\" />\n                إضافة مسؤول\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>إضافة مسؤول جديد</DialogTitle>\n                <DialogDescription>أدخل بيانات المسؤول الجديد للوصول إلى لوحة التحكم</DialogDescription>\n              </DialogHeader>\n              <form onSubmit={handleSubmit} className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"name\">الاسم</Label>\n                  <Input\n                    id=\"name\"\n                    placeholder=\"اسم المسؤول\"\n                    value={formData.name}\n                    onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n                    data-testid=\"input-admin-name\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"email\">البريد الإلكتروني</Label>\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    placeholder=\"admin@example.com\"\n                    value={formData.email}\n                    onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}\n                    data-testid=\"input-admin-email\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"password\">كلمة المرور</Label>\n                  <Input\n                    id=\"password\"\n                    type=\"password\"\n                    placeholder=\"كلمة مرور قوية\"\n                    value={formData.password}\n                    onChange={(e) => setFormData(prev => ({ ...prev, password: e.target.value }))}\n                    data-testid=\"input-admin-password\"\n                  />\n                </div>\n                <DialogFooter>\n                  <Button type=\"submit\" disabled={createMutation.isPending} data-testid=\"button-submit-admin\">\n                    {createMutation.isPending && <Loader2 className=\"w-4 h-4 animate-spin ml-2\" />}\n                    إضافة المسؤول\n                  </Button>\n                </DialogFooter>\n              </form>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex justify-center py-12\">\n            <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n          </div>\n        ) : admins.length === 0 ? (\n          <div className=\"text-center py-12 border rounded-lg bg-muted/20\">\n            <Shield className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n            <h3 className=\"font-semibold text-lg\">لا يوجد مسؤولين</h3>\n            <p className=\"text-muted-foreground\">قم بإضافة مسؤول جديد للبدء</p>\n          </div>\n        ) : (\n          <div className=\"rounded-md border bg-card\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead className=\"text-right\">المسؤول</TableHead>\n                  <TableHead className=\"text-right\">البريد الإلكتروني</TableHead>\n                  <TableHead className=\"text-right\">تاريخ الإضافة</TableHead>\n                  <TableHead className=\"text-right\">إجراءات</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {admins.map((admin) => (\n                  <TableRow key={admin.id} data-testid={`row-admin-${admin.id}`}>\n                    <TableCell>\n                      <div className=\"flex items-center gap-3\">\n                        <Avatar className=\"h-9 w-9\">\n                          <AvatarFallback className=\"bg-primary/10 text-primary\">\n                            {admin.name.charAt(0)}\n                          </AvatarFallback>\n                        </Avatar>\n                        <span className=\"font-medium\">{admin.name}</span>\n                      </div>\n                    </TableCell>\n                    <TableCell className=\"font-mono text-sm\">{admin.email}</TableCell>\n                    <TableCell className=\"font-mono text-sm\">\n                      {new Date(admin.createdAt).toLocaleDateString('ar-SA')}\n                    </TableCell>\n                    <TableCell>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"text-destructive hover:text-destructive hover:bg-destructive/10\"\n                        onClick={() => deleteMutation.mutate(admin.id)}\n                        disabled={deleteMutation.isPending}\n                        data-testid={`button-delete-admin-${admin.id}`}\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                      </Button>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </div>\n        )}\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":9216,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // @replit\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \",\n  {\n    variants: {\n      variant: {\n        default:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary:\n          // @replit no hover because we use hover-elevate\n          \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          // @replit shadow-xs instead of shadow, no hover because we use hover-elevate\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n          // @replit shadow-xs\" - use badge outline variable\n        outline: \"text-foreground border [border-color:var(--badge-outline)]\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1522,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport tailwindcss from \"@tailwindcss/vite\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\nimport { metaImagesPlugin } from \"./vite-plugin-meta-images\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    tailwindcss(),\n    metaImagesPlugin(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  css: {\n    postcss: {\n      plugins: [],\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    host: \"0.0.0.0\",\n    allowedHosts: true,\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1330,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"import * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload\n            .filter((item) => item.type !== \"none\")\n            .map((item, index) => {\n              const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n              const itemConfig = getPayloadConfigFromPayload(config, item, key)\n              const indicatorColor = color || item.payload.fill || item.color\n\n              return (\n                <div\n                  key={item.dataKey}\n                  className={cn(\n                    \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                    indicator === \"dot\" && \"items-center\"\n                  )}\n                >\n                  {formatter && item?.value !== undefined && item.name ? (\n                    formatter(item.value, item.name, item, index, item.payload)\n                  ) : (\n                    <>\n                      {itemConfig?.icon ? (\n                        <itemConfig.icon />\n                      ) : (\n                        !hideIndicator && (\n                          <div\n                            className={cn(\n                              \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                              {\n                                \"h-2.5 w-2.5\": indicator === \"dot\",\n                                \"w-1\": indicator === \"line\",\n                                \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                  indicator === \"dashed\",\n                                \"my-0.5\": nestLabel && indicator === \"dashed\",\n                              }\n                            )}\n                            style={\n                              {\n                                \"--color-bg\": indicatorColor,\n                                \"--color-border\": indicatorColor,\n                              } as React.CSSProperties\n                            }\n                          />\n                        )\n                      )}\n                      <div\n                        className={cn(\n                          \"flex flex-1 justify-between leading-none\",\n                          nestLabel ? \"items-end\" : \"items-center\"\n                        )}\n                      >\n                        <div className=\"grid gap-1.5\">\n                          {nestLabel ? tooltipLabel : null}\n                          <span className=\"text-muted-foreground\">\n                            {itemConfig?.label || item.name}\n                          </span>\n                        </div>\n                        {item.value && (\n                          <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                            {item.value.toLocaleString()}\n                          </span>\n                        )}\n                      </div>\n                    </>\n                  )}\n                </div>\n              )\n            })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload\n          .filter((item) => item.type !== \"none\")\n          .map((item) => {\n            const key = `${nameKey || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n            return (\n              <div\n                key={item.value}\n                className={cn(\n                  \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n                )}\n              >\n                {itemConfig?.icon && !hideIcon ? (\n                  <itemConfig.icon />\n                ) : (\n                  <div\n                    className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                    style={{\n                      backgroundColor: item.color,\n                    }}\n                  />\n                )}\n                {itemConfig?.label}\n              </div>\n            )\n          })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10763,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationLink,\n  PaginationItem,\n  PaginationPrevious,\n  PaginationNext,\n  PaginationEllipsis,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport session from \"express-session\";\nimport connectPgSimple from \"connect-pg-simple\";\nimport bcrypt from \"bcryptjs\";\nimport multer from \"multer\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport { \n  insertMerchantSchema, \n  insertProductSchema, \n  insertTransactionSchema,\n  insertBannerSchema,\n  insertCategorySchema,\n  insertCitySchema,\n  insertOrderMessageSchema\n} from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { fromZodError } from \"zod-validation-error\";\n\n// Configure multer for product image uploads\nconst uploadsDir = path.join(process.cwd(), \"uploads\", \"products\");\nif (!fs.existsSync(uploadsDir)) {\n  fs.mkdirSync(uploadsDir, { recursive: true });\n}\n\nconst productImageStorage = multer.diskStorage({\n  destination: (_req, _file, cb) => {\n    cb(null, uploadsDir);\n  },\n  filename: (_req, file, cb) => {\n    const uniqueSuffix = Date.now() + \"-\" + Math.round(Math.random() * 1e9);\n    cb(null, uniqueSuffix + path.extname(file.originalname));\n  }\n});\n\nconst productImageUpload = multer({\n  storage: productImageStorage,\n  limits: { fileSize: 5 * 1024 * 1024 }, // 5MB limit\n  fileFilter: (_req, file, cb) => {\n    const allowedTypes = [\"image/jpeg\", \"image/png\", \"image/gif\", \"image/webp\"];\n    if (allowedTypes.includes(file.mimetype)) {\n      cb(null, true);\n    } else {\n      cb(new Error(\"نوع الملف غير مدعوم. يرجى رفع صورة بصيغة JPEG, PNG, GIF أو WebP\"));\n    }\n  }\n});\n\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId?: number;\n    userType?: \"merchant\" | \"admin\";\n  }\n}\n\nexport async function registerRoutes(\n  httpServer: Server,\n  app: Express\n): Promise<Server> {\n  \n  const isProduction = process.env.NODE_ENV === \"production\";\n  const isReplit = !!process.env.REPL_SLUG;\n  \n  if (isProduction && !process.env.SESSION_SECRET) {\n    console.warn(\"WARNING: SESSION_SECRET is not set. Using default secret is NOT secure for production!\");\n  }\n  \n  if (isProduction && !process.env.DATABASE_URL) {\n    throw new Error(\"DATABASE_URL is required in production mode\");\n  }\n  \n  const PgSession = connectPgSimple(session);\n  \n  const sessionConfig: session.SessionOptions = {\n    secret: process.env.SESSION_SECRET || \"glorada-secret-key-change-in-production\",\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      secure: isProduction || isReplit,\n      httpOnly: true,\n      maxAge: 1000 * 60 * 60 * 24 * 7,\n      sameSite: isProduction || isReplit ? \"none\" : \"lax\",\n    }\n  };\n  \n  if (process.env.DATABASE_URL) {\n    sessionConfig.store = new PgSession({\n      conString: process.env.DATABASE_URL,\n      tableName: \"session\",\n      createTableIfMissing: true,\n    });\n  } else {\n    console.warn(\"WARNING: Using in-memory session store. Sessions will be lost on restart!\");\n  }\n  \n  app.use(session(sessionConfig));\n\n  const requireMerchant = (req: any, res: any, next: any) => {\n    if (!req.session.userId || req.session.userType !== \"merchant\") {\n      return res.status(401).json({ error: \"يجب تسجيل الدخول كتاجر\" });\n    }\n    next();\n  };\n\n  const requireAdmin = (req: any, res: any, next: any) => {\n    if (!req.session.userId || req.session.userType !== \"admin\") {\n      return res.status(401).json({ error: \"يجب تسجيل الدخول كمسؤول\" });\n    }\n    next();\n  };\n\n  // ========== AUTH ROUTES ==========\n  \n  app.post(\"/api/auth/register\", async (req, res) => {\n    try {\n      const data = insertMerchantSchema.parse(req.body);\n      \n      const existing = await storage.getMerchantByEmail(data.email);\n      if (existing) {\n        return res.status(400).json({ error: \"البريد الإلكتروني مستخدم بالفعل\" });\n      }\n      \n      const hashedPassword = await bcrypt.hash(data.password, 10);\n      const merchant = await storage.createMerchant({\n        ...data,\n        password: hashedPassword\n      });\n      const { password, ...merchantData } = merchant;\n      \n      res.json({ \n        success: true, \n        message: \"تم استلام طلبك بنجاح. سيتم إشعارك عند التفعيل.\",\n        merchant: merchantData \n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: fromZodError(error).message });\n      }\n      console.error(\"Registration error:\", error);\n      res.status(500).json({ error: \"فشل التسجيل\" });\n    }\n  });\n\n  app.post(\"/api/auth/login/merchant\", async (req, res) => {\n    try {\n      const { email, password } = req.body;\n      \n      if (!email || !password) {\n        return res.status(400).json({ error: \"البريد الإلكتروني وكلمة المرور مطلوبان\" });\n      }\n\n      const merchant = await storage.getMerchantByEmail(email);\n      if (!merchant) {\n        return res.status(401).json({ error: \"بيانات الدخول غير صحيحة\" });\n      }\n      \n      const isValidPassword = await bcrypt.compare(password, merchant.password);\n      if (!isValidPassword) {\n        return res.status(401).json({ error: \"بيانات الدخول غير صحيحة\" });\n      }\n\n      if (merchant.status !== \"active\") {\n        if (merchant.status === \"pending\") {\n          return res.status(403).json({ error: \"حسابك قيد المراجعة. يرجى انتظار موافقة الإدارة.\" });\n        }\n        return res.status(403).json({ error: \"حسابك موقوف. يرجى التواصل مع الإدارة.\" });\n      }\n\n      req.session.userId = merchant.id;\n      req.session.userType = \"merchant\";\n\n      req.session.save((err) => {\n        if (err) {\n          console.error(\"Session save error:\", err);\n          return res.status(500).json({ error: \"خطأ في حفظ الجلسة\" });\n        }\n        const { password: _, ...merchantData } = merchant;\n        res.json({ success: true, merchant: merchantData });\n      });\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      res.status(500).json({ error: \"فشل تسجيل الدخول\" });\n    }\n  });\n\n  app.post(\"/api/auth/login/admin\", async (req, res) => {\n    try {\n      const { email, password } = req.body;\n      \n      if (!email || !password) {\n        return res.status(400).json({ error: \"البريد الإلكتروني وكلمة المرور مطلوبان\" });\n      }\n\n      const admin = await storage.getAdminByEmail(email);\n      if (!admin) {\n        return res.status(401).json({ error: \"بيانات الدخول غير صحيحة\" });\n      }\n      \n      const isValidPassword = await bcrypt.compare(password, admin.password);\n      if (!isValidPassword) {\n        return res.status(401).json({ error: \"بيانات الدخول غير صحيحة\" });\n      }\n\n      req.session.userId = admin.id;\n      req.session.userType = \"admin\";\n\n      req.session.save((err) => {\n        if (err) {\n          console.error(\"Session save error:\", err);\n          return res.status(500).json({ error: \"خطأ في حفظ الجلسة\" });\n        }\n        const { password: _, ...adminData } = admin;\n        res.json({ success: true, admin: adminData });\n      });\n    } catch (error) {\n      console.error(\"Admin login error:\", error);\n      res.status(500).json({ error: \"فشل تسجيل الدخول\" });\n    }\n  });\n\n  app.post(\"/api/auth/logout\", (req, res) => {\n    req.session.destroy((err) => {\n      if (err) {\n        return res.status(500).json({ error: \"فشل تسجيل الخروج\" });\n      }\n      res.json({ success: true });\n    });\n  });\n\n  // Password Reset - OTP Storage (in-memory for MVP, use database/Redis in production)\n  const otpStore = new Map<string, { otp: string; expires: number; token?: string; attempts: number }>();\n  const rateLimitStore = new Map<string, { count: number; resetAt: number }>();\n\n  // Rate limiting helper (3 requests per 5 minutes per email)\n  const checkRateLimit = (email: string): boolean => {\n    const now = Date.now();\n    const limit = rateLimitStore.get(email);\n    \n    if (!limit || now > limit.resetAt) {\n      rateLimitStore.set(email, { count: 1, resetAt: now + 5 * 60 * 1000 });\n      return true;\n    }\n    \n    if (limit.count >= 3) {\n      return false;\n    }\n    \n    limit.count++;\n    return true;\n  };\n\n  app.post(\"/api/auth/forgot-password\", async (req, res) => {\n    try {\n      const { email } = req.body;\n      \n      if (!email) {\n        return res.status(400).json({ error: \"البريد الإلكتروني مطلوب\" });\n      }\n\n      // Rate limit check\n      if (!checkRateLimit(email)) {\n        return res.status(429).json({ error: \"تم تجاوز الحد المسموح، يرجى المحاولة لاحقاً\" });\n      }\n\n      const merchant = await storage.getMerchantByEmail(email);\n      if (!merchant) {\n        // Don't reveal if email exists or not for security\n        return res.json({ success: true, message: \"إذا كان البريد مسجلاً، سيتم إرسال رمز التحقق\" });\n      }\n\n      // Generate 6-digit OTP using crypto for better randomness\n      const otp = Math.floor(100000 + Math.random() * 900000).toString();\n      const expires = Date.now() + 10 * 60 * 1000; // 10 minutes\n\n      otpStore.set(email, { otp, expires, attempts: 0 });\n\n      // DEV MODE: Log OTP to console (replace with email service in production)\n      if (process.env.NODE_ENV !== 'production') {\n        console.log(`[DEV OTP] Password reset code for ${email}: ${otp}`);\n      }\n      // TODO: In production, integrate email service (SendGrid/Resend) to send OTP\n\n      res.json({ success: true, message: \"تم إرسال رمز التحقق\" });\n    } catch (error) {\n      console.error(\"Forgot password error:\", error);\n      res.status(500).json({ error: \"حدث خطأ\" });\n    }\n  });\n\n  app.post(\"/api/auth/verify-otp\", async (req, res) => {\n    try {\n      const { email, otp } = req.body;\n      \n      if (!email || !otp) {\n        return res.status(400).json({ error: \"البريد الإلكتروني ورمز التحقق مطلوبان\" });\n      }\n\n      const stored = otpStore.get(email);\n      \n      if (!stored) {\n        return res.status(400).json({ error: \"رمز التحقق غير صالح أو منتهي\" });\n      }\n\n      if (Date.now() > stored.expires) {\n        otpStore.delete(email);\n        return res.status(400).json({ error: \"رمز التحقق منتهي الصلاحية\" });\n      }\n\n      // Track failed attempts (max 5 attempts)\n      if (stored.otp !== otp) {\n        stored.attempts = (stored.attempts || 0) + 1;\n        if (stored.attempts >= 5) {\n          otpStore.delete(email);\n          return res.status(400).json({ error: \"تم تجاوز عدد المحاولات، يرجى طلب رمز جديد\" });\n        }\n        return res.status(400).json({ error: \"رمز التحقق غير صحيح\" });\n      }\n\n      // Generate reset token and clear OTP (one-time use)\n      const token = Math.random().toString(36).substring(2) + Date.now().toString(36);\n      otpStore.set(email, { \n        otp: '', // Clear OTP after successful verification\n        token, \n        expires: Date.now() + 15 * 60 * 1000, // 15 minutes for password reset\n        attempts: 0 \n      });\n\n      res.json({ success: true, token });\n    } catch (error) {\n      console.error(\"Verify OTP error:\", error);\n      res.status(500).json({ error: \"حدث خطأ\" });\n    }\n  });\n\n  app.post(\"/api/auth/reset-password\", async (req, res) => {\n    try {\n      const { email, token, password } = req.body;\n      \n      if (!email || !token || !password) {\n        return res.status(400).json({ error: \"جميع الحقول مطلوبة\" });\n      }\n\n      if (password.length < 6) {\n        return res.status(400).json({ error: \"كلمة المرور يجب أن تكون 6 أحرف على الأقل\" });\n      }\n\n      const stored = otpStore.get(email);\n      \n      if (!stored || stored.token !== token) {\n        return res.status(400).json({ error: \"رابط غير صالح\" });\n      }\n\n      if (Date.now() > stored.expires) {\n        otpStore.delete(email);\n        return res.status(400).json({ error: \"انتهت صلاحية الرابط\" });\n      }\n\n      const merchant = await storage.getMerchantByEmail(email);\n      if (!merchant) {\n        return res.status(400).json({ error: \"الحساب غير موجود\" });\n      }\n\n      const hashedPassword = await bcrypt.hash(password, 10);\n      await storage.updateMerchant(merchant.id, { password: hashedPassword });\n\n      otpStore.delete(email);\n\n      res.json({ success: true, message: \"تم إعادة تعيين كلمة المرور بنجاح\" });\n    } catch (error) {\n      console.error(\"Reset password error:\", error);\n      res.status(500).json({ error: \"فشل إعادة تعيين كلمة المرور\" });\n    }\n  });\n\n  app.get(\"/api/auth/me\", async (req, res) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ error: \"غير مسجل الدخول\" });\n      }\n\n      if (req.session.userType === \"merchant\") {\n        const merchant = await storage.getMerchant(req.session.userId);\n        if (!merchant) {\n          return res.status(404).json({ error: \"لم يتم العثور على التاجر\" });\n        }\n        const { password: _, ...merchantData } = merchant;\n        res.json({ user: merchantData, type: \"merchant\" });\n      } else if (req.session.userType === \"admin\") {\n        const admin = await storage.getAdmin(req.session.userId);\n        if (!admin) {\n          return res.status(404).json({ error: \"لم يتم العثور على المسؤول\" });\n        }\n        const { password: _, ...adminData } = admin;\n        res.json({ user: adminData, type: \"admin\" });\n      }\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب بيانات المستخدم\" });\n    }\n  });\n\n  // ========== MERCHANT STORE ROUTES ==========\n  \n  app.get(\"/api/merchant/profile\", requireMerchant, async (req, res) => {\n    try {\n      const merchant = await storage.getMerchant(req.session.userId!);\n      if (!merchant) {\n        return res.status(404).json({ error: \"لم يتم العثور على التاجر\" });\n      }\n      const { password: _, ...merchantData } = merchant;\n      res.json(merchantData);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب بيانات المتجر\" });\n    }\n  });\n\n  app.patch(\"/api/merchant/profile\", requireMerchant, async (req, res) => {\n    try {\n      const { storeName, username, bio, storeImage, socialLinks, city } = req.body;\n      await storage.updateMerchant(req.session.userId!, { storeName, username, bio, storeImage, socialLinks, city });\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"فشل تحديث بيانات المتجر\" });\n    }\n  });\n\n  app.get(\"/api/merchant/stats\", requireMerchant, async (req, res) => {\n    try {\n      const merchantId = req.session.userId!;\n      const [products, orders, transactions] = await Promise.all([\n        storage.getProductsByMerchant(merchantId),\n        storage.getOrdersByMerchant(merchantId),\n        storage.getTransactionsByMerchant(merchantId)\n      ]);\n\n      const merchant = await storage.getMerchant(merchantId);\n      const totalSales = transactions\n        .filter(t => t.type === \"sale\" && t.status === \"completed\")\n        .reduce((sum, t) => sum + t.amount, 0);\n      \n      const pendingOrders = orders.filter(o => o.status === \"pending\").length;\n      const completedOrders = orders.filter(o => o.status === \"completed\").length;\n\n      res.json({\n        productsCount: products.length,\n        ordersCount: orders.length,\n        pendingOrders,\n        completedOrders,\n        totalSales,\n        balance: merchant?.balance || 0,\n        recentOrders: orders.slice(0, 5),\n        recentTransactions: transactions.slice(0, 5)\n      });\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب الإحصائيات\" });\n    }\n  });\n\n  // ========== MERCHANT PRODUCTS ROUTES ==========\n  \n  app.get(\"/api/merchant/products\", requireMerchant, async (req, res) => {\n    try {\n      const products = await storage.getProductsByMerchant(req.session.userId!);\n      res.json(products);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب المنتجات\" });\n    }\n  });\n\n  app.post(\"/api/merchant/products\", requireMerchant, async (req, res) => {\n    try {\n      const data = insertProductSchema.parse({\n        ...req.body,\n        merchantId: req.session.userId,\n      });\n      \n      const product = await storage.createProduct(data);\n      res.json(product);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: fromZodError(error).message });\n      }\n      res.status(500).json({ error: \"فشل إضافة المنتج\" });\n    }\n  });\n\n  app.patch(\"/api/merchant/products/:id\", requireMerchant, async (req, res) => {\n    try {\n      const productId = parseInt(req.params.id);\n      const product = await storage.getProduct(productId);\n      \n      if (!product || product.merchantId !== req.session.userId) {\n        return res.status(404).json({ error: \"لم يتم العثور على المنتج\" });\n      }\n\n      await storage.updateProduct(productId, req.body);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"فشل تحديث المنتج\" });\n    }\n  });\n\n  app.delete(\"/api/merchant/products/:id\", requireMerchant, async (req, res) => {\n    try {\n      const productId = parseInt(req.params.id);\n      const product = await storage.getProduct(productId);\n      \n      if (!product || product.merchantId !== req.session.userId) {\n        return res.status(404).json({ error: \"لم يتم العثور على المنتج\" });\n      }\n\n      await storage.deleteProduct(productId);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"فشل حذف المنتج\" });\n    }\n  });\n\n  // ========== PRODUCT IMAGE UPLOAD ==========\n  \n  app.post(\"/api/merchant/products/upload-images\", requireMerchant, productImageUpload.array(\"images\", 5), (req, res) => {\n    try {\n      const files = req.files as Express.Multer.File[];\n      if (!files || files.length === 0) {\n        return res.status(400).json({ error: \"لم يتم رفع أي صور\" });\n      }\n\n      const imageUrls = files.map(file => `/uploads/products/${file.filename}`);\n      res.json({ success: true, images: imageUrls });\n    } catch (error) {\n      console.error(\"Upload error:\", error);\n      res.status(500).json({ error: \"فشل رفع الصور\" });\n    }\n  });\n\n  // Serve uploaded files\n  const express = await import(\"express\");\n  app.use(\"/uploads\", express.default.static(path.join(process.cwd(), \"uploads\")));\n\n  // ========== MERCHANT ORDERS ROUTES ==========\n  \n  app.get(\"/api/merchant/orders\", requireMerchant, async (req, res) => {\n    try {\n      const orders = await storage.getOrdersByMerchant(req.session.userId!);\n      const ordersWithDetails = await Promise.all(\n        orders.map(async (order) => {\n          const customer = await storage.getCustomer(order.customerId);\n          const product = await storage.getProduct(order.productId);\n          return {\n            ...order,\n            customer: customer ? { id: customer.id, name: customer.name, mobile: customer.mobile, city: customer.city } : null,\n            product: product ? { id: product.id, name: product.name, price: product.price, images: product.images } : null,\n          };\n        })\n      );\n      res.json(ordersWithDetails);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب الطلبات\" });\n    }\n  });\n\n  // Get merchant conversations (orders with messages)\n  app.get(\"/api/merchant/conversations\", requireMerchant, async (req, res) => {\n    try {\n      const orders = await storage.getOrdersByMerchant(req.session.userId!);\n      const conversationsWithDetails = await Promise.all(\n        orders.map(async (order) => {\n          const customer = await storage.getCustomer(order.customerId);\n          const product = await storage.getProduct(order.productId);\n          const messages = await storage.getMessagesByOrder(order.id);\n          return {\n            ...order,\n            customer: customer ? { id: customer.id, name: customer.name, mobile: customer.mobile } : null,\n            product: product ? { id: product.id, name: product.name } : null,\n            messagesCount: messages.length,\n            lastMessage: messages.length > 0 ? messages[messages.length - 1] : null,\n          };\n        })\n      );\n      res.json(conversationsWithDetails);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب المحادثات\" });\n    }\n  });\n\n  app.patch(\"/api/merchant/orders/:id/status\", requireMerchant, async (req, res) => {\n    try {\n      const orderId = parseInt(req.params.id);\n      const { status } = req.body;\n      \n      const order = await storage.getOrder(orderId);\n      if (!order || order.merchantId !== req.session.userId) {\n        return res.status(404).json({ error: \"لم يتم العثور على الطلب\" });\n      }\n\n      await storage.updateOrderStatus(orderId, status);\n      \n      // If order is completed and paid, add to merchant balance\n      if (status === \"completed\" && order.isPaid) {\n        const merchant = await storage.getMerchant(req.session.userId!);\n        if (merchant) {\n          await storage.updateMerchantBalance(merchant.id, merchant.balance + order.totalAmount);\n          await storage.createTransaction({\n            merchantId: merchant.id,\n            orderId: orderId,\n            type: \"sale\",\n            amount: order.totalAmount,\n            status: \"completed\",\n            description: `طلب #${order.orderNumber}`\n          });\n        }\n      }\n      \n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"فشل تحديث حالة الطلب\" });\n    }\n  });\n\n  // Order messages\n  app.get(\"/api/merchant/orders/:id/messages\", requireMerchant, async (req, res) => {\n    try {\n      const orderId = parseInt(req.params.id);\n      const order = await storage.getOrder(orderId);\n      \n      if (!order || order.merchantId !== req.session.userId) {\n        return res.status(404).json({ error: \"لم يتم العثور على الطلب\" });\n      }\n\n      const messages = await storage.getMessagesByOrder(orderId);\n      res.json(messages);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب الرسائل\" });\n    }\n  });\n\n  app.post(\"/api/merchant/orders/:id/messages\", requireMerchant, async (req, res) => {\n    try {\n      const orderId = parseInt(req.params.id);\n      const order = await storage.getOrder(orderId);\n      \n      if (!order || order.merchantId !== req.session.userId) {\n        return res.status(404).json({ error: \"لم يتم العثور على الطلب\" });\n      }\n\n      const message = await storage.createMessage({\n        orderId,\n        senderId: req.session.userId!,\n        senderType: \"merchant\",\n        message: req.body.message\n      });\n      \n      res.json(message);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل إرسال الرسالة\" });\n    }\n  });\n\n  // Reviews for merchant products\n  app.get(\"/api/merchant/reviews\", requireMerchant, async (req, res) => {\n    try {\n      const reviews = await storage.getReviewsByMerchant(req.session.userId!);\n      res.json(reviews);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب التقييمات\" });\n    }\n  });\n\n  // ========== MERCHANT WALLET ROUTES ==========\n  \n  app.get(\"/api/merchant/transactions\", requireMerchant, async (req, res) => {\n    try {\n      const transactions = await storage.getTransactionsByMerchant(req.session.userId!);\n      res.json(transactions);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب المعاملات\" });\n    }\n  });\n\n  app.post(\"/api/merchant/withdraw\", requireMerchant, async (req, res) => {\n    try {\n      const { amount } = req.body;\n      \n      if (!amount || amount <= 0) {\n        return res.status(400).json({ error: \"المبلغ غير صالح\" });\n      }\n\n      const merchant = await storage.getMerchant(req.session.userId!);\n      if (!merchant || merchant.balance < amount) {\n        return res.status(400).json({ error: \"الرصيد غير كافي\" });\n      }\n\n      const transaction = await storage.createTransaction({\n        merchantId: req.session.userId!,\n        type: \"withdrawal\",\n        amount: -amount,\n        status: \"pending\",\n        description: \"طلب سحب رصيد\",\n      });\n\n      res.json(transaction);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل طلب السحب\" });\n    }\n  });\n\n  // ========== ADMIN MERCHANTS ROUTES ==========\n  \n  app.get(\"/api/admin/merchants\", requireAdmin, async (req, res) => {\n    try {\n      const merchants = await storage.getAllMerchants();\n      const merchantsWithoutPasswords = merchants.map(({ password, ...m }) => m);\n      res.json(merchantsWithoutPasswords);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب التجار\" });\n    }\n  });\n\n  app.patch(\"/api/admin/merchants/:id/status\", requireAdmin, async (req, res) => {\n    try {\n      const merchantId = parseInt(req.params.id);\n      const { status } = req.body;\n      \n      if (![\"pending\", \"active\", \"suspended\", \"review\"].includes(status)) {\n        return res.status(400).json({ error: \"حالة غير صالحة\" });\n      }\n\n      await storage.updateMerchantStatus(merchantId, status);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"فشل تحديث حالة التاجر\" });\n    }\n  });\n\n  // ========== ADMIN CUSTOMERS ROUTES ==========\n  \n  app.get(\"/api/admin/customers\", requireAdmin, async (req, res) => {\n    try {\n      const customers = await storage.getAllCustomers();\n      res.json(customers);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب العملاء\" });\n    }\n  });\n\n  // ========== ADMIN ORDERS ROUTES ==========\n  \n  app.get(\"/api/admin/orders\", requireAdmin, async (req, res) => {\n    try {\n      const orders = await storage.getAllOrders();\n      const ordersWithDetails = await Promise.all(\n        orders.map(async (order) => {\n          const customer = await storage.getCustomer(order.customerId);\n          const merchant = await storage.getMerchant(order.merchantId);\n          const product = await storage.getProduct(order.productId);\n          return {\n            ...order,\n            customer: customer ? { id: customer.id, name: customer.name, mobile: customer.mobile, city: customer.city } : null,\n            merchant: merchant ? { id: merchant.id, storeName: merchant.storeName, ownerName: merchant.ownerName } : null,\n            product: product ? { id: product.id, name: product.name, price: product.price, images: product.images } : null,\n          };\n        })\n      );\n      res.json(ordersWithDetails);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب الطلبات\" });\n    }\n  });\n\n  // ========== ADMIN WITHDRAWALS ROUTES ==========\n  \n  app.get(\"/api/admin/withdrawals\", requireAdmin, async (req, res) => {\n    try {\n      const withdrawals = await storage.getPendingWithdrawals();\n      res.json(withdrawals);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب طلبات السحب\" });\n    }\n  });\n\n  app.get(\"/api/admin/transactions\", requireAdmin, async (req, res) => {\n    try {\n      const transactions = await storage.getAllTransactions();\n      res.json(transactions);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب المعاملات\" });\n    }\n  });\n\n  app.patch(\"/api/admin/withdrawals/:id\", requireAdmin, async (req, res) => {\n    try {\n      const transactionId = parseInt(req.params.id);\n      const { status } = req.body;\n      \n      if (![\"completed\", \"rejected\"].includes(status)) {\n        return res.status(400).json({ error: \"حالة غير صالحة\" });\n      }\n\n      await storage.updateTransactionStatus(transactionId, status);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"فشل تحديث طلب السحب\" });\n    }\n  });\n\n  // ========== ADMIN MANAGEMENT ROUTES ==========\n  \n  app.get(\"/api/admin/admins\", requireAdmin, async (req, res) => {\n    try {\n      const admins = await storage.getAllAdmins();\n      const sanitizedAdmins = admins.map(({ password, ...admin }) => admin);\n      res.json(sanitizedAdmins);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب المسؤولين\" });\n    }\n  });\n\n  app.post(\"/api/admin/admins\", requireAdmin, async (req, res) => {\n    try {\n      const { email, password, name } = req.body;\n      \n      if (!email || !password || !name) {\n        return res.status(400).json({ error: \"جميع الحقول مطلوبة\" });\n      }\n\n      const existing = await storage.getAdminByEmail(email);\n      if (existing) {\n        return res.status(400).json({ error: \"البريد الإلكتروني مستخدم بالفعل\" });\n      }\n\n      const hashedPassword = await bcrypt.hash(password, 10);\n      const admin = await storage.createAdmin({\n        email,\n        password: hashedPassword,\n        name\n      });\n\n      const { password: _, ...adminData } = admin;\n      res.json(adminData);\n    } catch (error) {\n      console.error(\"Create admin error:\", error);\n      res.status(500).json({ error: \"فشل إضافة المسؤول\" });\n    }\n  });\n\n  app.delete(\"/api/admin/admins/:id\", requireAdmin, async (req, res) => {\n    try {\n      const adminId = parseInt(req.params.id);\n      \n      if (adminId === req.session.userId) {\n        return res.status(400).json({ error: \"لا يمكنك حذف حسابك الحالي\" });\n      }\n\n      await storage.deleteAdmin(adminId);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"فشل حذف المسؤول\" });\n    }\n  });\n\n  app.patch(\"/api/admin/password\", requireAdmin, async (req, res) => {\n    try {\n      const { currentPassword, newPassword } = req.body;\n      \n      if (!currentPassword || !newPassword) {\n        return res.status(400).json({ error: \"جميع الحقول مطلوبة\" });\n      }\n      \n      if (newPassword.length < 6) {\n        return res.status(400).json({ error: \"كلمة المرور الجديدة يجب أن تكون 6 أحرف على الأقل\" });\n      }\n\n      const admin = await storage.getAdmin(req.session.userId!);\n      if (!admin) {\n        return res.status(404).json({ error: \"لم يتم العثور على المسؤول\" });\n      }\n\n      const isValidPassword = await bcrypt.compare(currentPassword, admin.password);\n      if (!isValidPassword) {\n        return res.status(401).json({ error: \"كلمة المرور الحالية غير صحيحة\" });\n      }\n\n      const hashedPassword = await bcrypt.hash(newPassword, 10);\n      await storage.updateAdminPassword(req.session.userId!, hashedPassword);\n      \n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Change password error:\", error);\n      res.status(500).json({ error: \"فشل تغيير كلمة المرور\" });\n    }\n  });\n\n  // ========== ADMIN BANNERS ROUTES ==========\n  \n  app.get(\"/api/admin/banners\", requireAdmin, async (req, res) => {\n    try {\n      const banners = await storage.getAllBanners();\n      res.json(banners);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب البانرات\" });\n    }\n  });\n\n  app.post(\"/api/admin/banners\", requireAdmin, async (req, res) => {\n    try {\n      const data = insertBannerSchema.parse(req.body);\n      const banner = await storage.createBanner(data);\n      res.json(banner);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: fromZodError(error).message });\n      }\n      res.status(500).json({ error: \"فشل إضافة البانر\" });\n    }\n  });\n\n  app.patch(\"/api/admin/banners/:id\", requireAdmin, async (req, res) => {\n    try {\n      const bannerId = parseInt(req.params.id);\n      await storage.updateBanner(bannerId, req.body);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"فشل تحديث البانر\" });\n    }\n  });\n\n  app.delete(\"/api/admin/banners/:id\", requireAdmin, async (req, res) => {\n    try {\n      const bannerId = parseInt(req.params.id);\n      await storage.deleteBanner(bannerId);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"فشل حذف البانر\" });\n    }\n  });\n\n  // ========== ADMIN CATEGORIES ROUTES ==========\n  \n  app.get(\"/api/admin/categories\", requireAdmin, async (req, res) => {\n    try {\n      const categories = await storage.getAllCategories();\n      res.json(categories);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب الأقسام\" });\n    }\n  });\n\n  app.post(\"/api/admin/categories\", requireAdmin, async (req, res) => {\n    try {\n      const data = insertCategorySchema.parse(req.body);\n      const category = await storage.createCategory(data);\n      res.json(category);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: fromZodError(error).message });\n      }\n      res.status(500).json({ error: \"فشل إضافة القسم\" });\n    }\n  });\n\n  app.patch(\"/api/admin/categories/:id\", requireAdmin, async (req, res) => {\n    try {\n      const categoryId = parseInt(req.params.id);\n      await storage.updateCategory(categoryId, req.body);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"فشل تحديث القسم\" });\n    }\n  });\n\n  app.delete(\"/api/admin/categories/:id\", requireAdmin, async (req, res) => {\n    try {\n      const categoryId = parseInt(req.params.id);\n      await storage.deleteCategory(categoryId);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"فشل حذف القسم\" });\n    }\n  });\n\n  // ========== ADMIN CITIES ROUTES ==========\n  \n  app.get(\"/api/admin/cities\", requireAdmin, async (req, res) => {\n    try {\n      const cities = await storage.getAllCities();\n      res.json(cities);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب المدن\" });\n    }\n  });\n\n  app.post(\"/api/admin/cities\", requireAdmin, async (req, res) => {\n    try {\n      const data = insertCitySchema.parse(req.body);\n      const city = await storage.createCity(data);\n      res.json(city);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ error: fromZodError(error).message });\n      }\n      res.status(500).json({ error: \"فشل إضافة المدينة\" });\n    }\n  });\n\n  app.patch(\"/api/admin/cities/:id\", requireAdmin, async (req, res) => {\n    try {\n      const cityId = parseInt(req.params.id);\n      await storage.updateCity(cityId, req.body);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"فشل تحديث المدينة\" });\n    }\n  });\n\n  app.delete(\"/api/admin/cities/:id\", requireAdmin, async (req, res) => {\n    try {\n      const cityId = parseInt(req.params.id);\n      await storage.deleteCity(cityId);\n      res.json({ success: true });\n    } catch (error) {\n      res.status(500).json({ error: \"فشل حذف المدينة\" });\n    }\n  });\n\n  // ========== ADMIN SETTINGS ROUTES ==========\n  \n  app.get(\"/api/admin/settings\", requireAdmin, async (req, res) => {\n    try {\n      const settings = await storage.getAllSettings();\n      res.json(settings);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب الإعدادات\" });\n    }\n  });\n\n  app.post(\"/api/admin/settings\", requireAdmin, async (req, res) => {\n    try {\n      const { key, value, valueJson } = req.body;\n      const setting = await storage.setSetting(key, value, valueJson);\n      res.json(setting);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل حفظ الإعداد\" });\n    }\n  });\n\n  // ========== PUBLIC ROUTES (for mobile app) ==========\n  \n  app.get(\"/api/public/banners\", async (req, res) => {\n    try {\n      const banners = await storage.getActiveBanners();\n      res.json(banners);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب البانرات\" });\n    }\n  });\n\n  app.get(\"/api/public/categories\", async (req, res) => {\n    try {\n      const categories = await storage.getActiveCategories();\n      res.json(categories);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب الأقسام\" });\n    }\n  });\n\n  app.get(\"/api/public/cities\", async (req, res) => {\n    try {\n      const cities = await storage.getActiveCities();\n      res.json(cities);\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب المدن\" });\n    }\n  });\n\n  app.get(\"/api/public/settings/:key\", async (req, res) => {\n    try {\n      const setting = await storage.getSetting(req.params.key);\n      res.json(setting || { key: req.params.key, value: null });\n    } catch (error) {\n      res.status(500).json({ error: \"فشل جلب الإعداد\" });\n    }\n  });\n\n  // ========== SEED DEFAULT ADMIN ==========\n  const seedAdmin = async () => {\n    try {\n      const existingAdmin = await storage.getAdminByEmail(\"admin@glorda.com\");\n      if (!existingAdmin) {\n        const hashedPassword = await bcrypt.hash(\"admin123\", 10);\n        await storage.createAdmin({\n          email: \"admin@glorda.com\",\n          password: hashedPassword,\n          name: \"مدير النظام\"\n        });\n        console.log(\"Default admin created: admin@glorda.com / admin123\");\n      }\n    } catch (error) {\n      console.error(\"Failed to seed admin:\", error);\n    }\n  };\n  \n  seedAdmin();\n\n  return httpServer;\n}\n","path":null,"size_bytes":38202,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport NotFound from \"@/pages/not-found\";\nimport { AuthProvider, ProtectedRoute } from \"@/hooks/useAuth\";\n\n// Auth Pages\nimport Login from \"@/pages/auth/Login\";\nimport Register from \"@/pages/auth/Register\";\nimport ForgotPassword from \"@/pages/auth/ForgotPassword\";\nimport VerifyOTP from \"@/pages/auth/VerifyOTP\";\nimport ResetPassword from \"@/pages/auth/ResetPassword\";\n\n// Merchant Pages\nimport MerchantDashboard from \"@/pages/merchant/Dashboard\";\nimport MerchantProducts from \"@/pages/merchant/Products\";\nimport MerchantOrders from \"@/pages/merchant/Orders\";\nimport MerchantReviews from \"@/pages/merchant/Reviews\";\nimport MerchantMessages from \"@/pages/merchant/Messages\";\nimport MerchantWallet from \"@/pages/merchant/Wallet\";\nimport MerchantSettings from \"@/pages/merchant/Settings\";\nimport MerchantTerms from \"@/pages/merchant/Terms\";\n\n// Admin Pages\nimport AdminDashboard from \"@/pages/admin/Dashboard\";\nimport AdminMerchants from \"@/pages/admin/Merchants\";\nimport AdminPendingMerchants from \"@/pages/admin/PendingMerchants\";\nimport AdminAdmins from \"@/pages/admin/Admins\";\nimport AdminLogin from \"@/pages/admin/Login\";\nimport AdminSettings from \"@/pages/admin/Settings\";\nimport AdminAppSettings from \"@/pages/admin/AppSettings\";\nimport AdminCities from \"@/pages/admin/Cities\";\nimport AdminPolicies from \"@/pages/admin/Policies\";\nimport AdminWithdrawals from \"@/pages/admin/Withdrawals\";\nimport AdminCustomers from \"@/pages/admin/Customers\";\nimport AdminOrders from \"@/pages/admin/Orders\";\n\nfunction Router() {\n  return (\n    <Switch>\n      {/* Auth Routes */}\n      <Route path=\"/\" component={Login} />\n      <Route path=\"/register\" component={Register} />\n      <Route path=\"/forgot-password\" component={ForgotPassword} />\n      <Route path=\"/verify-otp\" component={VerifyOTP} />\n      <Route path=\"/reset-password\" component={ResetPassword} />\n\n      {/* Merchant Routes - Protected (specific routes first) */}\n      <Route path=\"/dashboard/products\">\n        <ProtectedRoute requiredRole=\"merchant\">\n          <MerchantProducts />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/dashboard/orders\">\n        <ProtectedRoute requiredRole=\"merchant\">\n          <MerchantOrders />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/dashboard/reviews\">\n        <ProtectedRoute requiredRole=\"merchant\">\n          <MerchantReviews />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/dashboard/messages\">\n        <ProtectedRoute requiredRole=\"merchant\">\n          <MerchantMessages />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/dashboard/wallet\">\n        <ProtectedRoute requiredRole=\"merchant\">\n          <MerchantWallet />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/dashboard/settings\">\n        <ProtectedRoute requiredRole=\"merchant\">\n          <MerchantSettings />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/dashboard/terms\">\n        <ProtectedRoute requiredRole=\"merchant\">\n          <MerchantTerms />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/dashboard\">\n        <ProtectedRoute requiredRole=\"merchant\">\n          <MerchantDashboard />\n        </ProtectedRoute>\n      </Route>\n      \n      {/* Admin Routes - Protected (specific routes first) */}\n      <Route path=\"/admin/login\" component={AdminLogin} />\n      <Route path=\"/admin/pending\">\n        <ProtectedRoute requiredRole=\"admin\">\n          <AdminPendingMerchants />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/admin/merchants\">\n        <ProtectedRoute requiredRole=\"admin\">\n          <AdminMerchants />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/admin/admins\">\n        <ProtectedRoute requiredRole=\"admin\">\n          <AdminAdmins />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/admin/settings\">\n        <ProtectedRoute requiredRole=\"admin\">\n          <AdminSettings />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/admin/app-settings\">\n        <ProtectedRoute requiredRole=\"admin\">\n          <AdminAppSettings />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/admin/cities\">\n        <ProtectedRoute requiredRole=\"admin\">\n          <AdminCities />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/admin/policies\">\n        <ProtectedRoute requiredRole=\"admin\">\n          <AdminPolicies />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/admin/withdrawals\">\n        <ProtectedRoute requiredRole=\"admin\">\n          <AdminWithdrawals />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/admin/customers\">\n        <ProtectedRoute requiredRole=\"admin\">\n          <AdminCustomers />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/admin/orders\">\n        <ProtectedRoute requiredRole=\"admin\">\n          <AdminOrders />\n        </ProtectedRoute>\n      </Route>\n      <Route path=\"/admin\">\n        <ProtectedRoute requiredRole=\"admin\">\n          <AdminDashboard />\n        </ProtectedRoute>\n      </Route>\n\n      {/* Fallback */}\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AuthProvider>\n        <TooltipProvider>\n          <Toaster />\n          <Router />\n        </TooltipProvider>\n      </AuthProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":5607,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic } from \"./static\";\nimport { createServer } from \"http\";\n\nconst app = express();\nconst httpServer = createServer(app);\n\n// Trust proxy for proper cookie handling behind reverse proxy\napp.set(\"trust proxy\", 1);\n\ndeclare module \"http\" {\n  interface IncomingMessage {\n    rawBody: unknown;\n  }\n}\n\napp.use(\n  express.json({\n    verify: (req, _res, buf) => {\n      req.rawBody = buf;\n    },\n  }),\n);\n\napp.use(express.urlencoded({ extended: false }));\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  await registerRoutes(httpServer, app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (process.env.NODE_ENV === \"production\") {\n    serveStatic(app);\n  } else {\n    const { setupVite } = await import(\"./vite\");\n    await setupVite(httpServer, app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || \"5000\", 10);\n  httpServer.listen(\n    {\n      port,\n      host: \"0.0.0.0\",\n      reusePort: true,\n    },\n    () => {\n      log(`serving on port ${port}`);\n    },\n  );\n})();\n","path":null,"size_bytes":2651,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1598,"size_tokens":null},"client/src/components/ui/item.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction ItemGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      role=\"list\"\n      data-slot=\"item-group\"\n      className={cn(\"group/item-group flex flex-col\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"item-separator\"\n      orientation=\"horizontal\"\n      className={cn(\"my-0\", className)}\n      {...props}\n    />\n  )\n}\n\nconst itemVariants = cva(\n  \"group/item [a]:hover:bg-accent/50 focus-visible:border-ring focus-visible:ring-ring/50 [a]:transition-colors flex flex-wrap items-center rounded-md border border-transparent text-sm outline-none transition-colors duration-100 focus-visible:ring-[3px]\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline: \"border-border\",\n        muted: \"bg-muted/50\",\n      },\n      size: {\n        default: \"gap-4 p-4 \",\n        sm: \"gap-2.5 px-4 py-3\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction Item({\n  className,\n  variant = \"default\",\n  size = \"default\",\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> &\n  VariantProps<typeof itemVariants> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n  return (\n    <Comp\n      data-slot=\"item\"\n      data-variant={variant}\n      data-size={size}\n      className={cn(itemVariants({ variant, size, className }))}\n      {...props}\n    />\n  )\n}\n\nconst itemMediaVariants = cva(\n  \"flex shrink-0 items-center justify-center gap-2 group-has-[[data-slot=item-description]]/item:translate-y-0.5 group-has-[[data-slot=item-description]]/item:self-start [&_svg]:pointer-events-none\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        icon: \"bg-muted size-8 rounded-sm border [&_svg:not([class*='size-'])]:size-4\",\n        image:\n          \"size-10 overflow-hidden rounded-sm [&_img]:size-full [&_img]:object-cover\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nfunction ItemMedia({\n  className,\n  variant = \"default\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof itemMediaVariants>) {\n  return (\n    <div\n      data-slot=\"item-media\"\n      data-variant={variant}\n      className={cn(itemMediaVariants({ variant, className }))}\n      {...props}\n    />\n  )\n}\n\nfunction ItemContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-content\"\n      className={cn(\n        \"flex flex-1 flex-col gap-1 [&+[data-slot=item-content]]:flex-none\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-title\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"item-description\"\n      className={cn(\n        \"text-muted-foreground line-clamp-2 text-balance text-sm font-normal leading-normal\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemActions({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-actions\"\n      className={cn(\"flex items-center gap-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction ItemHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-header\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction ItemFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"item-footer\"\n      className={cn(\n        \"flex basis-full items-center justify-between gap-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Item,\n  ItemMedia,\n  ItemContent,\n  ItemActions,\n  ItemGroup,\n  ItemSeparator,\n  ItemTitle,\n  ItemDescription,\n  ItemHeader,\n  ItemFooter,\n}\n","path":null,"size_bytes":4494,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7406,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"import * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8608,"size_tokens":null},"client/src/pages/merchant/Wallet.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Wallet, ArrowUpRight, ArrowDownLeft, CreditCard, DollarSign, Loader2, Activity } from \"lucide-react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Transaction, Merchant } from \"@shared/schema\";\n\nexport default function MerchantWallet() {\n  const [withdrawAmount, setWithdrawAmount] = useState(\"\");\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: profile } = useQuery<Merchant>({\n    queryKey: [\"/api/merchant/profile\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/merchant/profile\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch profile\");\n      return res.json();\n    }\n  });\n\n  const { data: transactions = [], isLoading } = useQuery<Transaction[]>({\n    queryKey: [\"/api/merchant/transactions\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/merchant/transactions\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch transactions\");\n      return res.json();\n    }\n  });\n\n  const withdrawMutation = useMutation({\n    mutationFn: async (amount: number) => {\n      const res = await fetch(\"/api/merchant/withdraw\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ amount })\n      });\n      if (!res.ok) {\n        const data = await res.json();\n        throw new Error(data.error || \"Failed to request withdrawal\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/merchant/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/merchant/profile\"] });\n      setWithdrawAmount(\"\");\n      toast({ title: \"تم إرسال طلب السحب بنجاح\" });\n    },\n    onError: (error: any) => {\n      toast({ variant: \"destructive\", title: \"خطأ\", description: error.message });\n    }\n  });\n\n  const handleWithdraw = (e: React.FormEvent) => {\n    e.preventDefault();\n    const amount = parseInt(withdrawAmount) * 100;\n    if (amount <= 0) {\n      toast({ variant: \"destructive\", title: \"المبلغ غير صالح\" });\n      return;\n    }\n    withdrawMutation.mutate(amount);\n  };\n\n  const balance = profile?.balance || 0;\n  const pendingWithdrawals = transactions\n    .filter(t => t.type === \"withdrawal\" && t.status === \"pending\")\n    .reduce((sum, t) => sum + Math.abs(t.amount), 0);\n  const completedWithdrawals = transactions\n    .filter(t => t.type === \"withdrawal\" && t.status === \"completed\")\n    .reduce((sum, t) => sum + Math.abs(t.amount), 0);\n\n  return (\n    <DashboardLayout role=\"merchant\">\n      <div className=\"space-y-8\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight font-display\">المحفظة الإلكترونية</h2>\n          <p className=\"text-muted-foreground mt-2\">متابعة الأرباح وطلب السحوبات المالية</p>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-3\">\n          <Card className=\"bg-primary text-primary-foreground border-none shadow-lg shadow-primary/20\">\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-primary-foreground/80\">الرصيد الحالي</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-3xl font-bold font-mono\" data-testid=\"text-balance\">\n                {(balance / 100).toFixed(2)} ر.س\n              </div>\n              <p className=\"text-xs mt-2 text-primary-foreground/60 flex items-center\">\n                <Wallet className=\"w-3 h-3 ml-1\" />\n                متاح للسحب\n              </p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">إجمالي السحوبات</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-3xl font-bold font-mono\" data-testid=\"text-completed-withdrawals\">\n                {(completedWithdrawals / 100).toFixed(2)} ر.س\n              </div>\n              <p className=\"text-xs mt-2 text-muted-foreground flex items-center\">\n                <ArrowUpRight className=\"w-3 h-3 ml-1 text-emerald-500\" />\n                تم تحويلها لحسابك البنكي\n              </p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">معلق</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-3xl font-bold font-mono\" data-testid=\"text-pending-withdrawals\">\n                {(pendingWithdrawals / 100).toFixed(2)} ر.س\n              </div>\n              <p className=\"text-xs mt-2 text-muted-foreground flex items-center\">\n                <Activity className=\"w-3 h-3 ml-1 text-amber-500\" />\n                بانتظار موافقة الإدارة\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"grid gap-8 md:grid-cols-3\">\n          <div className=\"md:col-span-2\">\n            <Card>\n              <CardHeader>\n                <CardTitle>سجل العمليات</CardTitle>\n                <CardDescription>آخر الحركات المالية على محفظتك</CardDescription>\n              </CardHeader>\n              <CardContent>\n                {isLoading ? (\n                  <div className=\"flex justify-center py-8\">\n                    <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n                  </div>\n                ) : transactions.length === 0 ? (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    لا توجد عمليات بعد\n                  </div>\n                ) : (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead className=\"text-right\">العملية</TableHead>\n                        <TableHead className=\"text-right\">التاريخ</TableHead>\n                        <TableHead className=\"text-right\">الحالة</TableHead>\n                        <TableHead className=\"text-right\">المبلغ</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {transactions.map((trx) => (\n                        <TableRow key={trx.id} data-testid={`row-transaction-${trx.id}`}>\n                          <TableCell>\n                            <div className=\"flex items-center gap-2\">\n                              <div className={`p-2 rounded-full ${trx.type === 'sale' ? 'bg-emerald-100 text-emerald-600' : 'bg-amber-100 text-amber-600'}`}>\n                                {trx.type === 'sale' ? <ArrowDownLeft className=\"w-4 h-4\" /> : <ArrowUpRight className=\"w-4 h-4\" />}\n                              </div>\n                              <div className=\"flex flex-col\">\n                                <span className=\"font-medium text-sm\">{trx.description}</span>\n                                <span className=\"text-xs text-muted-foreground font-mono\">#{trx.id}</span>\n                              </div>\n                            </div>\n                          </TableCell>\n                          <TableCell className=\"font-mono text-sm text-muted-foreground\">\n                            {new Date(trx.createdAt).toLocaleDateString('ar-SA')}\n                          </TableCell>\n                          <TableCell>\n                            <Badge \n                              variant={trx.status === 'completed' ? 'outline' : 'secondary'} \n                              className={trx.status === 'completed' ? 'text-emerald-600 border-emerald-200 bg-emerald-50' : 'text-amber-600 bg-amber-50'}\n                            >\n                              {trx.status === 'completed' ? 'مكتمل' : 'قيد المعالجة'}\n                            </Badge>\n                          </TableCell>\n                          <TableCell className={`text-right font-mono font-medium ${trx.amount > 0 ? 'text-emerald-600' : 'text-red-600'}`}>\n                            {trx.amount > 0 ? '+' : ''}{(trx.amount / 100).toFixed(2)} ر.س\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n\n          <div>\n            <Card>\n              <CardHeader>\n                <CardTitle>طلب سحب رصيد</CardTitle>\n                <CardDescription>تحويل الأرباح لحسابك البنكي</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <form onSubmit={handleWithdraw} className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <Label>المبلغ المراد سحبه (ر.س)</Label>\n                    <div className=\"relative\">\n                      <DollarSign className=\"absolute right-3 top-2.5 h-4 w-4 text-muted-foreground\" />\n                      <Input \n                        placeholder=\"0.00\" \n                        className=\"pr-9 font-mono\"\n                        type=\"number\"\n                        value={withdrawAmount}\n                        onChange={(e) => setWithdrawAmount(e.target.value)}\n                        data-testid=\"input-withdraw-amount\"\n                      />\n                    </div>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label>الحساب البنكي</Label>\n                    {profile?.bankName && profile?.iban ? (\n                      <div className=\"p-3 border rounded-md bg-muted/50 flex items-center gap-3\">\n                        <CreditCard className=\"w-5 h-5 text-muted-foreground\" />\n                        <div className=\"flex-1\">\n                          <p className=\"text-sm font-medium font-mono\" dir=\"ltr\">{profile.iban}</p>\n                          <p className=\"text-xs text-muted-foreground\">{profile.bankName} - {profile.accountHolderName}</p>\n                        </div>\n                      </div>\n                    ) : (\n                      <div className=\"p-3 border rounded-md bg-amber-50 border-amber-200 text-amber-700 text-sm\">\n                        لم يتم إضافة بيانات الحساب البنكي بعد. يرجى التواصل مع الإدارة لتحديث البيانات.\n                      </div>\n                    )}\n                  </div>\n                  <Button \n                    className=\"w-full mt-2\" \n                    type=\"submit\"\n                    disabled={withdrawMutation.isPending}\n                    data-testid=\"button-withdraw\"\n                  >\n                    {withdrawMutation.isPending ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : \"إرسال طلب السحب\"}\n                  </Button>\n                  <p className=\"text-xs text-muted-foreground text-center pt-2\">\n                    تستغرق معالجة الطلبات 24-48 ساعة عمل\n                  </p>\n                </form>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":12035,"size_tokens":null},"client/src/components/ui/spinner.tsx":{"content":"import { Loader2Icon } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Spinner({ className, ...props }: React.ComponentProps<\"svg\">) {\n  return (\n    <Loader2Icon\n      role=\"status\"\n      aria-label=\"Loading\"\n      className={cn(\"size-4 animate-spin\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Spinner }\n","path":null,"size_bytes":331,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5124,"size_tokens":null},"client/src/pages/merchant/Products.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport { \n  Dialog, \n  DialogContent, \n  DialogDescription, \n  DialogFooter, \n  DialogHeader, \n  DialogTitle, \n  DialogTrigger \n} from \"@/components/ui/dialog\";\nimport { Plus, Search, MoreHorizontal, Edit, Trash, Loader2, Package, Upload, X, ImageIcon } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState, useRef } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Product } from \"@shared/schema\";\n\nconst MAX_IMAGES = 5;\n\nexport default function MerchantProducts() {\n  const [isAddOpen, setIsAddOpen] = useState(false);\n  const [isEditOpen, setIsEditOpen] = useState(false);\n  const [editingProduct, setEditingProduct] = useState<Product | null>(null);\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [images, setImages] = useState<string[]>([]);\n  const [isUploading, setIsUploading] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const [formData, setFormData] = useState({\n    name: \"\",\n    description: \"\",\n    price: \"\",\n    stock: \"\",\n    productType: \"gifts\",\n    category: \"\",\n    promoBadge: \"\"\n  });\n\n  const productTypeLabels: Record<string, string> = {\n    gifts: \"هدايا\",\n    flowers: \"ورد\"\n  };\n\n  const categoryOptions = [\n    { value: \"الكل\", label: \"الكل\" },\n    { value: \"ورد مع هدايا\", label: \"ورد مع هدايا\" },\n    { value: \"نباتات\", label: \"نباتات\" },\n    { value: \"مزهريات\", label: \"مزهريات\" },\n    { value: \"باقات\", label: \"باقات\" },\n  ];\n\n  const promoBadgeOptions = [\n    { value: \"none\", label: \"بدون عنوان ترويجي\" },\n    { value: \"عرض خاص\", label: \"عرض خاص\" },\n    { value: \"توصيل مجاني\", label: \"توصيل مجاني\" },\n    { value: \"الأكثر مبيعاً\", label: \"الأكثر مبيعاً\" },\n  ];\n\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (!files || files.length === 0) return;\n\n    const remainingSlots = MAX_IMAGES - images.length;\n    if (files.length > remainingSlots) {\n      toast({ variant: \"destructive\", title: `يمكنك إضافة ${remainingSlots} صور فقط` });\n      return;\n    }\n\n    setIsUploading(true);\n    const formData = new FormData();\n    for (let i = 0; i < files.length; i++) {\n      formData.append(\"images\", files[i]);\n    }\n\n    try {\n      const res = await fetch(\"/api/merchant/products/upload-images\", {\n        method: \"POST\",\n        credentials: \"include\",\n        body: formData\n      });\n\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"فشل رفع الصور\");\n      }\n\n      const data = await res.json();\n      setImages(prev => [...prev, ...data.images]);\n      toast({ title: \"تم رفع الصور بنجاح\" });\n    } catch (error: any) {\n      toast({ variant: \"destructive\", title: error.message || \"فشل رفع الصور\" });\n    } finally {\n      setIsUploading(false);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = \"\";\n      }\n    }\n  };\n\n  const removeImage = (index: number) => {\n    setImages(prev => prev.filter((_, i) => i !== index));\n  };\n\n  const { data: products = [], isLoading } = useQuery<Product[]>({\n    queryKey: [\"/api/merchant/products\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/merchant/products\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch products\");\n      return res.json();\n    }\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await fetch(\"/api/merchant/products\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify(data)\n      });\n      if (!res.ok) throw new Error(\"Failed to create product\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/merchant/products\"] });\n      setIsAddOpen(false);\n      resetForm();\n      toast({ title: \"تم إضافة المنتج بنجاح\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"فشل إضافة المنتج\" });\n    }\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number, data: any }) => {\n      const res = await fetch(`/api/merchant/products/${id}`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify(data)\n      });\n      if (!res.ok) throw new Error(\"Failed to update product\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/merchant/products\"] });\n      setIsEditOpen(false);\n      setEditingProduct(null);\n      resetForm();\n      toast({ title: \"تم تحديث المنتج بنجاح\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"فشل تحديث المنتج\" });\n    }\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const res = await fetch(`/api/merchant/products/${id}`, { method: \"DELETE\" });\n      if (!res.ok) throw new Error(\"Failed to delete product\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/merchant/products\"] });\n      toast({ title: \"تم حذف المنتج بنجاح\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"فشل حذف المنتج\" });\n    }\n  });\n\n  const resetForm = () => {\n    setFormData({ name: \"\", description: \"\", price: \"\", stock: \"\", productType: \"gifts\", category: \"\", promoBadge: \"\" });\n    setImages([]);\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    const data = {\n      name: formData.name,\n      description: formData.description,\n      price: parseInt(formData.price) * 100,\n      stock: parseInt(formData.stock),\n      productType: formData.productType,\n      category: formData.category || formData.productType,\n      promoBadge: formData.promoBadge || null,\n      images: images,\n      status: parseInt(formData.stock) > 0 ? \"active\" : \"out_of_stock\"\n    };\n\n    if (editingProduct) {\n      updateMutation.mutate({ id: editingProduct.id, data });\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const handleEdit = (product: Product) => {\n    setEditingProduct(product);\n    setFormData({\n      name: product.name,\n      description: product.description || \"\",\n      price: String(product.price / 100),\n      stock: String(product.stock),\n      productType: product.productType || \"gifts\",\n      category: product.category || \"\",\n      promoBadge: product.promoBadge || \"\"\n    });\n    setImages(product.images || []);\n    setIsEditOpen(true);\n  };\n\n  const filteredProducts = products.filter(p => \n    p.name.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  return (\n    <DashboardLayout role=\"merchant\">\n      <div className=\"space-y-8\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight font-display\">المنتجات</h2>\n            <p className=\"text-muted-foreground mt-2\">إدارة منتجات متجرك وتتبع المخزون</p>\n          </div>\n          <Dialog open={isAddOpen} onOpenChange={setIsAddOpen}>\n            <DialogTrigger asChild>\n              <Button className=\"gap-2\" onClick={resetForm} data-testid=\"button-add-product\">\n                <Plus className=\"w-4 h-4\" />\n                إضافة منتج\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"sm:max-w-[425px]\">\n              <form onSubmit={handleSubmit}>\n                <DialogHeader className=\"text-right\">\n                  <DialogTitle>إضافة منتج جديد</DialogTitle>\n                  <DialogDescription>\n                    أدخل تفاصيل المنتج الجديد هنا. اضغط حفظ عند الانتهاء.\n                  </DialogDescription>\n                </DialogHeader>\n                <div className=\"grid gap-4 py-4\">\n                  <div className=\"grid gap-2\">\n                    <Label htmlFor=\"name\">اسم المنتج</Label>\n                    <Input \n                      id=\"name\" \n                      placeholder=\"مثال: باقة ورد فاخرة\" \n                      value={formData.name}\n                      onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                      required\n                      data-testid=\"input-product-name\"\n                    />\n                  </div>\n                  <div className=\"grid gap-2\">\n                    <Label htmlFor=\"description\">وصف المنتج</Label>\n                    <Textarea \n                      id=\"description\" \n                      placeholder=\"وصف المنتج...\"\n                      value={formData.description}\n                      onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                      data-testid=\"input-product-description\"\n                    />\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"grid gap-2\">\n                      <Label htmlFor=\"price\">السعر (ر.س)</Label>\n                      <Input \n                        id=\"price\" \n                        type=\"number\" \n                        placeholder=\"0.00\"\n                        value={formData.price}\n                        onChange={(e) => setFormData({ ...formData, price: e.target.value })}\n                        required\n                        data-testid=\"input-product-price\"\n                      />\n                    </div>\n                    <div className=\"grid gap-2\">\n                      <Label htmlFor=\"stock\">الكمية</Label>\n                      <Input \n                        id=\"stock\" \n                        type=\"number\" \n                        placeholder=\"0\"\n                        value={formData.stock}\n                        onChange={(e) => setFormData({ ...formData, stock: e.target.value })}\n                        required\n                        data-testid=\"input-product-stock\"\n                      />\n                    </div>\n                  </div>\n                  <div className=\"grid gap-2\">\n                    <Label htmlFor=\"category\">فئة المنتج</Label>\n                    <Select\n                      value={formData.category}\n                      onValueChange={(value) => setFormData({ ...formData, category: value })}\n                    >\n                      <SelectTrigger id=\"category\" data-testid=\"select-product-category\">\n                        <SelectValue placeholder=\"اختر فئة المنتج\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {categoryOptions.map((option) => (\n                          <SelectItem key={option.value} value={option.value}>\n                            {option.label}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div className=\"grid gap-2\">\n                    <Label htmlFor=\"promoBadge\">العنوان الترويجي</Label>\n                    <Select\n                      value={formData.promoBadge}\n                      onValueChange={(value) => setFormData({ ...formData, promoBadge: value })}\n                    >\n                      <SelectTrigger id=\"promoBadge\" data-testid=\"select-promo-badge\">\n                        <SelectValue placeholder=\"اختر عنوان ترويجي (اختياري)\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {promoBadgeOptions.map((option) => (\n                          <SelectItem key={option.value || \"none\"} value={option.value}>\n                            {option.label}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  <div className=\"grid gap-2\">\n                    <Label>صور المنتج ({images.length}/{MAX_IMAGES})</Label>\n                    <div className=\"border-2 border-dashed border-muted-foreground/25 rounded-lg p-4\">\n                      {images.length > 0 && (\n                        <div className=\"grid grid-cols-5 gap-2 mb-3\">\n                          {images.map((img, index) => (\n                            <div key={index} className=\"relative group\">\n                              <img \n                                src={img} \n                                alt={`صورة ${index + 1}`}\n                                className=\"w-full h-16 object-cover rounded border\"\n                              />\n                              <button\n                                type=\"button\"\n                                onClick={() => removeImage(index)}\n                                className=\"absolute -top-1 -right-1 bg-destructive text-white rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition-opacity\"\n                              >\n                                <X className=\"w-3 h-3\" />\n                              </button>\n                            </div>\n                          ))}\n                        </div>\n                      )}\n                      {images.length < MAX_IMAGES && (\n                        <div className=\"flex flex-col items-center gap-2\">\n                          <input\n                            ref={fileInputRef}\n                            type=\"file\"\n                            accept=\"image/*\"\n                            multiple\n                            onChange={handleImageUpload}\n                            className=\"hidden\"\n                            id=\"product-images\"\n                            data-testid=\"input-product-images\"\n                          />\n                          <label\n                            htmlFor=\"product-images\"\n                            className=\"cursor-pointer flex flex-col items-center gap-1 text-muted-foreground hover:text-foreground transition-colors\"\n                          >\n                            {isUploading ? (\n                              <Loader2 className=\"w-8 h-8 animate-spin\" />\n                            ) : (\n                              <>\n                                <Upload className=\"w-8 h-8\" />\n                                <span className=\"text-xs\">اضغط لرفع الصور</span>\n                              </>\n                            )}\n                          </label>\n                        </div>\n                      )}\n                    </div>\n                    <p className=\"text-xs text-muted-foreground\">يمكنك رفع من 1 إلى 5 صور (JPEG, PNG, GIF, WebP)</p>\n                  </div>\n                </div>\n                <DialogFooter>\n                  <Button type=\"submit\" disabled={createMutation.isPending || isUploading} data-testid=\"button-save-product\">\n                    {createMutation.isPending ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : \"حفظ المنتج\"}\n                  </Button>\n                </DialogFooter>\n              </form>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <div className=\"flex items-center gap-4 bg-card p-4 rounded-lg border\">\n          <Search className=\"w-5 h-5 text-muted-foreground\" />\n          <Input \n            placeholder=\"بحث عن منتج...\" \n            className=\"max-w-sm border-none shadow-none focus-visible:ring-0\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            data-testid=\"input-search-products\"\n          />\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex justify-center py-12\">\n            <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n          </div>\n        ) : filteredProducts.length === 0 ? (\n          <div className=\"text-center py-12 border rounded-lg bg-muted/20\">\n            <Package className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n            <h3 className=\"font-semibold text-lg\">لا توجد منتجات</h3>\n            <p className=\"text-muted-foreground\">ابدأ بإضافة منتجات لمتجرك</p>\n          </div>\n        ) : (\n          <div className=\"rounded-md border bg-card\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead className=\"w-[100px] text-right\">المعرف</TableHead>\n                  <TableHead className=\"text-right\">الاسم</TableHead>\n                  <TableHead className=\"text-right\">النوع</TableHead>\n                  <TableHead className=\"text-right\">الحالة</TableHead>\n                  <TableHead className=\"text-right\">السعر</TableHead>\n                  <TableHead className=\"text-right\">المخزون</TableHead>\n                  <TableHead className=\"text-right\">إجراءات</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredProducts.map((product) => (\n                  <TableRow key={product.id} data-testid={`row-product-${product.id}`}>\n                    <TableCell className=\"font-medium font-mono text-muted-foreground text-xs\">#{product.id}</TableCell>\n                    <TableCell className=\"font-medium\">{product.name}</TableCell>\n                    <TableCell>\n                      <Badge variant=\"outline\" className={product.productType === 'flowers' ? 'border-pink-300 text-pink-600' : 'border-amber-300 text-amber-600'}>\n                        {productTypeLabels[product.productType] || product.productType}\n                      </Badge>\n                    </TableCell>\n                    <TableCell>\n                      <Badge \n                        variant={\n                          product.status === 'active' ? 'default' : \n                          product.status === 'out_of_stock' ? 'destructive' : 'secondary'\n                        }\n                        className={\n                          product.status === 'active' ? 'bg-emerald-500 hover:bg-emerald-600' : \n                          product.status === 'low_stock' ? 'bg-amber-500 hover:bg-amber-600' : ''\n                        }\n                      >\n                        {\n                          product.status === 'active' ? 'نشط' : \n                          product.status === 'out_of_stock' ? 'نفذت الكمية' : 'مخزون منخفض'\n                        }\n                      </Badge>\n                    </TableCell>\n                    <TableCell className=\"font-mono\">{(product.price / 100).toFixed(2)} ر.س</TableCell>\n                    <TableCell>{product.stock}</TableCell>\n                    <TableCell>\n                      <DropdownMenu>\n                        <DropdownMenuTrigger asChild>\n                          <Button variant=\"ghost\" className=\"h-8 w-8 p-0\" data-testid={`button-product-menu-${product.id}`}>\n                            <span className=\"sr-only\">Open menu</span>\n                            <MoreHorizontal className=\"h-4 w-4\" />\n                          </Button>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent align=\"end\">\n                          <DropdownMenuItem className=\"gap-2 cursor-pointer\" onClick={() => handleEdit(product)}>\n                            <Edit className=\"w-4 h-4\" /> تعديل\n                          </DropdownMenuItem>\n                          <DropdownMenuItem \n                            className=\"gap-2 cursor-pointer text-destructive focus:text-destructive\"\n                            onClick={() => deleteMutation.mutate(product.id)}\n                          >\n                            <Trash className=\"w-4 h-4\" /> حذف\n                          </DropdownMenuItem>\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </div>\n        )}\n\n        <Dialog open={isEditOpen} onOpenChange={setIsEditOpen}>\n          <DialogContent className=\"sm:max-w-[425px]\">\n            <form onSubmit={handleSubmit}>\n              <DialogHeader className=\"text-right\">\n                <DialogTitle>تعديل المنتج</DialogTitle>\n                <DialogDescription>\n                  عدّل تفاصيل المنتج. اضغط حفظ عند الانتهاء.\n                </DialogDescription>\n              </DialogHeader>\n              <div className=\"grid gap-4 py-4\">\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"edit-name\">اسم المنتج</Label>\n                  <Input \n                    id=\"edit-name\" \n                    value={formData.name}\n                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                    required\n                  />\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"edit-description\">وصف المنتج</Label>\n                  <Textarea \n                    id=\"edit-description\"\n                    value={formData.description}\n                    onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                  />\n                </div>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"grid gap-2\">\n                    <Label htmlFor=\"edit-price\">السعر (ر.س)</Label>\n                    <Input \n                      id=\"edit-price\" \n                      type=\"number\"\n                      value={formData.price}\n                      onChange={(e) => setFormData({ ...formData, price: e.target.value })}\n                      required\n                    />\n                  </div>\n                  <div className=\"grid gap-2\">\n                    <Label htmlFor=\"edit-stock\">الكمية</Label>\n                    <Input \n                      id=\"edit-stock\" \n                      type=\"number\"\n                      value={formData.stock}\n                      onChange={(e) => setFormData({ ...formData, stock: e.target.value })}\n                      required\n                    />\n                  </div>\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"edit-category\">فئة المنتج</Label>\n                  <Select\n                    value={formData.category}\n                    onValueChange={(value) => setFormData({ ...formData, category: value })}\n                  >\n                    <SelectTrigger id=\"edit-category\">\n                      <SelectValue placeholder=\"اختر فئة المنتج\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {categoryOptions.map((option) => (\n                        <SelectItem key={option.value} value={option.value}>\n                          {option.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"edit-promoBadge\">العنوان الترويجي</Label>\n                  <Select\n                    value={formData.promoBadge}\n                    onValueChange={(value) => setFormData({ ...formData, promoBadge: value })}\n                  >\n                    <SelectTrigger id=\"edit-promoBadge\">\n                      <SelectValue placeholder=\"اختر عنوان ترويجي (اختياري)\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {promoBadgeOptions.map((option) => (\n                        <SelectItem key={option.value || \"none\"} value={option.value}>\n                          {option.label}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"grid gap-2\">\n                  <Label>صور المنتج ({images.length}/{MAX_IMAGES})</Label>\n                  <div className=\"border-2 border-dashed border-muted-foreground/25 rounded-lg p-4\">\n                    {images.length > 0 && (\n                      <div className=\"grid grid-cols-5 gap-2 mb-3\">\n                        {images.map((img, index) => (\n                          <div key={index} className=\"relative group\">\n                            <img \n                              src={img} \n                              alt={`صورة ${index + 1}`}\n                              className=\"w-full h-16 object-cover rounded border\"\n                            />\n                            <button\n                              type=\"button\"\n                              onClick={() => removeImage(index)}\n                              className=\"absolute -top-1 -right-1 bg-destructive text-white rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition-opacity\"\n                            >\n                              <X className=\"w-3 h-3\" />\n                            </button>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                    {images.length < MAX_IMAGES && (\n                      <div className=\"flex flex-col items-center gap-2\">\n                        <input\n                          type=\"file\"\n                          accept=\"image/*\"\n                          multiple\n                          onChange={handleImageUpload}\n                          className=\"hidden\"\n                          id=\"edit-product-images\"\n                        />\n                        <label\n                          htmlFor=\"edit-product-images\"\n                          className=\"cursor-pointer flex flex-col items-center gap-1 text-muted-foreground hover:text-foreground transition-colors\"\n                        >\n                          {isUploading ? (\n                            <Loader2 className=\"w-8 h-8 animate-spin\" />\n                          ) : (\n                            <>\n                              <Upload className=\"w-8 h-8\" />\n                              <span className=\"text-xs\">اضغط لرفع الصور</span>\n                            </>\n                          )}\n                        </label>\n                      </div>\n                    )}\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">يمكنك رفع من 1 إلى 5 صور (JPEG, PNG, GIF, WebP)</p>\n                </div>\n              </div>\n              <DialogFooter>\n                <Button type=\"submit\" disabled={updateMutation.isPending || isUploading}>\n                  {updateMutation.isPending ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : \"حفظ التغييرات\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </DialogContent>\n        </Dialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":28271,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"import * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3007,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":724,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"grid place-content-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1031,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-9 px-2 min-w-9\",\n        sm: \"h-8 px-1.5 min-w-8\",\n        lg: \"h-10 px-2.5 min-w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1486,"size_tokens":null},"client/src/pages/admin/PendingMerchants.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { \n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { CheckCircle, XCircle, Loader2, Store, Eye, Clock, MapPin, Phone, Mail, Building, Truck } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport type { Merchant } from \"@shared/schema\";\n\nconst storeTypeLabels: Record<string, string> = {\n  company: \"شركة\",\n  institution: \"مؤسسة\",\n  individual: \"فرد\"\n};\n\nconst deliveryMethodLabels: Record<string, string> = {\n  representative: \"مندوب توصيل\",\n  pickup: \"استلام من الفرع\",\n  all: \"الكل\"\n};\n\nexport default function PendingMerchants() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [, navigate] = useLocation();\n  const [selectedMerchant, setSelectedMerchant] = useState<Merchant | null>(null);\n  const [isDetailsOpen, setIsDetailsOpen] = useState(false);\n  const [isRejectOpen, setIsRejectOpen] = useState(false);\n  const [rejectReason, setRejectReason] = useState(\"\");\n\n  const { data: allMerchants = [], isLoading } = useQuery<Merchant[]>({\n    queryKey: [\"/api/admin/merchants\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/merchants\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch merchants\");\n      return res.json();\n    }\n  });\n\n  const pendingMerchants = allMerchants.filter(m => m.status === \"pending\");\n\n  const updateStatusMutation = useMutation({\n    mutationFn: async ({ id, status, reason }: { id: number; status: string; reason?: string }) => {\n      const res = await fetch(`/api/admin/merchants/${id}/status`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ status, reason })\n      });\n      if (!res.ok) throw new Error(\"Failed to update status\");\n      return res.json();\n    },\n    onSuccess: (_, { status }) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/merchants\"] });\n      if (status === \"active\") {\n        toast({\n          title: \"تم قبول المتجر بنجاح\",\n          description: \"تم نقل المتجر إلى قائمة المتاجر النشطة\",\n          className: \"bg-emerald-50 border-emerald-200 text-emerald-800\"\n        });\n        navigate(\"/admin/merchants\");\n      } else {\n        toast({\n          title: \"تم رفض الطلب\",\n          className: \"bg-red-50 border-red-200 text-red-800\"\n        });\n      }\n      setIsDetailsOpen(false);\n      setIsRejectOpen(false);\n      setRejectReason(\"\");\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"فشل تحديث الحالة\" });\n    }\n  });\n\n  const handleApprove = (merchant: Merchant) => {\n    updateStatusMutation.mutate({ id: merchant.id, status: \"active\" });\n  };\n\n  const handleReject = () => {\n    if (selectedMerchant) {\n      updateStatusMutation.mutate({ \n        id: selectedMerchant.id, \n        status: \"rejected\",\n        reason: rejectReason || undefined\n      });\n    }\n  };\n\n  const handleViewDetails = (merchant: Merchant) => {\n    setSelectedMerchant(merchant);\n    setIsDetailsOpen(true);\n  };\n\n  const openRejectDialog = (merchant: Merchant) => {\n    setSelectedMerchant(merchant);\n    setIsRejectOpen(true);\n  };\n\n  return (\n    <DashboardLayout role=\"admin\">\n      <div className=\"space-y-8\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight font-display\">طلبات التسجيل</h2>\n            <p className=\"text-muted-foreground mt-2\">مراجعة طلبات تسجيل المتاجر الجديدة والموافقة عليها</p>\n          </div>\n          {pendingMerchants.length > 0 && (\n            <Badge variant=\"secondary\" className=\"text-lg px-4 py-2 bg-amber-100 text-amber-800\">\n              <Clock className=\"w-4 h-4 ml-2\" />\n              {pendingMerchants.length} طلبات معلقة\n            </Badge>\n          )}\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex justify-center py-12\">\n            <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n          </div>\n        ) : pendingMerchants.length === 0 ? (\n          <div className=\"text-center py-16 border rounded-lg bg-muted/20\">\n            <CheckCircle className=\"w-16 h-16 text-emerald-500 mx-auto mb-4\" />\n            <h3 className=\"font-semibold text-xl mb-2\">لا توجد طلبات معلقة</h3>\n            <p className=\"text-muted-foreground mb-4\">جميع طلبات التسجيل تمت مراجعتها</p>\n            <Button variant=\"outline\" onClick={() => navigate(\"/admin/merchants\")}>\n              عرض جميع المتاجر\n            </Button>\n          </div>\n        ) : (\n          <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\n            {pendingMerchants.map((merchant) => (\n              <Card key={merchant.id} className=\"overflow-hidden hover:shadow-lg transition-shadow\" data-testid={`pending-merchant-${merchant.id}`}>\n                <CardHeader className=\"bg-amber-50 border-b border-amber-100\">\n                  <div className=\"flex items-center justify-between\">\n                    <Badge variant=\"outline\" className=\"bg-amber-100 text-amber-800 border-amber-300\">\n                      <Clock className=\"w-3 h-3 ml-1\" />\n                      قيد المراجعة\n                    </Badge>\n                    <span className=\"text-xs text-muted-foreground\">\n                      {new Date(merchant.createdAt).toLocaleDateString('ar-SA')}\n                    </span>\n                  </div>\n                  <CardTitle className=\"mt-3 flex items-center gap-2\">\n                    <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold\">\n                      {merchant.storeName.charAt(0)}\n                    </div>\n                    <div>\n                      <span className=\"block\">{merchant.storeName}</span>\n                      <span className=\"text-sm font-normal text-muted-foreground\">{merchant.ownerName}</span>\n                    </div>\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"pt-4 space-y-3\">\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <Mail className=\"w-4 h-4 text-muted-foreground\" />\n                    <span className=\"font-mono text-xs\">{merchant.email}</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <Phone className=\"w-4 h-4 text-muted-foreground\" />\n                    <span className=\"font-mono\">{merchant.mobile}</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <Building className=\"w-4 h-4 text-muted-foreground\" />\n                    <span>{storeTypeLabels[merchant.storeType]}</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <MapPin className=\"w-4 h-4 text-muted-foreground\" />\n                    <span>{merchant.city}</span>\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    <Truck className=\"w-4 h-4 text-muted-foreground\" />\n                    <span>{deliveryMethodLabels[merchant.deliveryMethod]}</span>\n                  </div>\n\n                  <div className=\"pt-4 flex gap-2\">\n                    <Button \n                      variant=\"outline\" \n                      className=\"flex-1\"\n                      onClick={() => handleViewDetails(merchant)}\n                      data-testid={`button-view-${merchant.id}`}\n                    >\n                      <Eye className=\"w-4 h-4 ml-1\" />\n                      التفاصيل\n                    </Button>\n                    <Button \n                      className=\"flex-1 bg-emerald-600 hover:bg-emerald-700\"\n                      onClick={() => handleApprove(merchant)}\n                      disabled={updateStatusMutation.isPending}\n                      data-testid={`button-approve-${merchant.id}`}\n                    >\n                      <CheckCircle className=\"w-4 h-4 ml-1\" />\n                      قبول\n                    </Button>\n                    <Button \n                      variant=\"destructive\"\n                      onClick={() => openRejectDialog(merchant)}\n                      disabled={updateStatusMutation.isPending}\n                      data-testid={`button-reject-${merchant.id}`}\n                    >\n                      <XCircle className=\"w-4 h-4\" />\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n\n        <Dialog open={isDetailsOpen} onOpenChange={setIsDetailsOpen}>\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle className=\"flex items-center gap-2\">\n                <Store className=\"w-5 h-5\" />\n                تفاصيل طلب التسجيل\n              </DialogTitle>\n              <DialogDescription>مراجعة بيانات المتجر قبل الموافقة أو الرفض</DialogDescription>\n            </DialogHeader>\n            {selectedMerchant && (\n              <div className=\"space-y-6\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-1\">\n                    <p className=\"text-sm text-muted-foreground\">اسم المتجر</p>\n                    <p className=\"font-medium text-lg\">{selectedMerchant.storeName}</p>\n                  </div>\n                  <div className=\"space-y-1\">\n                    <p className=\"text-sm text-muted-foreground\">اسم المالك</p>\n                    <p className=\"font-medium text-lg\">{selectedMerchant.ownerName}</p>\n                  </div>\n                </div>\n\n                <div className=\"border-t pt-4\">\n                  <h4 className=\"font-semibold mb-3\">معلومات التواصل</h4>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"space-y-1\">\n                      <p className=\"text-sm text-muted-foreground\">البريد الإلكتروني</p>\n                      <p className=\"font-mono text-sm\">{selectedMerchant.email}</p>\n                    </div>\n                    <div className=\"space-y-1\">\n                      <p className=\"text-sm text-muted-foreground\">رقم الجوال</p>\n                      <p className=\"font-mono\">{selectedMerchant.mobile}</p>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"border-t pt-4\">\n                  <h4 className=\"font-semibold mb-3\">معلومات النشاط</h4>\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"space-y-1\">\n                      <p className=\"text-sm text-muted-foreground\">نوع الكيان</p>\n                      <p className=\"font-medium\">{storeTypeLabels[selectedMerchant.storeType]}</p>\n                    </div>\n                    <div className=\"space-y-1\">\n                      <p className=\"text-sm text-muted-foreground\">رقم السجل التجاري</p>\n                      <p className=\"font-mono\">{selectedMerchant.registrationNumber}</p>\n                    </div>\n                    <div className=\"space-y-1\">\n                      <p className=\"text-sm text-muted-foreground\">المدينة</p>\n                      <p className=\"font-medium\">{selectedMerchant.city}</p>\n                    </div>\n                    <div className=\"space-y-1\">\n                      <p className=\"text-sm text-muted-foreground\">طريقة التوصيل</p>\n                      <p className=\"font-medium\">{deliveryMethodLabels[selectedMerchant.deliveryMethod]}</p>\n                    </div>\n                  </div>\n                </div>\n\n                {selectedMerchant.branches && selectedMerchant.branches.length > 0 && (\n                  <div className=\"border-t pt-4\">\n                    <h4 className=\"font-semibold mb-3\">الفروع ({selectedMerchant.branches.length})</h4>\n                    <div className=\"space-y-2\">\n                      {selectedMerchant.branches.map((branch: any, idx: number) => (\n                        <div key={idx} className=\"p-3 bg-muted/50 rounded-lg\">\n                          <p className=\"font-medium\">{branch.name}</p>\n                          <a \n                            href={branch.mapLink} \n                            target=\"_blank\" \n                            rel=\"noopener noreferrer\" \n                            className=\"text-xs text-primary hover:underline flex items-center gap-1\"\n                          >\n                            <MapPin className=\"w-3 h-3\" />\n                            عرض على الخريطة\n                          </a>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                <div className=\"border-t pt-4\">\n                  <p className=\"text-sm text-muted-foreground\">تاريخ التسجيل</p>\n                  <p className=\"font-mono\">{new Date(selectedMerchant.createdAt).toLocaleString('ar-SA')}</p>\n                </div>\n\n                <DialogFooter className=\"gap-2 sm:gap-0\">\n                  <Button \n                    variant=\"outline\" \n                    onClick={() => openRejectDialog(selectedMerchant)}\n                    className=\"text-destructive hover:text-destructive\"\n                  >\n                    <XCircle className=\"w-4 h-4 ml-1\" />\n                    رفض الطلب\n                  </Button>\n                  <Button \n                    className=\"bg-emerald-600 hover:bg-emerald-700\"\n                    onClick={() => handleApprove(selectedMerchant)}\n                    disabled={updateStatusMutation.isPending}\n                  >\n                    {updateStatusMutation.isPending && <Loader2 className=\"w-4 h-4 animate-spin ml-2\" />}\n                    <CheckCircle className=\"w-4 h-4 ml-1\" />\n                    قبول المتجر\n                  </Button>\n                </DialogFooter>\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n\n        <Dialog open={isRejectOpen} onOpenChange={setIsRejectOpen}>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle className=\"text-destructive\">رفض طلب التسجيل</DialogTitle>\n              <DialogDescription>تأكيد رفض طلب تسجيل المتجر</DialogDescription>\n            </DialogHeader>\n            {selectedMerchant && (\n              <div className=\"space-y-4\">\n                <p className=\"text-muted-foreground\">\n                  هل أنت متأكد من رفض طلب تسجيل متجر <strong>{selectedMerchant.storeName}</strong>؟\n                </p>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"reason\">سبب الرفض (اختياري)</Label>\n                  <Textarea\n                    id=\"reason\"\n                    placeholder=\"أدخل سبب الرفض...\"\n                    value={rejectReason}\n                    onChange={(e) => setRejectReason(e.target.value)}\n                  />\n                </div>\n                <DialogFooter>\n                  <Button variant=\"outline\" onClick={() => setIsRejectOpen(false)}>\n                    إلغاء\n                  </Button>\n                  <Button \n                    variant=\"destructive\"\n                    onClick={handleReject}\n                    disabled={updateStatusMutation.isPending}\n                  >\n                    {updateStatusMutation.isPending && <Loader2 className=\"w-4 h-4 animate-spin ml-2\" />}\n                    تأكيد الرفض\n                  </Button>\n                </DialogFooter>\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":16779,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, integer, serial, timestamp, boolean, jsonb, varchar } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// ========== Merchants Table ==========\nexport const merchants = pgTable(\"merchants\", {\n  id: serial(\"id\").primaryKey(),\n  ownerName: text(\"owner_name\").notNull(),\n  storeName: text(\"store_name\").notNull(),\n  username: text(\"username\").notNull().unique(),\n  bio: text(\"bio\"),\n  email: text(\"email\").notNull().unique(),\n  mobile: text(\"mobile\").notNull(),\n  password: text(\"password\").notNull(),\n  storeType: text(\"store_type\").notNull(),\n  category: text(\"category\").notNull(),\n  city: text(\"city\").notNull(),\n  registrationNumber: text(\"registration_number\").notNull(),\n  deliveryMethod: text(\"delivery_method\").notNull(),\n  branches: jsonb(\"branches\").$type<{ name: string; mapLink: string }[]>(),\n  status: text(\"status\").notNull().default(\"pending\"),\n  storeImage: text(\"store_image\"),\n  socialLinks: jsonb(\"social_links\").$type<{\n    instagram?: string;\n    twitter?: string;\n    facebook?: string;\n    website?: string;\n    tiktok?: string;\n    snapchat?: string;\n  }>(),\n  bankName: text(\"bank_name\"),\n  iban: text(\"iban\"),\n  accountHolderName: text(\"account_holder_name\"),\n  balance: integer(\"balance\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertMerchantSchema = createInsertSchema(merchants, {\n  email: z.string().email(),\n  mobile: z.string().min(9),\n  password: z.string().min(6),\n}).omit({\n  id: true,\n  balance: true,\n  createdAt: true,\n  status: true,\n});\n\nexport type InsertMerchant = z.infer<typeof insertMerchantSchema>;\nexport type Merchant = typeof merchants.$inferSelect;\n\n// ========== Products Table ==========\nexport const products = pgTable(\"products\", {\n  id: serial(\"id\").primaryKey(),\n  merchantId: integer(\"merchant_id\").notNull().references(() => merchants.id, { onDelete: \"cascade\" }),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  price: integer(\"price\").notNull(),\n  stock: integer(\"stock\").notNull().default(0),\n  productType: text(\"product_type\").notNull().default(\"gifts\"),\n  category: text(\"category\").notNull(),\n  promoBadge: text(\"promo_badge\"),\n  images: jsonb(\"images\").$type<string[]>(),\n  status: text(\"status\").notNull().default(\"active\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertProductSchema = createInsertSchema(products, {\n  images: z.array(z.string()).optional().default([]),\n}).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertProduct = z.infer<typeof insertProductSchema>;\nexport type Product = typeof products.$inferSelect;\n\n// ========== Customers Table ==========\nexport const customers = pgTable(\"customers\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  email: text(\"email\").unique(),\n  mobile: text(\"mobile\").notNull().unique(),\n  city: text(\"city\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertCustomerSchema = createInsertSchema(customers).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertCustomer = z.infer<typeof insertCustomerSchema>;\nexport type Customer = typeof customers.$inferSelect;\n\n// ========== Orders Table ==========\nexport const orders = pgTable(\"orders\", {\n  id: serial(\"id\").primaryKey(),\n  orderNumber: text(\"order_number\").notNull().unique(),\n  customerId: integer(\"customer_id\").notNull().references(() => customers.id),\n  merchantId: integer(\"merchant_id\").notNull().references(() => merchants.id),\n  productId: integer(\"product_id\").notNull().references(() => products.id),\n  quantity: integer(\"quantity\").notNull().default(1),\n  totalAmount: integer(\"total_amount\").notNull(),\n  status: text(\"status\").notNull().default(\"pending\"),\n  customerNote: text(\"customer_note\"),\n  deliveryAddress: text(\"delivery_address\"),\n  deliveryMethod: text(\"delivery_method\").notNull(),\n  isPaid: boolean(\"is_paid\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const insertOrderSchema = createInsertSchema(orders).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertOrder = z.infer<typeof insertOrderSchema>;\nexport type Order = typeof orders.$inferSelect;\n\n// ========== Order Messages Table ==========\nexport const orderMessages = pgTable(\"order_messages\", {\n  id: serial(\"id\").primaryKey(),\n  orderId: integer(\"order_id\").notNull().references(() => orders.id, { onDelete: \"cascade\" }),\n  senderId: integer(\"sender_id\").notNull(),\n  senderType: text(\"sender_type\").notNull(),\n  message: text(\"message\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertOrderMessageSchema = createInsertSchema(orderMessages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertOrderMessage = z.infer<typeof insertOrderMessageSchema>;\nexport type OrderMessage = typeof orderMessages.$inferSelect;\n\n// ========== Reviews Table ==========\nexport const reviews = pgTable(\"reviews\", {\n  id: serial(\"id\").primaryKey(),\n  orderId: integer(\"order_id\").notNull().references(() => orders.id),\n  customerId: integer(\"customer_id\").notNull().references(() => customers.id),\n  productId: integer(\"product_id\").notNull().references(() => products.id),\n  rating: integer(\"rating\").notNull(),\n  comment: text(\"comment\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertReviewSchema = createInsertSchema(reviews).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertReview = z.infer<typeof insertReviewSchema>;\nexport type Review = typeof reviews.$inferSelect;\n\n// ========== Transactions Table (Wallet) ==========\nexport const transactions = pgTable(\"transactions\", {\n  id: serial(\"id\").primaryKey(),\n  merchantId: integer(\"merchant_id\").notNull().references(() => merchants.id, { onDelete: \"cascade\" }),\n  orderId: integer(\"order_id\").references(() => orders.id),\n  type: text(\"type\").notNull(),\n  amount: integer(\"amount\").notNull(),\n  status: text(\"status\").notNull().default(\"completed\"),\n  description: text(\"description\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertTransactionSchema = createInsertSchema(transactions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertTransaction = z.infer<typeof insertTransactionSchema>;\nexport type Transaction = typeof transactions.$inferSelect;\n\n// ========== Admins Table ==========\nexport const admins = pgTable(\"admins\", {\n  id: serial(\"id\").primaryKey(),\n  email: text(\"email\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  name: text(\"name\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertAdminSchema = createInsertSchema(admins).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertAdmin = z.infer<typeof insertAdminSchema>;\nexport type Admin = typeof admins.$inferSelect;\n\n// ========== Banners Table ==========\nexport const banners = pgTable(\"banners\", {\n  id: serial(\"id\").primaryKey(),\n  title: text(\"title\").notNull(),\n  image: text(\"image\").notNull(),\n  link: text(\"link\"),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  sortOrder: integer(\"sort_order\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertBannerSchema = createInsertSchema(banners).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertBanner = z.infer<typeof insertBannerSchema>;\nexport type Banner = typeof banners.$inferSelect;\n\n// ========== Categories Table (App Categories) ==========\nexport const categories = pgTable(\"categories\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  nameEn: text(\"name_en\"),\n  icon: text(\"icon\"),\n  image: text(\"image\"),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  sortOrder: integer(\"sort_order\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertCategorySchema = createInsertSchema(categories).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertCategory = z.infer<typeof insertCategorySchema>;\nexport type Category = typeof categories.$inferSelect;\n\n// ========== Cities Table ==========\nexport const cities = pgTable(\"cities\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  nameEn: text(\"name_en\"),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  sortOrder: integer(\"sort_order\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertCitySchema = createInsertSchema(cities).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertCity = z.infer<typeof insertCitySchema>;\nexport type City = typeof cities.$inferSelect;\n\n// ========== App Settings Table ==========\nexport const appSettings = pgTable(\"app_settings\", {\n  id: serial(\"id\").primaryKey(),\n  key: text(\"key\").notNull().unique(),\n  value: text(\"value\"),\n  valueJson: jsonb(\"value_json\"),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const insertAppSettingSchema = createInsertSchema(appSettings).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport type InsertAppSetting = z.infer<typeof insertAppSettingSchema>;\nexport type AppSetting = typeof appSettings.$inferSelect;\n","path":null,"size_bytes":9439,"size_tokens":null},"client/src/components/ui/kbd.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Kbd({ className, ...props }: React.ComponentProps<\"kbd\">) {\n  return (\n    <kbd\n      data-slot=\"kbd\"\n      className={cn(\n        \"bg-muted text-muted-foreground pointer-events-none inline-flex h-5 w-fit min-w-5 select-none items-center justify-center gap-1 rounded-sm px-1 font-sans text-xs font-medium\",\n        \"[&_svg:not([class*='size-'])]:size-3\",\n        \"[[data-slot=tooltip-content]_&]:bg-background/20 [[data-slot=tooltip-content]_&]:text-background dark:[[data-slot=tooltip-content]_&]:bg-background/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction KbdGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <kbd\n      data-slot=\"kbd-group\"\n      className={cn(\"inline-flex items-center gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Kbd, KbdGroup }\n","path":null,"size_bytes":862,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"import * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1237,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7606,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1037,"size_tokens":null},"script/build.ts":{"content":"import { build as esbuild } from \"esbuild\";\nimport { build as viteBuild } from \"vite\";\nimport { rm, readFile } from \"fs/promises\";\n\n// server deps to bundle to reduce openat(2) syscalls\n// which helps cold start times\nconst allowlist = [\n  \"@google/generative-ai\",\n  \"axios\",\n  \"connect-pg-simple\",\n  \"cors\",\n  \"date-fns\",\n  \"drizzle-orm\",\n  \"drizzle-zod\",\n  \"express\",\n  \"express-rate-limit\",\n  \"express-session\",\n  \"jsonwebtoken\",\n  \"memorystore\",\n  \"multer\",\n  \"nanoid\",\n  \"nodemailer\",\n  \"openai\",\n  \"passport\",\n  \"passport-local\",\n  \"pg\",\n  \"stripe\",\n  \"uuid\",\n  \"ws\",\n  \"xlsx\",\n  \"zod\",\n  \"zod-validation-error\",\n];\n\nasync function buildAll() {\n  await rm(\"dist\", { recursive: true, force: true });\n\n  console.log(\"building client...\");\n  await viteBuild();\n\n  console.log(\"building server...\");\n  const pkg = JSON.parse(await readFile(\"package.json\", \"utf-8\"));\n  const allDeps = [\n    ...Object.keys(pkg.dependencies || {}),\n    ...Object.keys(pkg.devDependencies || {}),\n  ];\n  const externals = allDeps.filter((dep) => !allowlist.includes(dep));\n\n  await esbuild({\n    entryPoints: [\"server/index.ts\"],\n    platform: \"node\",\n    bundle: true,\n    format: \"cjs\",\n    outfile: \"dist/index.cjs\",\n    define: {\n      \"process.env.NODE_ENV\": '\"production\"',\n    },\n    minify: true,\n    external: externals,\n    logLevel: \"info\",\n  });\n}\n\nbuildAll().catch((err) => {\n  console.error(err);\n  process.exit(1);\n});\n","path":null,"size_bytes":1417,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/pages/admin/Dashboard.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Users, Store, TrendingUp, Activity, Loader2, Clock, CheckCircle, XCircle } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Badge } from \"@/components/ui/badge\";\nimport type { Merchant, Transaction } from \"@shared/schema\";\n\nconst StatsCard = ({ title, value, icon: Icon, description, loading }: any) => (\n  <Card>\n    <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n      <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n        {title}\n      </CardTitle>\n      <Icon className=\"h-4 w-4 text-muted-foreground\" />\n    </CardHeader>\n    <CardContent>\n      {loading ? (\n        <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n      ) : (\n        <>\n          <div className=\"text-2xl font-bold font-display\" data-testid={`stat-${title}`}>{value}</div>\n          <p className=\"text-xs text-muted-foreground mt-1\">\n            {description}\n          </p>\n        </>\n      )}\n    </CardContent>\n  </Card>\n);\n\nexport default function AdminDashboard() {\n  const { data: merchants = [], isLoading: loadingMerchants } = useQuery<Merchant[]>({\n    queryKey: [\"/api/admin/merchants\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/merchants\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch\");\n      return res.json();\n    }\n  });\n\n  const { data: withdrawals = [], isLoading: loadingWithdrawals } = useQuery<Transaction[]>({\n    queryKey: [\"/api/admin/withdrawals\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/withdrawals\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch\");\n      return res.json();\n    }\n  });\n\n  const activeMerchants = merchants.filter(m => m.status === \"active\").length;\n  const pendingMerchants = merchants.filter(m => m.status === \"pending\").length;\n  const totalBalance = merchants.reduce((sum, m) => sum + m.balance, 0);\n\n  return (\n    <DashboardLayout role=\"admin\">\n      <div className=\"space-y-8\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight font-display\">لوحة الإدارة</h2>\n          <p className=\"text-muted-foreground mt-2\">مراقبة أداء المنصة والتجار</p>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n          <StatsCard \n            title=\"إجمالي التجار\" \n            value={merchants.length}\n            icon={Store}\n            description={`${activeMerchants} نشط`}\n            loading={loadingMerchants}\n          />\n          <StatsCard \n            title=\"طلبات معلقة\" \n            value={pendingMerchants}\n            icon={Clock}\n            description=\"بانتظار المراجعة\"\n            loading={loadingMerchants}\n          />\n          <StatsCard \n            title=\"طلبات سحب معلقة\" \n            value={withdrawals.length}\n            icon={Activity}\n            description=\"بانتظار التحويل\"\n            loading={loadingWithdrawals}\n          />\n          <StatsCard \n            title=\"إجمالي الأرصدة\" \n            value={`${(totalBalance / 100).toFixed(2)} ر.س`}\n            icon={TrendingUp}\n            description=\"أرصدة التجار\"\n            loading={loadingMerchants}\n          />\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-2\">\n          <Card>\n            <CardHeader>\n              <CardTitle>أحدث التجار المسجلين</CardTitle>\n              <CardDescription>آخر التجار الذين انضموا للمنصة</CardDescription>\n            </CardHeader>\n            <CardContent>\n              {loadingMerchants ? (\n                <div className=\"flex justify-center py-8\">\n                  <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n                </div>\n              ) : merchants.length === 0 ? (\n                <p className=\"text-center text-muted-foreground py-8\">لا يوجد تجار بعد</p>\n              ) : (\n                <div className=\"space-y-4\">\n                  {merchants.slice(0, 5).map((merchant) => (\n                    <div key={merchant.id} className=\"flex items-center justify-between p-3 bg-muted/30 rounded-lg\" data-testid={`merchant-card-${merchant.id}`}>\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold\">\n                          {merchant.storeName.charAt(0)}\n                        </div>\n                        <div>\n                          <p className=\"font-medium\">{merchant.storeName}</p>\n                          <p className=\"text-xs text-muted-foreground\">{merchant.ownerName}</p>\n                        </div>\n                      </div>\n                      <Badge \n                        variant=\"outline\"\n                        className={\n                          merchant.status === 'active' ? 'border-emerald-200 bg-emerald-50 text-emerald-700' : \n                          merchant.status === 'suspended' ? 'border-red-200 bg-red-50 text-red-700' : \n                          'border-amber-200 bg-amber-50 text-amber-700'\n                        }\n                      >\n                        {merchant.status === 'active' ? 'نشط' : merchant.status === 'suspended' ? 'موقوف' : 'معلق'}\n                      </Badge>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>طلبات السحب المعلقة</CardTitle>\n              <CardDescription>طلبات تحويل الأرصدة للتجار</CardDescription>\n            </CardHeader>\n            <CardContent>\n              {loadingWithdrawals ? (\n                <div className=\"flex justify-center py-8\">\n                  <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n                </div>\n              ) : withdrawals.length === 0 ? (\n                <div className=\"text-center py-8\">\n                  <CheckCircle className=\"w-12 h-12 text-emerald-500 mx-auto mb-2\" />\n                  <p className=\"text-muted-foreground\">لا توجد طلبات سحب معلقة</p>\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  {withdrawals.slice(0, 5).map((withdrawal) => (\n                    <div key={withdrawal.id} className=\"flex items-center justify-between p-3 bg-amber-50 rounded-lg border border-amber-200\" data-testid={`withdrawal-card-${withdrawal.id}`}>\n                      <div>\n                        <p className=\"font-medium\">طلب سحب #{withdrawal.id}</p>\n                        <p className=\"text-xs text-muted-foreground\">\n                          {new Date(withdrawal.createdAt).toLocaleDateString('ar-SA')}\n                        </p>\n                      </div>\n                      <p className=\"font-mono font-bold text-amber-700\">\n                        {Math.abs(withdrawal.amount / 100).toFixed(2)} ر.س\n                      </p>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":7577,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1419,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"px-2 py-1.5 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute right-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5745,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogTrigger,\n  DialogClose,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3835,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\n      \"p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2859,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-3.5 w-3.5 fill-primary\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1410,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":2001,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle, Home } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Link } from \"wouter\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\" dir=\"rtl\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6 text-center\">\n          <div className=\"flex mb-4 gap-2 justify-center\">\n            <AlertCircle className=\"h-12 w-12 text-red-500\" />\n          </div>\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-2\">الصفحة غير موجودة</h1>\n          <p className=\"text-sm text-gray-600 mb-6\">\n            عذراً، لم نتمكن من العثور على الصفحة المطلوبة\n          </p>\n          <Link href=\"/\">\n            <Button className=\"gap-2\">\n              <Home className=\"w-4 h-4\" />\n              العودة للرئيسية\n            </Button>\n          </Link>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":1082,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/sonner.tsx":{"content":"\"use client\"\n\nimport { useTheme } from \"next-themes\"\nimport { Toaster as Sonner } from \"sonner\"\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme()\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  )\n}\n\nexport { Toaster }\n","path":null,"size_bytes":894,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":649,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverAnchor = PopoverPrimitive.Anchor\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }\n","path":null,"size_bytes":1342,"size_tokens":null},"client/src/components/ui/field.tsx":{"content":"\"use client\"\n\nimport { useMemo } from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\nimport { Separator } from \"@/components/ui/separator\"\n\nfunction FieldSet({ className, ...props }: React.ComponentProps<\"fieldset\">) {\n  return (\n    <fieldset\n      data-slot=\"field-set\"\n      className={cn(\n        \"flex flex-col gap-6\",\n        \"has-[>[data-slot=checkbox-group]]:gap-3 has-[>[data-slot=radio-group]]:gap-3\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLegend({\n  className,\n  variant = \"legend\",\n  ...props\n}: React.ComponentProps<\"legend\"> & { variant?: \"legend\" | \"label\" }) {\n  return (\n    <legend\n      data-slot=\"field-legend\"\n      data-variant={variant}\n      className={cn(\n        \"mb-3 font-medium\",\n        \"data-[variant=legend]:text-base\",\n        \"data-[variant=label]:text-sm\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-group\"\n      className={cn(\n        \"group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nconst fieldVariants = cva(\n  \"group/field data-[invalid=true]:text-destructive flex w-full gap-3\",\n  {\n    variants: {\n      orientation: {\n        vertical: [\"flex-col [&>*]:w-full [&>.sr-only]:w-auto\"],\n        horizontal: [\n          \"flex-row items-center\",\n          \"[&>[data-slot=field-label]]:flex-auto\",\n          \"has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px has-[>[data-slot=field-content]]:items-start\",\n        ],\n        responsive: [\n          \"@md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto flex-col [&>*]:w-full [&>.sr-only]:w-auto\",\n          \"@md/field-group:[&>[data-slot=field-label]]:flex-auto\",\n          \"@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px\",\n        ],\n      },\n    },\n    defaultVariants: {\n      orientation: \"vertical\",\n    },\n  }\n)\n\nfunction Field({\n  className,\n  orientation = \"vertical\",\n  ...props\n}: React.ComponentProps<\"div\"> & VariantProps<typeof fieldVariants>) {\n  return (\n    <div\n      role=\"group\"\n      data-slot=\"field\"\n      data-orientation={orientation}\n      className={cn(fieldVariants({ orientation }), className)}\n      {...props}\n    />\n  )\n}\n\nfunction FieldContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-content\"\n      className={cn(\n        \"group/field-content flex flex-1 flex-col gap-1.5 leading-snug\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldLabel({\n  className,\n  ...props\n}: React.ComponentProps<typeof Label>) {\n  return (\n    <Label\n      data-slot=\"field-label\"\n      className={cn(\n        \"group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50\",\n        \"has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>[data-slot=field]]:p-4\",\n        \"has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldTitle({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"field-label\"\n      className={cn(\n        \"flex w-fit items-center gap-2 text-sm font-medium leading-snug group-data-[disabled=true]/field:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldDescription({ className, ...props }: React.ComponentProps<\"p\">) {\n  return (\n    <p\n      data-slot=\"field-description\"\n      className={cn(\n        \"text-muted-foreground text-sm font-normal leading-normal group-has-[[data-orientation=horizontal]]/field:text-balance\",\n        \"nth-last-2:-mt-1 last:mt-0 [[data-variant=legend]+&]:-mt-1.5\",\n        \"[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction FieldSeparator({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  children?: React.ReactNode\n}) {\n  return (\n    <div\n      data-slot=\"field-separator\"\n      data-content={!!children}\n      className={cn(\n        \"relative -my-2 h-5 text-sm group-data-[variant=outline]/field-group:-mb-2\",\n        className\n      )}\n      {...props}\n    >\n      <Separator className=\"absolute inset-0 top-1/2\" />\n      {children && (\n        <span\n          className=\"bg-background text-muted-foreground relative mx-auto block w-fit px-2\"\n          data-slot=\"field-separator-content\"\n        >\n          {children}\n        </span>\n      )}\n    </div>\n  )\n}\n\nfunction FieldError({\n  className,\n  children,\n  errors,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  errors?: Array<{ message?: string } | undefined>\n}) {\n  const content = useMemo(() => {\n    if (children) {\n      return children\n    }\n\n    if (!errors) {\n      return null\n    }\n\n    if (errors?.length === 1 && errors[0]?.message) {\n      return errors[0].message\n    }\n\n    return (\n      <ul className=\"ml-4 flex list-disc flex-col gap-1\">\n        {errors.map(\n          (error, index) =>\n            error?.message && <li key={index}>{error.message}</li>\n        )}\n      </ul>\n    )\n  }, [children, errors])\n\n  if (!content) {\n    return null\n  }\n\n  return (\n    <div\n      role=\"alert\"\n      data-slot=\"field-error\"\n      className={cn(\"text-destructive text-sm font-normal\", className)}\n      {...props}\n    >\n      {content}\n    </div>\n  )\n}\n\nexport {\n  Field,\n  FieldLabel,\n  FieldDescription,\n  FieldError,\n  FieldGroup,\n  FieldLegend,\n  FieldSeparator,\n  FieldSet,\n  FieldContent,\n  FieldTitle,\n}\n","path":null,"size_bytes":6044,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-primary/10\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":266,"size_tokens":null},"server/static.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":547,"size_tokens":null},"client/src/hooks/useAuth.tsx":{"content":"import { createContext, useContext, useEffect, useState, ReactNode } from \"react\";\nimport { useLocation } from \"wouter\";\n\ninterface User {\n  id: number;\n  email: string;\n  name?: string;\n  storeName?: string;\n  ownerName?: string;\n}\n\ninterface AuthContextType {\n  user: User | null;\n  userType: \"merchant\" | \"admin\" | null;\n  isLoading: boolean;\n  isAuthenticated: boolean;\n  logout: () => Promise<void>;\n  refetch: () => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextType | null>(null);\n\nexport function AuthProvider({ children }: { children: ReactNode }) {\n  const [user, setUser] = useState<User | null>(null);\n  const [userType, setUserType] = useState<\"merchant\" | \"admin\" | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const fetchUser = async () => {\n    try {\n      const res = await fetch(\"/api/auth/me\", { credentials: \"include\" });\n      if (res.ok) {\n        const data = await res.json();\n        setUser(data.user);\n        setUserType(data.type);\n      } else {\n        setUser(null);\n        setUserType(null);\n      }\n    } catch {\n      setUser(null);\n      setUserType(null);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    fetchUser();\n  }, []);\n\n  const logout = async () => {\n    try {\n      await fetch(\"/api/auth/logout\", { method: \"POST\", credentials: \"include\" });\n    } finally {\n      setUser(null);\n      setUserType(null);\n    }\n  };\n\n  return (\n    <AuthContext.Provider value={{\n      user,\n      userType,\n      isLoading,\n      isAuthenticated: !!user,\n      logout,\n      refetch: fetchUser\n    }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error(\"useAuth must be used within AuthProvider\");\n  }\n  return context;\n}\n\nexport function ProtectedRoute({ \n  children, \n  requiredRole \n}: { \n  children: ReactNode; \n  requiredRole: \"merchant\" | \"admin\" \n}) {\n  const { isAuthenticated, userType, isLoading } = useAuth();\n  const [, navigate] = useLocation();\n\n  useEffect(() => {\n    if (!isLoading) {\n      if (!isAuthenticated) {\n        navigate(requiredRole === \"admin\" ? \"/admin/login\" : \"/\");\n      } else if (userType !== requiredRole) {\n        navigate(requiredRole === \"admin\" ? \"/admin/login\" : \"/\");\n      }\n    }\n  }, [isAuthenticated, userType, isLoading, requiredRole, navigate]);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\" dir=\"rtl\">\n        <div className=\"text-center\">\n          <div className=\"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-muted-foreground\">جاري التحميل...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated || userType !== requiredRole) {\n    return null;\n  }\n\n  return <>{children}</>;\n}\n","path":null,"size_bytes":2909,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1877,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/pages/admin/Merchants.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport { Search, MoreHorizontal, ShieldCheck, Ban, CheckCircle, Loader2, Store, Eye } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport type { Merchant } from \"@shared/schema\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n} from \"@/components/ui/dialog\";\n\nconst storeTypeLabels: Record<string, string> = {\n  company: \"شركة\",\n  institution: \"مؤسسة\",\n  individual: \"فرد\"\n};\n\nconst deliveryMethodLabels: Record<string, string> = {\n  representative: \"مندوب توصيل\",\n  pickup: \"استلام من الفرع\",\n  all: \"الكل\"\n};\n\nexport default function AdminMerchants() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedMerchant, setSelectedMerchant] = useState<Merchant | null>(null);\n  const [isDetailsOpen, setIsDetailsOpen] = useState(false);\n\n  const { data: merchants = [], isLoading } = useQuery<Merchant[]>({\n    queryKey: [\"/api/admin/merchants\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/merchants\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch merchants\");\n      return res.json();\n    }\n  });\n\n  const updateStatusMutation = useMutation({\n    mutationFn: async ({ id, status }: { id: number; status: string }) => {\n      const res = await fetch(`/api/admin/merchants/${id}/status`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ status })\n      });\n      if (!res.ok) throw new Error(\"Failed to update status\");\n      return res.json();\n    },\n    onSuccess: (_, { status }) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/merchants\"] });\n      toast({\n        title: status === \"active\" ? \"تم قبول المتجر\" : status === \"suspended\" ? \"تم إيقاف المتجر\" : \"تم تحديث الحالة\",\n        className: status === \"active\" ? \"bg-emerald-50 border-emerald-200 text-emerald-800\" : \"\"\n      });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"فشل تحديث الحالة\" });\n    }\n  });\n\n  const pendingCount = merchants.filter(m => m.status === \"pending\").length;\n\n  const filteredMerchants = merchants.filter(m =>\n    m.storeName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    m.ownerName.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    m.email.toLowerCase().includes(searchQuery.toLowerCase())\n  );\n\n  const handleViewDetails = (merchant: Merchant) => {\n    setSelectedMerchant(merchant);\n    setIsDetailsOpen(true);\n  };\n\n  return (\n    <DashboardLayout role=\"admin\">\n      <div className=\"space-y-8\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight font-display\">التجار</h2>\n            <p className=\"text-muted-foreground mt-2\">إدارة حسابات التجار والموافقة على الطلبات الجديدة</p>\n          </div>\n          {pendingCount > 0 && (\n            <Badge variant=\"secondary\" className=\"text-lg px-4 py-2 bg-amber-100 text-amber-800\">\n              <ShieldCheck className=\"w-4 h-4 ml-2\" />\n              {pendingCount} طلبات معلقة\n            </Badge>\n          )}\n        </div>\n\n        <div className=\"flex items-center gap-4 bg-card p-4 rounded-lg border\">\n          <Search className=\"w-5 h-5 text-muted-foreground\" />\n          <Input \n            placeholder=\"بحث عن تاجر بالاسم أو البريد...\" \n            className=\"max-w-sm border-none shadow-none focus-visible:ring-0\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            data-testid=\"input-search-merchants\"\n          />\n        </div>\n\n        {isLoading ? (\n          <div className=\"flex justify-center py-12\">\n            <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n          </div>\n        ) : filteredMerchants.length === 0 ? (\n          <div className=\"text-center py-12 border rounded-lg bg-muted/20\">\n            <Store className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n            <h3 className=\"font-semibold text-lg\">لا توجد متاجر</h3>\n            <p className=\"text-muted-foreground\">لم يتم التسجيل أي تاجر بعد</p>\n          </div>\n        ) : (\n          <div className=\"rounded-md border bg-card\">\n            <Table>\n              <TableHeader>\n                <TableRow>\n                  <TableHead className=\"w-[250px] text-right\">التاجر</TableHead>\n                  <TableHead className=\"text-right\">النوع</TableHead>\n                  <TableHead className=\"text-right\">المدينة</TableHead>\n                  <TableHead className=\"text-right\">الرصيد</TableHead>\n                  <TableHead className=\"text-right\">تاريخ الانضمام</TableHead>\n                  <TableHead className=\"text-right\">الحالة</TableHead>\n                  <TableHead className=\"text-right\">إجراءات</TableHead>\n                </TableRow>\n              </TableHeader>\n              <TableBody>\n                {filteredMerchants.map((merchant) => (\n                  <TableRow key={merchant.id} data-testid={`row-merchant-${merchant.id}`}>\n                    <TableCell>\n                      <div className=\"flex items-center gap-3\">\n                        <Avatar className=\"h-9 w-9\">\n                          <AvatarImage src={`https://avatar.vercel.sh/${merchant.email}`} />\n                          <AvatarFallback>{merchant.storeName.charAt(0)}</AvatarFallback>\n                        </Avatar>\n                        <div className=\"flex flex-col\">\n                          <span className=\"font-medium\">{merchant.storeName}</span>\n                          <span className=\"text-xs text-muted-foreground\">{merchant.ownerName} ({merchant.email})</span>\n                        </div>\n                      </div>\n                    </TableCell>\n                    <TableCell>{storeTypeLabels[merchant.storeType] || merchant.storeType}</TableCell>\n                    <TableCell>{merchant.city}</TableCell>\n                    <TableCell className=\"font-mono\">{(merchant.balance / 100).toFixed(2)} ر.س</TableCell>\n                    <TableCell className=\"font-mono text-sm\">\n                      {new Date(merchant.createdAt).toLocaleDateString('ar-SA')}\n                    </TableCell>\n                    <TableCell>\n                      <Badge \n                        variant=\"outline\"\n                        className={\n                          merchant.status === 'active' ? 'border-emerald-200 bg-emerald-50 text-emerald-700' : \n                          merchant.status === 'suspended' ? 'border-red-200 bg-red-50 text-red-700' : \n                          'border-amber-200 bg-amber-50 text-amber-700'\n                        }\n                      >\n                        {\n                          merchant.status === 'active' ? 'نشط' : \n                          merchant.status === 'suspended' ? 'موقوف' : 'قيد المراجعة'\n                        }\n                      </Badge>\n                    </TableCell>\n                    <TableCell>\n                      <DropdownMenu>\n                        <DropdownMenuTrigger asChild>\n                          <Button variant=\"ghost\" className=\"h-8 w-8 p-0\" data-testid={`button-merchant-menu-${merchant.id}`}>\n                            <span className=\"sr-only\">Open menu</span>\n                            <MoreHorizontal className=\"h-4 w-4\" />\n                          </Button>\n                        </DropdownMenuTrigger>\n                        <DropdownMenuContent align=\"end\">\n                          <DropdownMenuItem \n                            className=\"gap-2 cursor-pointer\"\n                            onClick={() => handleViewDetails(merchant)}\n                          >\n                            <Eye className=\"w-4 h-4\" /> تفاصيل الحساب\n                          </DropdownMenuItem>\n                          \n                          {merchant.status === 'pending' && (\n                            <DropdownMenuItem \n                              className=\"gap-2 cursor-pointer text-emerald-600 focus:text-emerald-700\"\n                              onClick={() => updateStatusMutation.mutate({ id: merchant.id, status: \"active\" })}\n                            >\n                              <CheckCircle className=\"w-4 h-4\" /> قبول المتجر\n                            </DropdownMenuItem>\n                          )}\n\n                          {merchant.status === 'active' && (\n                            <DropdownMenuItem \n                              className=\"gap-2 cursor-pointer text-destructive focus:text-destructive\"\n                              onClick={() => updateStatusMutation.mutate({ id: merchant.id, status: \"suspended\" })}\n                            >\n                              <Ban className=\"w-4 h-4\" /> إيقاف الحساب\n                            </DropdownMenuItem>\n                          )}\n\n                          {merchant.status === 'suspended' && (\n                            <DropdownMenuItem \n                              className=\"gap-2 cursor-pointer text-emerald-600 focus:text-emerald-700\"\n                              onClick={() => updateStatusMutation.mutate({ id: merchant.id, status: \"active\" })}\n                            >\n                              <CheckCircle className=\"w-4 h-4\" /> إعادة تفعيل\n                            </DropdownMenuItem>\n                          )}\n                        </DropdownMenuContent>\n                      </DropdownMenu>\n                    </TableCell>\n                  </TableRow>\n                ))}\n              </TableBody>\n            </Table>\n          </div>\n        )}\n\n        <Dialog open={isDetailsOpen} onOpenChange={setIsDetailsOpen}>\n          <DialogContent className=\"max-w-2xl\">\n            <DialogHeader>\n              <DialogTitle>تفاصيل المتجر</DialogTitle>\n              <DialogDescription>معلومات كاملة عن المتجر والمالك</DialogDescription>\n            </DialogHeader>\n            {selectedMerchant && (\n              <div className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">اسم المتجر</p>\n                    <p className=\"font-medium\">{selectedMerchant.storeName}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">اسم المالك</p>\n                    <p className=\"font-medium\">{selectedMerchant.ownerName}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">البريد الإلكتروني</p>\n                    <p className=\"font-medium font-mono\">{selectedMerchant.email}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">رقم الجوال</p>\n                    <p className=\"font-medium font-mono\">{selectedMerchant.mobile}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">نوع الكيان</p>\n                    <p className=\"font-medium\">{storeTypeLabels[selectedMerchant.storeType]}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">رقم السجل</p>\n                    <p className=\"font-medium font-mono\">{selectedMerchant.registrationNumber}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">المدينة</p>\n                    <p className=\"font-medium\">{selectedMerchant.city}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">طريقة التوصيل</p>\n                    <p className=\"font-medium\">{deliveryMethodLabels[selectedMerchant.deliveryMethod]}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">الرصيد الحالي</p>\n                    <p className=\"font-medium font-mono\">{(selectedMerchant.balance / 100).toFixed(2)} ر.س</p>\n                  </div>\n                  <div>\n                    <p className=\"text-sm text-muted-foreground\">تاريخ التسجيل</p>\n                    <p className=\"font-medium\">{new Date(selectedMerchant.createdAt).toLocaleDateString('ar-SA')}</p>\n                  </div>\n                </div>\n                {selectedMerchant.branches && selectedMerchant.branches.length > 0 && (\n                  <div>\n                    <p className=\"text-sm text-muted-foreground mb-2\">الفروع</p>\n                    <div className=\"space-y-2\">\n                      {selectedMerchant.branches.map((branch: any, idx: number) => (\n                        <div key={idx} className=\"p-3 bg-muted/50 rounded-md\">\n                          <p className=\"font-medium\">{branch.name}</p>\n                          <a href={branch.mapLink} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-xs text-primary hover:underline\">\n                            {branch.mapLink}\n                          </a>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":14459,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1148,"size_tokens":null},"scripts/seed.ts":{"content":"import { db } from \"../server/db\";\nimport { eq } from \"drizzle-orm\";\nimport * as schema from \"../shared/schema\";\nimport bcrypt from \"bcryptjs\";\n\nconst saudiCities = [\"الرياض\", \"جدة\", \"مكة المكرمة\", \"المدينة المنورة\", \"الدمام\", \"الخبر\", \"الظهران\", \"تبوك\", \"أبها\", \"الطائف\"];\n\nconst customerNames = [\n  \"أحمد محمد العتيبي\",\n  \"فاطمة سعود القحطاني\",\n  \"محمد عبدالله الغامدي\",\n  \"نورة خالد الشمري\",\n  \"سلطان فهد الدوسري\",\n  \"هند إبراهيم المطيري\",\n  \"عبدالرحمن سالم الزهراني\",\n  \"ريم عبدالعزيز الحربي\",\n  \"خالد ناصر العنزي\",\n  \"سارة يوسف البلوي\",\n];\n\nconst flowerProducts = [\n  { name: \"باقة الورد الأحمر\", description: \"باقة رومانسية من الورد الأحمر الفاخر\", price: 150, category: \"flowers\" },\n  { name: \"باقة الزنبق الأبيض\", description: \"باقة أنيقة من الزنبق الأبيض النقي\", price: 200, category: \"flowers\" },\n  { name: \"باقة البنفسج\", description: \"باقة ساحرة من البنفسج الطبيعي\", price: 120, category: \"flowers\" },\n  { name: \"باقة الأوركيد\", description: \"أوركيد فاخر للمناسبات الخاصة\", price: 350, category: \"flowers\" },\n  { name: \"باقة الورد المشكل\", description: \"تشكيلة متنوعة من أجمل الورود\", price: 180, category: \"flowers\" },\n  { name: \"باقة التوليب\", description: \"توليب ملون لإضافة البهجة\", price: 250, category: \"flowers\" },\n];\n\nconst giftProducts = [\n  { name: \"صندوق الشوكولاتة الفاخرة\", description: \"مجموعة فاخرة من أجود أنواع الشوكولاتة\", price: 280, category: \"gifts\" },\n  { name: \"دمية دب كبيرة\", description: \"دمية دب ناعمة وكبيرة للهدايا\", price: 150, category: \"gifts\" },\n  { name: \"طقم العطور الفاخر\", description: \"طقم عطور راقي للهدايا المميزة\", price: 450, category: \"gifts\" },\n  { name: \"صندوق الحلويات العربية\", description: \"تشكيلة من أفخر الحلويات العربية\", price: 200, category: \"gifts\" },\n  { name: \"سلة الفواكه الطازجة\", description: \"سلة فواكه موسمية طازجة\", price: 180, category: \"gifts\" },\n  { name: \"صندوق البخور والعود\", description: \"مجموعة بخور وعود أصلي\", price: 320, category: \"gifts\" },\n];\n\nconst orderStatuses = [\"pending\", \"processing\", \"shipped\", \"delivered\", \"completed\", \"cancelled\"];\nconst deliveryMethods = [\"delivery\", \"pickup\"];\n\nconst messageTemplates = {\n  customer: [\n    \"هل يمكن توصيل الطلب اليوم؟\",\n    \"شكراً على سرعة الاستجابة\",\n    \"هل يمكن تغيير العنوان؟\",\n    \"متى سيتم توصيل الطلب؟\",\n    \"أريد إضافة بطاقة تهنئة للطلب\",\n  ],\n  merchant: [\n    \"تم استلام طلبك وجاري التجهيز\",\n    \"الطلب في الطريق إليك\",\n    \"نعتذر عن التأخير، سيصل قريباً\",\n    \"شكراً لتعاملك معنا\",\n    \"تم تحديث حالة طلبك\",\n  ],\n};\n\nasync function seed() {\n  console.log(\"🌱 بدء عملية إضافة البيانات التجريبية...\");\n\n  try {\n    const existingMerchant = await db.select().from(schema.merchants).where(\n      eq(schema.merchants.username, \"test_merchant\")\n    ).limit(1);\n\n    let merchantId: number;\n\n    if (existingMerchant.length > 0) {\n      merchantId = existingMerchant[0].id;\n      console.log(\"✅ التاجر موجود بالفعل، تخطي الإنشاء\");\n    } else {\n      const hashedPassword = await bcrypt.hash(\"password123\", 10);\n      const [merchant] = await db.insert(schema.merchants).values({\n        ownerName: \"محمد أحمد\",\n        storeName: \"متجر الورود الفاخرة\",\n        username: \"test_merchant\",\n        bio: \"متجر متخصص في تقديم أجمل الورود والهدايا الفاخرة\",\n        email: \"merchant@test.com\",\n        mobile: \"0501234567\",\n        password: hashedPassword,\n        storeType: \"flowers\",\n        category: \"ورود وهدايا\",\n        city: \"الرياض\",\n        registrationNumber: \"1234567890\",\n        deliveryMethod: \"both\",\n        status: \"active\",\n        bankName: \"البنك الأهلي\",\n        iban: \"SA1234567890123456789012\",\n        accountHolderName: \"محمد أحمد\",\n        balance: 5000,\n        socialLinks: {\n          instagram: \"https://instagram.com/flowers_store\",\n          twitter: \"https://twitter.com/flowers_store\",\n        },\n      }).returning();\n      merchantId = merchant.id;\n      console.log(\"✅ تم إنشاء التاجر التجريبي\");\n    }\n\n    console.log(\"📦 إضافة العملاء...\");\n    const insertedCustomers: number[] = [];\n    for (let i = 0; i < customerNames.length; i++) {\n      try {\n        const [customer] = await db.insert(schema.customers).values({\n          name: customerNames[i],\n          email: `customer${i + 1}@test.com`,\n          mobile: `055${String(i + 1).padStart(7, \"0\")}`,\n          city: saudiCities[i % saudiCities.length],\n        }).returning();\n        insertedCustomers.push(customer.id);\n      } catch (e) {\n        const existing = await db.select().from(schema.customers).limit(10);\n        if (existing.length > 0) {\n          insertedCustomers.push(...existing.map(c => c.id));\n          break;\n        }\n      }\n    }\n    console.log(`✅ تم إضافة ${insertedCustomers.length} عملاء`);\n\n    console.log(\"🎁 إضافة المنتجات...\");\n    const allProducts = [...flowerProducts, ...giftProducts];\n    const insertedProducts: number[] = [];\n    for (const product of allProducts) {\n      try {\n        const [p] = await db.insert(schema.products).values({\n          merchantId,\n          name: product.name,\n          description: product.description,\n          price: product.price,\n          stock: Math.floor(Math.random() * 50) + 10,\n          productType: product.category === \"flowers\" ? \"flowers\" : \"gifts\",\n          category: product.category,\n          images: [\"/placeholder-product.jpg\"],\n          status: \"active\",\n        }).returning();\n        insertedProducts.push(p.id);\n      } catch (e) {\n        console.log(`تخطي المنتج المكرر: ${product.name}`);\n      }\n    }\n    console.log(`✅ تم إضافة ${insertedProducts.length} منتجات`);\n\n    if (insertedProducts.length === 0) {\n      const existingProducts = await db.select().from(schema.products).limit(12);\n      insertedProducts.push(...existingProducts.map(p => p.id));\n    }\n\n    console.log(\"📋 إضافة الطلبات...\");\n    const insertedOrders: { id: number; customerId: number; productId: number; totalAmount: number; isPaid: boolean }[] = [];\n    const orderCount = 15;\n    for (let i = 0; i < orderCount; i++) {\n      const customerId = insertedCustomers[i % insertedCustomers.length];\n      const productId = insertedProducts[i % insertedProducts.length];\n      const product = allProducts[i % allProducts.length];\n      const quantity = Math.floor(Math.random() * 3) + 1;\n      const totalAmount = product.price * quantity;\n      const status = orderStatuses[Math.floor(Math.random() * orderStatuses.length)];\n      const isPaid = status === \"completed\" || status === \"delivered\" || Math.random() > 0.5;\n      \n      try {\n        const [order] = await db.insert(schema.orders).values({\n          orderNumber: `GL-${Date.now()}-${i}`,\n          customerId,\n          merchantId,\n          productId,\n          quantity,\n          totalAmount,\n          status,\n          customerNote: i % 3 === 0 ? \"يرجى التوصيل في الصباح\" : null,\n          deliveryAddress: `شارع الملك فهد، حي ${saudiCities[i % saudiCities.length]}`,\n          deliveryMethod: deliveryMethods[i % 2],\n          isPaid,\n        }).returning();\n        insertedOrders.push({ id: order.id, customerId, productId, totalAmount, isPaid });\n      } catch (e) {\n        console.log(`تخطي طلب مكرر`);\n      }\n    }\n    console.log(`✅ تم إضافة ${insertedOrders.length} طلبات`);\n\n    console.log(\"💬 إضافة الرسائل...\");\n    let messageCount = 0;\n    for (const order of insertedOrders) {\n      const messagesPerOrder = Math.floor(Math.random() * 4) + 2;\n      for (let j = 0; j < messagesPerOrder; j++) {\n        const isCustomer = j % 2 === 0;\n        const messages = isCustomer ? messageTemplates.customer : messageTemplates.merchant;\n        try {\n          await db.insert(schema.orderMessages).values({\n            orderId: order.id,\n            senderId: isCustomer ? order.customerId : merchantId,\n            senderType: isCustomer ? \"customer\" : \"merchant\",\n            message: messages[Math.floor(Math.random() * messages.length)],\n          });\n          messageCount++;\n        } catch (e) {\n          console.log(`تخطي رسالة مكررة`);\n        }\n      }\n    }\n    console.log(`✅ تم إضافة ${messageCount} رسائل`);\n\n    console.log(\"💰 إضافة المعاملات المالية...\");\n    let transactionCount = 0;\n    for (const order of insertedOrders.filter(o => o.isPaid)) {\n      try {\n        await db.insert(schema.transactions).values({\n          merchantId,\n          orderId: order.id,\n          type: \"sale\",\n          amount: order.totalAmount,\n          status: \"completed\",\n          description: `دخل من الطلب رقم ${order.id}`,\n        });\n        transactionCount++;\n      } catch (e) {\n        console.log(`تخطي معاملة مكررة`);\n      }\n    }\n\n    const withdrawalRequests = [\n      { amount: 500, status: \"completed\", description: \"طلب سحب مكتمل\" },\n      { amount: 1000, status: \"pending\", description: \"طلب سحب قيد المراجعة\" },\n      { amount: 750, status: \"rejected\", description: \"طلب سحب مرفوض - رصيد غير كافي\" },\n    ];\n    for (const withdrawal of withdrawalRequests) {\n      try {\n        await db.insert(schema.transactions).values({\n          merchantId,\n          orderId: null,\n          type: \"withdrawal\",\n          amount: withdrawal.amount,\n          status: withdrawal.status,\n          description: withdrawal.description,\n        });\n        transactionCount++;\n      } catch (e) {\n        console.log(`تخطي معاملة مكررة`);\n      }\n    }\n    console.log(`✅ تم إضافة ${transactionCount} معاملات مالية`);\n\n    console.log(\"👤 إضافة المدير...\");\n    const existingAdmin = await db.select().from(schema.admins).where(\n      eq(schema.admins.email, \"admin@glorda.com\")\n    ).limit(1);\n    \n    if (existingAdmin.length === 0) {\n      const adminPassword = await bcrypt.hash(\"admin123\", 10);\n      await db.insert(schema.admins).values({\n        email: \"admin@glorda.com\",\n        password: adminPassword,\n        name: \"مدير النظام\",\n      });\n      console.log(\"✅ تم إنشاء المدير\");\n    } else {\n      console.log(\"✅ المدير موجود بالفعل\");\n    }\n\n    console.log(\"🏙️ إضافة المدن...\");\n    let cityCount = 0;\n    for (let i = 0; i < saudiCities.length; i++) {\n      try {\n        await db.insert(schema.cities).values({\n          name: saudiCities[i],\n          nameEn: [\"Riyadh\", \"Jeddah\", \"Makkah\", \"Madinah\", \"Dammam\", \"Khobar\", \"Dhahran\", \"Tabuk\", \"Abha\", \"Taif\"][i],\n          isActive: true,\n          sortOrder: i,\n        });\n        cityCount++;\n      } catch (e) {\n        console.log(`تخطي مدينة مكررة: ${saudiCities[i]}`);\n      }\n    }\n    console.log(`✅ تم إضافة ${cityCount} مدن`);\n\n    console.log(\"📂 إضافة التصنيفات...\");\n    const categoriesData = [\n      { name: \"ورود\", nameEn: \"Flowers\", icon: \"🌹\" },\n      { name: \"هدايا\", nameEn: \"Gifts\", icon: \"🎁\" },\n      { name: \"شوكولاتة\", nameEn: \"Chocolate\", icon: \"🍫\" },\n      { name: \"حلويات\", nameEn: \"Sweets\", icon: \"🍬\" },\n      { name: \"عطور\", nameEn: \"Perfumes\", icon: \"🌸\" },\n    ];\n    let categoryCount = 0;\n    for (let i = 0; i < categoriesData.length; i++) {\n      try {\n        await db.insert(schema.categories).values({\n          name: categoriesData[i].name,\n          nameEn: categoriesData[i].nameEn,\n          icon: categoriesData[i].icon,\n          isActive: true,\n          sortOrder: i,\n        });\n        categoryCount++;\n      } catch (e) {\n        console.log(`تخطي تصنيف مكرر: ${categoriesData[i].name}`);\n      }\n    }\n    console.log(`✅ تم إضافة ${categoryCount} تصنيفات`);\n\n    console.log(\"🎉 تمت عملية إضافة البيانات التجريبية بنجاح!\");\n    console.log(\"\\n📌 بيانات الدخول التجريبية:\");\n    console.log(\"   التاجر: test_merchant / password123\");\n    console.log(\"   المدير: admin@glorda.com / admin123\");\n  } catch (error) {\n    console.error(\"❌ خطأ في إضافة البيانات:\", error);\n    throw error;\n  }\n}\n\nseed().then(() => process.exit(0)).catch(() => process.exit(1));\n","path":null,"size_bytes":13378,"size_tokens":null},"client/src/pages/admin/Policies.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { FileText, Shield, BookOpen, Loader2, Save, Smartphone, Store } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState, useEffect } from \"react\";\n\ninterface AppSetting {\n  id: number;\n  key: string;\n  value: string | null;\n  valueJson: any;\n  updatedAt: string;\n}\n\nexport default function AdminPolicies() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Customer App Policies\n  const [customerPrivacyPolicy, setCustomerPrivacyPolicy] = useState(\"\");\n  const [customerTermsConditions, setCustomerTermsConditions] = useState(\"\");\n  const [customerAboutUs, setCustomerAboutUs] = useState(\"\");\n  \n  // Merchant Panel Policies\n  const [merchantPrivacyPolicy, setMerchantPrivacyPolicy] = useState(\"\");\n  const [merchantTermsConditions, setMerchantTermsConditions] = useState(\"\");\n  const [merchantAboutUs, setMerchantAboutUs] = useState(\"\");\n\n  const { data: settings = [], isLoading } = useQuery<AppSetting[]>({\n    queryKey: [\"/api/admin/settings\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/settings\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch settings\");\n      return res.json();\n    }\n  });\n\n  useEffect(() => {\n    if (settings.length > 0) {\n      // Customer policies (existing keys for backward compatibility)\n      const custPrivacy = settings.find(s => s.key === \"privacy_policy\");\n      const custTerms = settings.find(s => s.key === \"terms_conditions\");\n      const custAbout = settings.find(s => s.key === \"about_us\");\n      \n      if (custPrivacy?.value) setCustomerPrivacyPolicy(custPrivacy.value);\n      if (custTerms?.value) setCustomerTermsConditions(custTerms.value);\n      if (custAbout?.value) setCustomerAboutUs(custAbout.value);\n      \n      // Merchant policies (new keys)\n      const merchPrivacy = settings.find(s => s.key === \"merchant_privacy_policy\");\n      const merchTerms = settings.find(s => s.key === \"merchant_terms_conditions\");\n      const merchAbout = settings.find(s => s.key === \"merchant_about_us\");\n      \n      if (merchPrivacy?.value) setMerchantPrivacyPolicy(merchPrivacy.value);\n      if (merchTerms?.value) setMerchantTermsConditions(merchTerms.value);\n      if (merchAbout?.value) setMerchantAboutUs(merchAbout.value);\n    }\n  }, [settings]);\n\n  const saveMutation = useMutation({\n    mutationFn: async ({ key, value }: { key: string; value: string }) => {\n      const res = await fetch(\"/api/admin/settings\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ key, value })\n      });\n      if (!res.ok) throw new Error(\"Failed to save setting\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/settings\"] });\n      toast({ title: \"تم الحفظ بنجاح\", className: \"bg-emerald-50 border-emerald-200 text-emerald-800\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"فشل الحفظ\" });\n    }\n  });\n\n  if (isLoading) {\n    return (\n      <DashboardLayout role=\"admin\">\n        <div className=\"flex justify-center py-12\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout role=\"admin\">\n      <div className=\"space-y-8\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight font-display\">السياسات والشروط</h2>\n          <p className=\"text-muted-foreground mt-2\">إدارة سياسة الخصوصية والشروط والأحكام للعملاء والتجار</p>\n        </div>\n\n        <Tabs defaultValue=\"customers\" className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-2 max-w-md\">\n            <TabsTrigger value=\"customers\" className=\"gap-2\">\n              <Smartphone className=\"w-4 h-4\" />\n              تطبيق العملاء\n            </TabsTrigger>\n            <TabsTrigger value=\"merchants\" className=\"gap-2\">\n              <Store className=\"w-4 h-4\" />\n              لوحة التجار\n            </TabsTrigger>\n          </TabsList>\n\n          {/* Customer App Policies */}\n          <TabsContent value=\"customers\">\n            <Tabs defaultValue=\"privacy\" className=\"space-y-6\">\n              <TabsList className=\"grid w-full grid-cols-3 max-w-xl\">\n                <TabsTrigger value=\"privacy\" className=\"gap-2\">\n                  <Shield className=\"w-4 h-4\" />\n                  سياسة الخصوصية\n                </TabsTrigger>\n                <TabsTrigger value=\"terms\" className=\"gap-2\">\n                  <FileText className=\"w-4 h-4\" />\n                  الشروط والأحكام\n                </TabsTrigger>\n                <TabsTrigger value=\"about\" className=\"gap-2\">\n                  <BookOpen className=\"w-4 h-4\" />\n                  عن التطبيق\n                </TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"privacy\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <Shield className=\"w-5 h-5\" />\n                      سياسة الخصوصية - تطبيق العملاء\n                    </CardTitle>\n                    <CardDescription>\n                      سياسة الخصوصية المعروضة للعملاء في التطبيق\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"space-y-2\">\n                      <Label>محتوى سياسة الخصوصية</Label>\n                      <Textarea\n                        placeholder=\"اكتب سياسة الخصوصية هنا...\"\n                        value={customerPrivacyPolicy}\n                        onChange={(e) => setCustomerPrivacyPolicy(e.target.value)}\n                        className=\"min-h-[300px] font-sans\"\n                        data-testid=\"textarea-customer-privacy\"\n                      />\n                    </div>\n                    <Button \n                      onClick={() => saveMutation.mutate({ key: \"privacy_policy\", value: customerPrivacyPolicy })}\n                      disabled={saveMutation.isPending}\n                      className=\"gap-2\"\n                      data-testid=\"button-save-customer-privacy\"\n                    >\n                      {saveMutation.isPending ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Save className=\"w-4 h-4\" />}\n                      حفظ التغييرات\n                    </Button>\n                  </CardContent>\n                </Card>\n              </TabsContent>\n\n              <TabsContent value=\"terms\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <FileText className=\"w-5 h-5\" />\n                      الشروط والأحكام - تطبيق العملاء\n                    </CardTitle>\n                    <CardDescription>\n                      الشروط والأحكام المعروضة للعملاء في التطبيق\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"space-y-2\">\n                      <Label>محتوى الشروط والأحكام</Label>\n                      <Textarea\n                        placeholder=\"اكتب الشروط والأحكام هنا...\"\n                        value={customerTermsConditions}\n                        onChange={(e) => setCustomerTermsConditions(e.target.value)}\n                        className=\"min-h-[300px] font-sans\"\n                        data-testid=\"textarea-customer-terms\"\n                      />\n                    </div>\n                    <Button \n                      onClick={() => saveMutation.mutate({ key: \"terms_conditions\", value: customerTermsConditions })}\n                      disabled={saveMutation.isPending}\n                      className=\"gap-2\"\n                      data-testid=\"button-save-customer-terms\"\n                    >\n                      {saveMutation.isPending ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Save className=\"w-4 h-4\" />}\n                      حفظ التغييرات\n                    </Button>\n                  </CardContent>\n                </Card>\n              </TabsContent>\n\n              <TabsContent value=\"about\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <BookOpen className=\"w-5 h-5\" />\n                      عن التطبيق - تطبيق العملاء\n                    </CardTitle>\n                    <CardDescription>\n                      معلومات عن التطبيق المعروضة للعملاء\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"space-y-2\">\n                      <Label>محتوى صفحة عن التطبيق</Label>\n                      <Textarea\n                        placeholder=\"اكتب معلومات عن التطبيق هنا...\"\n                        value={customerAboutUs}\n                        onChange={(e) => setCustomerAboutUs(e.target.value)}\n                        className=\"min-h-[300px] font-sans\"\n                        data-testid=\"textarea-customer-about\"\n                      />\n                    </div>\n                    <Button \n                      onClick={() => saveMutation.mutate({ key: \"about_us\", value: customerAboutUs })}\n                      disabled={saveMutation.isPending}\n                      className=\"gap-2\"\n                      data-testid=\"button-save-customer-about\"\n                    >\n                      {saveMutation.isPending ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Save className=\"w-4 h-4\" />}\n                      حفظ التغييرات\n                    </Button>\n                  </CardContent>\n                </Card>\n              </TabsContent>\n            </Tabs>\n          </TabsContent>\n\n          {/* Merchant Panel Policies */}\n          <TabsContent value=\"merchants\">\n            <Tabs defaultValue=\"privacy\" className=\"space-y-6\">\n              <TabsList className=\"grid w-full grid-cols-3 max-w-xl\">\n                <TabsTrigger value=\"privacy\" className=\"gap-2\">\n                  <Shield className=\"w-4 h-4\" />\n                  سياسة الخصوصية\n                </TabsTrigger>\n                <TabsTrigger value=\"terms\" className=\"gap-2\">\n                  <FileText className=\"w-4 h-4\" />\n                  الشروط والأحكام\n                </TabsTrigger>\n                <TabsTrigger value=\"about\" className=\"gap-2\">\n                  <BookOpen className=\"w-4 h-4\" />\n                  عن المنصة\n                </TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"privacy\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <Shield className=\"w-5 h-5\" />\n                      سياسة الخصوصية - لوحة التجار\n                    </CardTitle>\n                    <CardDescription>\n                      سياسة الخصوصية المعروضة للتجار عند التسجيل وتسجيل الدخول\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"space-y-2\">\n                      <Label>محتوى سياسة الخصوصية</Label>\n                      <Textarea\n                        placeholder=\"اكتب سياسة الخصوصية للتجار هنا...\"\n                        value={merchantPrivacyPolicy}\n                        onChange={(e) => setMerchantPrivacyPolicy(e.target.value)}\n                        className=\"min-h-[300px] font-sans\"\n                        data-testid=\"textarea-merchant-privacy\"\n                      />\n                    </div>\n                    <Button \n                      onClick={() => saveMutation.mutate({ key: \"merchant_privacy_policy\", value: merchantPrivacyPolicy })}\n                      disabled={saveMutation.isPending}\n                      className=\"gap-2\"\n                      data-testid=\"button-save-merchant-privacy\"\n                    >\n                      {saveMutation.isPending ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Save className=\"w-4 h-4\" />}\n                      حفظ التغييرات\n                    </Button>\n                  </CardContent>\n                </Card>\n              </TabsContent>\n\n              <TabsContent value=\"terms\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <FileText className=\"w-5 h-5\" />\n                      الشروط والأحكام - لوحة التجار\n                    </CardTitle>\n                    <CardDescription>\n                      الشروط والأحكام التي يجب على التجار الموافقة عليها عند التسجيل وتسجيل الدخول\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"space-y-2\">\n                      <Label>محتوى الشروط والأحكام</Label>\n                      <Textarea\n                        placeholder=\"اكتب الشروط والأحكام للتجار هنا...\"\n                        value={merchantTermsConditions}\n                        onChange={(e) => setMerchantTermsConditions(e.target.value)}\n                        className=\"min-h-[300px] font-sans\"\n                        data-testid=\"textarea-merchant-terms\"\n                      />\n                    </div>\n                    <Button \n                      onClick={() => saveMutation.mutate({ key: \"merchant_terms_conditions\", value: merchantTermsConditions })}\n                      disabled={saveMutation.isPending}\n                      className=\"gap-2\"\n                      data-testid=\"button-save-merchant-terms\"\n                    >\n                      {saveMutation.isPending ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Save className=\"w-4 h-4\" />}\n                      حفظ التغييرات\n                    </Button>\n                  </CardContent>\n                </Card>\n              </TabsContent>\n\n              <TabsContent value=\"about\">\n                <Card>\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <BookOpen className=\"w-5 h-5\" />\n                      عن المنصة - لوحة التجار\n                    </CardTitle>\n                    <CardDescription>\n                      معلومات عن المنصة المعروضة للتجار\n                    </CardDescription>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <div className=\"space-y-2\">\n                      <Label>محتوى صفحة عن المنصة</Label>\n                      <Textarea\n                        placeholder=\"اكتب معلومات عن المنصة للتجار هنا...\"\n                        value={merchantAboutUs}\n                        onChange={(e) => setMerchantAboutUs(e.target.value)}\n                        className=\"min-h-[300px] font-sans\"\n                        data-testid=\"textarea-merchant-about\"\n                      />\n                    </div>\n                    <Button \n                      onClick={() => saveMutation.mutate({ key: \"merchant_about_us\", value: merchantAboutUs })}\n                      disabled={saveMutation.isPending}\n                      className=\"gap-2\"\n                      data-testid=\"button-save-merchant-about\"\n                    >\n                      {saveMutation.isPending ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <Save className=\"w-4 h-4\" />}\n                      حفظ التغييرات\n                    </Button>\n                  </CardContent>\n                </Card>\n              </TabsContent>\n            </Tabs>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":17109,"size_tokens":null},"client/src/pages/admin/AppSettings.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogTrigger,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Image, Grid3X3, Plus, Trash2, Loader2, Edit, GripVertical } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState, useRef } from \"react\";\n\ninterface Banner {\n  id: number;\n  title: string;\n  image: string;\n  link: string | null;\n  isActive: boolean;\n  sortOrder: number;\n  createdAt: string;\n}\n\ninterface Category {\n  id: number;\n  name: string;\n  nameEn: string | null;\n  icon: string | null;\n  image: string | null;\n  isActive: boolean;\n  sortOrder: number;\n  createdAt: string;\n}\n\nexport default function AppSettings() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  \n  const [isAddBannerOpen, setIsAddBannerOpen] = useState(false);\n  const [isAddCategoryOpen, setIsAddCategoryOpen] = useState(false);\n  const [editingBanner, setEditingBanner] = useState<Banner | null>(null);\n  const [editingCategory, setEditingCategory] = useState<Category | null>(null);\n  const [isUploading, setIsUploading] = useState(false);\n  \n  const [bannerForm, setBannerForm] = useState({\n    title: \"\",\n    image: \"\",\n    link: \"\",\n    isActive: true,\n    sortOrder: 0\n  });\n  \n  const [categoryForm, setCategoryForm] = useState({\n    name: \"\",\n    nameEn: \"\",\n    icon: \"\",\n    image: \"\",\n    isActive: true,\n    sortOrder: 0\n  });\n\n  const { data: banners = [], isLoading: loadingBanners } = useQuery<Banner[]>({\n    queryKey: [\"/api/admin/banners\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/banners\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch banners\");\n      return res.json();\n    }\n  });\n\n  const { data: categories = [], isLoading: loadingCategories } = useQuery<Category[]>({\n    queryKey: [\"/api/admin/categories\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/categories\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch categories\");\n      return res.json();\n    }\n  });\n\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>, type: 'banner' | 'category') => {\n    const files = e.target.files;\n    if (!files || files.length === 0) return;\n\n    setIsUploading(true);\n    const formData = new FormData();\n    formData.append(\"images\", files[0]);\n\n    try {\n      const res = await fetch(\"/api/merchant/products/upload-images\", {\n        method: \"POST\",\n        credentials: \"include\",\n        body: formData\n      });\n\n      if (!res.ok) {\n        throw new Error(\"فشل رفع الصورة\");\n      }\n\n      const data = await res.json();\n      const imageUrl = data.images[0];\n      \n      if (type === 'banner') {\n        setBannerForm(prev => ({ ...prev, image: imageUrl }));\n      } else {\n        setCategoryForm(prev => ({ ...prev, image: imageUrl }));\n      }\n      toast({ title: \"تم رفع الصورة بنجاح\" });\n    } catch (error: any) {\n      toast({ variant: \"destructive\", title: error.message || \"فشل رفع الصورة\" });\n    } finally {\n      setIsUploading(false);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = \"\";\n      }\n    }\n  };\n\n  // Banner mutations\n  const createBannerMutation = useMutation({\n    mutationFn: async (data: typeof bannerForm) => {\n      const res = await fetch(\"/api/admin/banners\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify(data)\n      });\n      if (!res.ok) throw new Error(\"Failed to create banner\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/banners\"] });\n      toast({ title: \"تم إضافة البانر بنجاح\" });\n      setIsAddBannerOpen(false);\n      resetBannerForm();\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"فشل إضافة البانر\" });\n    }\n  });\n\n  const updateBannerMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: Partial<typeof bannerForm> }) => {\n      const res = await fetch(`/api/admin/banners/${id}`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify(data)\n      });\n      if (!res.ok) throw new Error(\"Failed to update banner\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/banners\"] });\n      toast({ title: \"تم تحديث البانر بنجاح\" });\n      setEditingBanner(null);\n      resetBannerForm();\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"فشل تحديث البانر\" });\n    }\n  });\n\n  const deleteBannerMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const res = await fetch(`/api/admin/banners/${id}`, {\n        method: \"DELETE\",\n        credentials: \"include\"\n      });\n      if (!res.ok) throw new Error(\"Failed to delete banner\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/banners\"] });\n      toast({ title: \"تم حذف البانر\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"فشل حذف البانر\" });\n    }\n  });\n\n  // Category mutations\n  const createCategoryMutation = useMutation({\n    mutationFn: async (data: typeof categoryForm) => {\n      const res = await fetch(\"/api/admin/categories\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify(data)\n      });\n      if (!res.ok) throw new Error(\"Failed to create category\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/categories\"] });\n      toast({ title: \"تم إضافة القسم بنجاح\" });\n      setIsAddCategoryOpen(false);\n      resetCategoryForm();\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"فشل إضافة القسم\" });\n    }\n  });\n\n  const updateCategoryMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: Partial<typeof categoryForm> }) => {\n      const res = await fetch(`/api/admin/categories/${id}`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify(data)\n      });\n      if (!res.ok) throw new Error(\"Failed to update category\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/categories\"] });\n      toast({ title: \"تم تحديث القسم بنجاح\" });\n      setEditingCategory(null);\n      resetCategoryForm();\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"فشل تحديث القسم\" });\n    }\n  });\n\n  const deleteCategoryMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const res = await fetch(`/api/admin/categories/${id}`, {\n        method: \"DELETE\",\n        credentials: \"include\"\n      });\n      if (!res.ok) throw new Error(\"Failed to delete category\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/categories\"] });\n      toast({ title: \"تم حذف القسم\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"فشل حذف القسم\" });\n    }\n  });\n\n  const resetBannerForm = () => {\n    setBannerForm({ title: \"\", image: \"\", link: \"\", isActive: true, sortOrder: 0 });\n  };\n\n  const resetCategoryForm = () => {\n    setCategoryForm({ name: \"\", nameEn: \"\", icon: \"\", image: \"\", isActive: true, sortOrder: 0 });\n  };\n\n  const handleEditBanner = (banner: Banner) => {\n    setEditingBanner(banner);\n    setBannerForm({\n      title: banner.title,\n      image: banner.image,\n      link: banner.link || \"\",\n      isActive: banner.isActive,\n      sortOrder: banner.sortOrder\n    });\n  };\n\n  const handleEditCategory = (category: Category) => {\n    setEditingCategory(category);\n    setCategoryForm({\n      name: category.name,\n      nameEn: category.nameEn || \"\",\n      icon: category.icon || \"\",\n      image: category.image || \"\",\n      isActive: category.isActive,\n      sortOrder: category.sortOrder\n    });\n  };\n\n  const handleBannerSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!bannerForm.title || !bannerForm.image) {\n      toast({ variant: \"destructive\", title: \"العنوان والصورة مطلوبان\" });\n      return;\n    }\n    if (editingBanner) {\n      updateBannerMutation.mutate({ id: editingBanner.id, data: bannerForm });\n    } else {\n      createBannerMutation.mutate(bannerForm);\n    }\n  };\n\n  const handleCategorySubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!categoryForm.name) {\n      toast({ variant: \"destructive\", title: \"اسم القسم مطلوب\" });\n      return;\n    }\n    if (editingCategory) {\n      updateCategoryMutation.mutate({ id: editingCategory.id, data: categoryForm });\n    } else {\n      createCategoryMutation.mutate(categoryForm);\n    }\n  };\n\n  return (\n    <DashboardLayout role=\"admin\">\n      <div className=\"space-y-8\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight font-display\">إعدادات التطبيق</h2>\n          <p className=\"text-muted-foreground mt-2\">إدارة البانرات والأقسام المعروضة في التطبيق</p>\n        </div>\n\n        <Tabs defaultValue=\"banners\" className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-2 max-w-md\">\n            <TabsTrigger value=\"banners\" className=\"gap-2\">\n              <Image className=\"w-4 h-4\" />\n              البانرات\n            </TabsTrigger>\n            <TabsTrigger value=\"categories\" className=\"gap-2\">\n              <Grid3X3 className=\"w-4 h-4\" />\n              الأقسام\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"banners\">\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0\">\n                <div>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Image className=\"w-5 h-5\" />\n                    البانرات\n                  </CardTitle>\n                  <CardDescription className=\"mt-2\">\n                    إدارة صور البانر في الصفحة الرئيسية للتطبيق\n                  </CardDescription>\n                </div>\n                <Dialog open={isAddBannerOpen || !!editingBanner} onOpenChange={(open) => {\n                  if (!open) {\n                    setIsAddBannerOpen(false);\n                    setEditingBanner(null);\n                    resetBannerForm();\n                  }\n                }}>\n                  <DialogTrigger asChild>\n                    <Button className=\"gap-2\" onClick={() => setIsAddBannerOpen(true)} data-testid=\"button-add-banner\">\n                      <Plus className=\"w-4 h-4\" />\n                      إضافة بانر\n                    </Button>\n                  </DialogTrigger>\n                  <DialogContent>\n                    <DialogHeader>\n                      <DialogTitle>{editingBanner ? \"تعديل البانر\" : \"إضافة بانر جديد\"}</DialogTitle>\n                      <DialogDescription>\n                        {editingBanner ? \"قم بتعديل بيانات البانر\" : \"أضف صورة بانر جديدة للصفحة الرئيسية\"}\n                      </DialogDescription>\n                    </DialogHeader>\n                    <form onSubmit={handleBannerSubmit} className=\"space-y-4\">\n                      <div className=\"space-y-2\">\n                        <Label>العنوان</Label>\n                        <Input\n                          placeholder=\"عنوان البانر\"\n                          value={bannerForm.title}\n                          onChange={(e) => setBannerForm(prev => ({ ...prev, title: e.target.value }))}\n                          data-testid=\"input-banner-title\"\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label>الصورة</Label>\n                        <div className=\"flex gap-2\">\n                          <Input\n                            placeholder=\"رابط الصورة\"\n                            value={bannerForm.image}\n                            onChange={(e) => setBannerForm(prev => ({ ...prev, image: e.target.value }))}\n                            data-testid=\"input-banner-image\"\n                          />\n                          <Input\n                            ref={fileInputRef}\n                            type=\"file\"\n                            accept=\"image/*\"\n                            className=\"hidden\"\n                            onChange={(e) => handleImageUpload(e, 'banner')}\n                          />\n                          <Button \n                            type=\"button\" \n                            variant=\"outline\"\n                            onClick={() => fileInputRef.current?.click()}\n                            disabled={isUploading}\n                          >\n                            {isUploading ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : \"رفع\"}\n                          </Button>\n                        </div>\n                        {bannerForm.image && (\n                          <img src={bannerForm.image} alt=\"Preview\" className=\"h-24 rounded-lg object-cover\" />\n                        )}\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label>الرابط (اختياري)</Label>\n                        <Input\n                          placeholder=\"رابط عند النقر على البانر\"\n                          value={bannerForm.link}\n                          onChange={(e) => setBannerForm(prev => ({ ...prev, link: e.target.value }))}\n                          data-testid=\"input-banner-link\"\n                        />\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Switch\n                          checked={bannerForm.isActive}\n                          onCheckedChange={(checked) => setBannerForm(prev => ({ ...prev, isActive: checked }))}\n                        />\n                        <Label>نشط</Label>\n                      </div>\n                      <DialogFooter>\n                        <Button type=\"submit\" disabled={createBannerMutation.isPending || updateBannerMutation.isPending}>\n                          {(createBannerMutation.isPending || updateBannerMutation.isPending) && \n                            <Loader2 className=\"w-4 h-4 animate-spin ml-2\" />}\n                          {editingBanner ? \"حفظ التعديلات\" : \"إضافة البانر\"}\n                        </Button>\n                      </DialogFooter>\n                    </form>\n                  </DialogContent>\n                </Dialog>\n              </CardHeader>\n              <CardContent>\n                {loadingBanners ? (\n                  <div className=\"flex justify-center py-12\">\n                    <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n                  </div>\n                ) : banners.length === 0 ? (\n                  <div className=\"text-center py-12 border rounded-lg bg-muted/20\">\n                    <Image className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n                    <h3 className=\"font-semibold text-lg\">لا توجد بانرات</h3>\n                    <p className=\"text-muted-foreground\">قم بإضافة بانر جديد للصفحة الرئيسية</p>\n                  </div>\n                ) : (\n                  <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n                    {banners.map((banner) => (\n                      <div key={banner.id} className=\"border rounded-lg overflow-hidden\" data-testid={`card-banner-${banner.id}`}>\n                        <img src={banner.image} alt={banner.title} className=\"w-full h-32 object-cover\" />\n                        <div className=\"p-3 space-y-2\">\n                          <div className=\"flex items-center justify-between\">\n                            <span className=\"font-medium\">{banner.title}</span>\n                            <Badge variant={banner.isActive ? \"default\" : \"secondary\"}>\n                              {banner.isActive ? \"نشط\" : \"معطل\"}\n                            </Badge>\n                          </div>\n                          <div className=\"flex gap-2\">\n                            <Button variant=\"outline\" size=\"sm\" onClick={() => handleEditBanner(banner)}>\n                              <Edit className=\"w-4 h-4\" />\n                            </Button>\n                            <Button \n                              variant=\"outline\" \n                              size=\"sm\" \n                              className=\"text-destructive\"\n                              onClick={() => deleteBannerMutation.mutate(banner.id)}\n                            >\n                              <Trash2 className=\"w-4 h-4\" />\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"categories\">\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0\">\n                <div>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Grid3X3 className=\"w-5 h-5\" />\n                    الأقسام\n                  </CardTitle>\n                  <CardDescription className=\"mt-2\">\n                    إدارة أقسام المنتجات في التطبيق\n                  </CardDescription>\n                </div>\n                <Dialog open={isAddCategoryOpen || !!editingCategory} onOpenChange={(open) => {\n                  if (!open) {\n                    setIsAddCategoryOpen(false);\n                    setEditingCategory(null);\n                    resetCategoryForm();\n                  }\n                }}>\n                  <DialogTrigger asChild>\n                    <Button className=\"gap-2\" onClick={() => setIsAddCategoryOpen(true)} data-testid=\"button-add-category\">\n                      <Plus className=\"w-4 h-4\" />\n                      إضافة قسم\n                    </Button>\n                  </DialogTrigger>\n                  <DialogContent>\n                    <DialogHeader>\n                      <DialogTitle>{editingCategory ? \"تعديل القسم\" : \"إضافة قسم جديد\"}</DialogTitle>\n                      <DialogDescription>\n                        {editingCategory ? \"قم بتعديل بيانات القسم\" : \"أضف قسم جديد للتطبيق\"}\n                      </DialogDescription>\n                    </DialogHeader>\n                    <form onSubmit={handleCategorySubmit} className=\"space-y-4\">\n                      <div className=\"space-y-2\">\n                        <Label>اسم القسم (عربي)</Label>\n                        <Input\n                          placeholder=\"مثال: ورود وهدايا\"\n                          value={categoryForm.name}\n                          onChange={(e) => setCategoryForm(prev => ({ ...prev, name: e.target.value }))}\n                          data-testid=\"input-category-name\"\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label>اسم القسم (إنجليزي) - اختياري</Label>\n                        <Input\n                          placeholder=\"مثال: Flowers & Gifts\"\n                          value={categoryForm.nameEn}\n                          onChange={(e) => setCategoryForm(prev => ({ ...prev, nameEn: e.target.value }))}\n                          data-testid=\"input-category-name-en\"\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label>رابط الأيقونة (اختياري)</Label>\n                        <Input\n                          placeholder=\"https://example.com/icon.png\"\n                          value={categoryForm.icon}\n                          onChange={(e) => setCategoryForm(prev => ({ ...prev, icon: e.target.value }))}\n                          className=\"font-mono text-left\"\n                          dir=\"ltr\"\n                          data-testid=\"input-category-icon\"\n                        />\n                        {categoryForm.icon && (\n                          <div className=\"flex items-center gap-2 p-2 border rounded bg-muted/20\">\n                            <img src={categoryForm.icon} alt=\"أيقونة\" className=\"w-8 h-8 object-contain\" />\n                            <span className=\"text-xs text-muted-foreground\">معاينة الأيقونة</span>\n                          </div>\n                        )}\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Switch\n                          checked={categoryForm.isActive}\n                          onCheckedChange={(checked) => setCategoryForm(prev => ({ ...prev, isActive: checked }))}\n                        />\n                        <Label>نشط</Label>\n                      </div>\n                      <DialogFooter>\n                        <Button type=\"submit\" disabled={createCategoryMutation.isPending || updateCategoryMutation.isPending}>\n                          {(createCategoryMutation.isPending || updateCategoryMutation.isPending) && \n                            <Loader2 className=\"w-4 h-4 animate-spin ml-2\" />}\n                          {editingCategory ? \"حفظ التعديلات\" : \"إضافة القسم\"}\n                        </Button>\n                      </DialogFooter>\n                    </form>\n                  </DialogContent>\n                </Dialog>\n              </CardHeader>\n              <CardContent>\n                {loadingCategories ? (\n                  <div className=\"flex justify-center py-12\">\n                    <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n                  </div>\n                ) : categories.length === 0 ? (\n                  <div className=\"text-center py-12 border rounded-lg bg-muted/20\">\n                    <Grid3X3 className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n                    <h3 className=\"font-semibold text-lg\">لا توجد أقسام</h3>\n                    <p className=\"text-muted-foreground\">قم بإضافة قسم جديد</p>\n                  </div>\n                ) : (\n                  <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n                    {categories.map((category) => (\n                      <div key={category.id} className=\"border rounded-lg p-4\" data-testid={`card-category-${category.id}`}>\n                        <div className=\"flex items-center justify-between mb-3\">\n                          <div className=\"flex items-center gap-2\">\n                            {category.icon && <span className=\"text-2xl\">{category.icon}</span>}\n                            <div>\n                              <div className=\"font-medium\">{category.name}</div>\n                              {category.nameEn && <div className=\"text-sm text-muted-foreground\">{category.nameEn}</div>}\n                            </div>\n                          </div>\n                          <Badge variant={category.isActive ? \"default\" : \"secondary\"}>\n                            {category.isActive ? \"نشط\" : \"معطل\"}\n                          </Badge>\n                        </div>\n                        <div className=\"flex gap-2\">\n                          <Button variant=\"outline\" size=\"sm\" onClick={() => handleEditCategory(category)}>\n                            <Edit className=\"w-4 h-4\" />\n                          </Button>\n                          <Button \n                            variant=\"outline\" \n                            size=\"sm\" \n                            className=\"text-destructive\"\n                            onClick={() => deleteCategoryMutation.mutate(category.id)}\n                          >\n                            <Trash2 className=\"w-4 h-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":25678,"size_tokens":null},"client/src/pages/merchant/Orders.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { ShoppingBag, Search, Loader2, Eye, User, Package, MapPin, Phone, Calendar, CreditCard, MessageCircle } from \"lucide-react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport { format } from \"date-fns\";\nimport { ar } from \"date-fns/locale\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLocation } from \"wouter\";\n\ninterface OrderWithDetails {\n  id: number;\n  orderNumber: string;\n  customerId: number;\n  merchantId: number;\n  productId: number;\n  quantity: number;\n  totalAmount: number;\n  status: string;\n  customerNote: string | null;\n  deliveryAddress: string | null;\n  deliveryMethod: string;\n  isPaid: boolean;\n  createdAt: string;\n  updatedAt: string;\n  customer: {\n    id: number;\n    name: string;\n    mobile: string;\n    city: string | null;\n  } | null;\n  product: {\n    id: number;\n    name: string;\n    price: number;\n    images: string[] | null;\n  } | null;\n}\n\nconst statusMap: Record<string, { label: string; variant: \"default\" | \"secondary\" | \"destructive\" | \"outline\" }> = {\n  pending: { label: \"قيد الانتظار\", variant: \"secondary\" },\n  processing: { label: \"قيد التجهيز\", variant: \"default\" },\n  shipped: { label: \"تم الشحن\", variant: \"default\" },\n  delivered: { label: \"تم التسليم\", variant: \"default\" },\n  completed: { label: \"مكتمل\", variant: \"default\" },\n  cancelled: { label: \"ملغي\", variant: \"destructive\" },\n  rescheduled: { label: \"إعادة جدولة\", variant: \"outline\" },\n  not_received: { label: \"عدم استلام الطلب\", variant: \"destructive\" },\n};\n\nconst statusOptions = [\n  { value: \"pending\", label: \"قيد الانتظار\" },\n  { value: \"processing\", label: \"قيد التجهيز\" },\n  { value: \"shipped\", label: \"تم الشحن\" },\n  { value: \"delivered\", label: \"تم التسليم\" },\n  { value: \"completed\", label: \"مكتمل\" },\n  { value: \"cancelled\", label: \"ملغي\" },\n  { value: \"rescheduled\", label: \"إعادة جدولة\" },\n  { value: \"not_received\", label: \"عدم استلام الطلب\" },\n];\n\nexport default function MerchantOrders() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedOrder, setSelectedOrder] = useState<OrderWithDetails | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [, setLocation] = useLocation();\n\n  const handleMessageCustomer = (orderId: number, orderNumber: string) => {\n    setLocation(`/dashboard/messages?orderId=${orderId}&orderNumber=${orderNumber}`);\n  };\n\n  const { data: orders = [], isLoading } = useQuery<OrderWithDetails[]>({\n    queryKey: [\"/api/merchant/orders\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/merchant/orders\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch orders\");\n      return res.json();\n    }\n  });\n\n  const updateStatusMutation = useMutation({\n    mutationFn: async ({ orderId, status }: { orderId: number; status: string }) => {\n      const res = await fetch(`/api/merchant/orders/${orderId}/status`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ status })\n      });\n      if (!res.ok) throw new Error(\"Failed to update status\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/merchant/orders\"] });\n      toast({ title: \"تم تحديث حالة الطلب بنجاح\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"فشل تحديث حالة الطلب\" });\n    }\n  });\n\n  const filteredOrders = orders.filter(order => \n    order.orderNumber.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    (order.customer?.name && order.customer.name.toLowerCase().includes(searchQuery.toLowerCase())) ||\n    (order.product?.name && order.product.name.toLowerCase().includes(searchQuery.toLowerCase()))\n  );\n\n  return (\n    <DashboardLayout role=\"merchant\">\n      <div className=\"space-y-8\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight font-display\">الطلبات</h2>\n            <p className=\"text-muted-foreground mt-2\">إدارة طلبات متجرك</p>\n          </div>\n          <Badge variant=\"secondary\" className=\"text-lg px-4 py-2\">\n            {orders.length} طلب\n          </Badge>\n        </div>\n\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"text-2xl font-bold\">{orders.filter(o => o.status === \"pending\").length}</div>\n              <p className=\"text-xs text-muted-foreground\">قيد الانتظار</p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"text-2xl font-bold\">{orders.filter(o => o.status === \"processing\").length}</div>\n              <p className=\"text-xs text-muted-foreground\">قيد التجهيز</p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"text-2xl font-bold\">{orders.filter(o => o.status === \"completed\").length}</div>\n              <p className=\"text-xs text-muted-foreground\">مكتمل</p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardContent className=\"pt-6\">\n              <div className=\"text-2xl font-bold text-green-600\">\n                {orders.reduce((sum, o) => sum + (o.isPaid ? o.totalAmount : 0), 0)} ر.س\n              </div>\n              <p className=\"text-xs text-muted-foreground\">إجمالي المبيعات</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <ShoppingBag className=\"w-5 h-5\" />\n              قائمة الطلبات\n            </CardTitle>\n            <CardDescription>\n              الطلبات الواردة لمتجرك مع تفاصيل العميل والمنتج\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"mb-6\">\n              <div className=\"relative max-w-sm\">\n                <Search className=\"absolute right-3 top-3 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"بحث برقم الطلب، العميل أو المنتج...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"pr-9\"\n                  data-testid=\"input-search-orders\"\n                />\n              </div>\n            </div>\n\n            {isLoading ? (\n              <div className=\"flex justify-center py-12\" data-testid=\"loading-orders\">\n                <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n              </div>\n            ) : filteredOrders.length === 0 ? (\n              <div className=\"text-center py-12 border rounded-lg bg-muted/20\" data-testid=\"empty-orders\">\n                <ShoppingBag className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n                <h3 className=\"font-semibold text-lg\">لا يوجد طلبات</h3>\n                <p className=\"text-muted-foreground\">\n                  {searchQuery ? \"لا توجد نتائج للبحث\" : \"لم تستلم أي طلبات بعد\"}\n                </p>\n              </div>\n            ) : (\n              <div className=\"rounded-md border\" data-testid=\"table-orders\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead className=\"text-right\">رقم الطلب</TableHead>\n                      <TableHead className=\"text-right\">العميل</TableHead>\n                      <TableHead className=\"text-right\">المنتج</TableHead>\n                      <TableHead className=\"text-right\">الكمية</TableHead>\n                      <TableHead className=\"text-right\">المبلغ</TableHead>\n                      <TableHead className=\"text-right\">الحالة</TableHead>\n                      <TableHead className=\"text-right\">الدفع</TableHead>\n                      <TableHead className=\"text-right\">التاريخ</TableHead>\n                      <TableHead className=\"text-right\">إجراءات</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {filteredOrders.map((order) => (\n                      <TableRow key={order.id} data-testid={`row-order-${order.id}`}>\n                        <TableCell className=\"font-mono font-medium\" data-testid={`text-order-number-${order.id}`}>\n                          #{order.orderNumber}\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <User className=\"w-4 h-4 text-muted-foreground\" />\n                            <span data-testid={`text-customer-${order.id}`}>{order.customer?.name || \"-\"}</span>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <Package className=\"w-4 h-4 text-muted-foreground\" />\n                            <span className=\"max-w-[150px] truncate\" data-testid={`text-product-${order.id}`}>{order.product?.name || \"-\"}</span>\n                          </div>\n                        </TableCell>\n                        <TableCell data-testid={`text-quantity-${order.id}`}>{order.quantity}</TableCell>\n                        <TableCell className=\"font-medium\" data-testid={`text-amount-${order.id}`}>\n                          {order.totalAmount} ر.س\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={order.status}\n                            onValueChange={(value) => updateStatusMutation.mutate({ orderId: order.id, status: value })}\n                          >\n                            <SelectTrigger className=\"w-[130px]\" data-testid={`select-status-${order.id}`}>\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {statusOptions.map(option => (\n                                <SelectItem key={option.value} value={option.value} data-testid={`option-status-${option.value}`}>\n                                  {option.label}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant={order.isPaid ? \"default\" : \"outline\"} data-testid={`status-paid-${order.id}`}>\n                            {order.isPaid ? \"مدفوع\" : \"غير مدفوع\"}\n                          </Badge>\n                        </TableCell>\n                        <TableCell className=\"text-muted-foreground text-sm\" data-testid={`text-date-${order.id}`}>\n                          {format(new Date(order.createdAt), \"dd/MM/yyyy\", { locale: ar })}\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-1\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => setSelectedOrder(order)}\n                              data-testid={`button-view-order-${order.id}`}\n                              title=\"عرض التفاصيل\"\n                            >\n                              <Eye className=\"w-4 h-4\" />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => handleMessageCustomer(order.id, order.orderNumber)}\n                              data-testid={`button-message-customer-${order.id}`}\n                              title=\"رسالة للعميل\"\n                            >\n                              <MessageCircle className=\"w-4 h-4\" />\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Dialog open={!!selectedOrder} onOpenChange={() => setSelectedOrder(null)}>\n          <DialogContent className=\"max-w-2xl\" dir=\"rtl\">\n            <DialogHeader>\n              <DialogTitle>تفاصيل الطلب #{selectedOrder?.orderNumber}</DialogTitle>\n            </DialogHeader>\n            {selectedOrder && (\n              <div className=\"space-y-6\">\n                <div className=\"space-y-4\">\n                  <h4 className=\"font-semibold flex items-center gap-2\">\n                    <User className=\"w-4 h-4\" />\n                    بيانات العميل\n                  </h4>\n                  <div className=\"p-4 rounded-lg bg-muted/50 space-y-2\">\n                    <p><strong>الاسم:</strong> {selectedOrder.customer?.name || \"-\"}</p>\n                    <p className=\"flex items-center gap-2\">\n                      <Phone className=\"w-3 h-3\" />\n                      <a href={`tel:${selectedOrder.customer?.mobile}`} className=\"text-primary hover:underline\">\n                        {selectedOrder.customer?.mobile || \"-\"}\n                      </a>\n                    </p>\n                    <p className=\"flex items-center gap-2\">\n                      <MapPin className=\"w-3 h-3\" />\n                      {selectedOrder.customer?.city || \"-\"}\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"space-y-4\">\n                  <h4 className=\"font-semibold flex items-center gap-2\">\n                    <Package className=\"w-4 h-4\" />\n                    بيانات المنتج\n                  </h4>\n                  <div className=\"p-4 rounded-lg bg-muted/50 flex items-start gap-4\">\n                    {selectedOrder.product?.images && selectedOrder.product.images[0] && (\n                      <img\n                        src={selectedOrder.product.images[0]}\n                        alt={selectedOrder.product.name}\n                        className=\"w-20 h-20 object-cover rounded-lg\"\n                      />\n                    )}\n                    <div className=\"space-y-2\">\n                      <p><strong>المنتج:</strong> {selectedOrder.product?.name || \"-\"}</p>\n                      <p><strong>السعر:</strong> {selectedOrder.product?.price} ر.س</p>\n                      <p><strong>الكمية:</strong> {selectedOrder.quantity}</p>\n                      <p><strong>الإجمالي:</strong> {selectedOrder.totalAmount} ر.س</p>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"grid md:grid-cols-3 gap-4\">\n                  <div className=\"p-4 rounded-lg border space-y-2\">\n                    <h4 className=\"font-semibold text-sm\">الحالة</h4>\n                    <Badge variant={statusMap[selectedOrder.status]?.variant || \"secondary\"}>\n                      {statusMap[selectedOrder.status]?.label || selectedOrder.status}\n                    </Badge>\n                  </div>\n                  <div className=\"p-4 rounded-lg border space-y-2\">\n                    <h4 className=\"font-semibold flex items-center gap-2 text-sm\">\n                      <CreditCard className=\"w-4 h-4\" />\n                      الدفع\n                    </h4>\n                    <Badge variant={selectedOrder.isPaid ? \"default\" : \"outline\"}>\n                      {selectedOrder.isPaid ? \"مدفوع\" : \"غير مدفوع\"}\n                    </Badge>\n                  </div>\n                  <div className=\"p-4 rounded-lg border space-y-2\">\n                    <h4 className=\"font-semibold flex items-center gap-2 text-sm\">\n                      <Calendar className=\"w-4 h-4\" />\n                      التاريخ\n                    </h4>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {format(new Date(selectedOrder.createdAt), \"dd MMM yyyy\", { locale: ar })}\n                    </p>\n                  </div>\n                </div>\n\n                {selectedOrder.customerNote && (\n                  <div className=\"p-4 rounded-lg border\">\n                    <h4 className=\"font-semibold mb-2\">ملاحظات العميل</h4>\n                    <p className=\"text-muted-foreground\">{selectedOrder.customerNote}</p>\n                  </div>\n                )}\n\n                {selectedOrder.deliveryAddress && (\n                  <div className=\"p-4 rounded-lg border\">\n                    <h4 className=\"font-semibold mb-2 flex items-center gap-2\">\n                      <MapPin className=\"w-4 h-4\" />\n                      عنوان التوصيل\n                    </h4>\n                    <p className=\"text-muted-foreground\">{selectedOrder.deliveryAddress}</p>\n                  </div>\n                )}\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":18328,"size_tokens":null},"client/src/pages/admin/Settings.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport { \n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogTrigger,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Settings, Key, Users, Plus, Trash2, Loader2, Shield, UserPlus } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { useAuth } from \"@/hooks/useAuth\";\n\ninterface Admin {\n  id: number;\n  email: string;\n  name: string;\n  createdAt: string;\n}\n\nexport default function AdminSettings() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { user } = useAuth();\n  const [isAddOpen, setIsAddOpen] = useState(false);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    email: \"\",\n    password: \"\"\n  });\n  const [passwordForm, setPasswordForm] = useState({\n    currentPassword: \"\",\n    newPassword: \"\",\n    confirmPassword: \"\"\n  });\n\n  const { data: admins = [], isLoading } = useQuery<Admin[]>({\n    queryKey: [\"/api/admin/admins\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/admins\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch admins\");\n      return res.json();\n    }\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await fetch(\"/api/admin/admins\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify(data)\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to create admin\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/admins\"] });\n      toast({ title: \"تم إضافة المسؤول بنجاح\", className: \"bg-emerald-50 border-emerald-200 text-emerald-800\" });\n      setIsAddOpen(false);\n      setFormData({ name: \"\", email: \"\", password: \"\" });\n    },\n    onError: (error: Error) => {\n      toast({ variant: \"destructive\", title: error.message });\n    }\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const res = await fetch(`/api/admin/admins/${id}`, {\n        method: \"DELETE\",\n        credentials: \"include\"\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to delete admin\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/admins\"] });\n      toast({ title: \"تم حذف المسؤول\" });\n    },\n    onError: (error: Error) => {\n      toast({ variant: \"destructive\", title: error.message });\n    }\n  });\n\n  const changePasswordMutation = useMutation({\n    mutationFn: async (data: { currentPassword: string; newPassword: string }) => {\n      const res = await fetch(\"/api/admin/password\", {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify(data)\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to change password\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"تم تغيير كلمة المرور بنجاح\", className: \"bg-emerald-50 border-emerald-200 text-emerald-800\" });\n      setPasswordForm({ currentPassword: \"\", newPassword: \"\", confirmPassword: \"\" });\n    },\n    onError: (error: Error) => {\n      toast({ variant: \"destructive\", title: error.message });\n    }\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!formData.name || !formData.email || !formData.password) {\n      toast({ variant: \"destructive\", title: \"جميع الحقول مطلوبة\" });\n      return;\n    }\n    if (formData.password.length < 6) {\n      toast({ variant: \"destructive\", title: \"كلمة المرور يجب أن تكون 6 أحرف على الأقل\" });\n      return;\n    }\n    createMutation.mutate(formData);\n  };\n\n  const handlePasswordChange = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!passwordForm.currentPassword || !passwordForm.newPassword || !passwordForm.confirmPassword) {\n      toast({ variant: \"destructive\", title: \"جميع الحقول مطلوبة\" });\n      return;\n    }\n    if (passwordForm.newPassword !== passwordForm.confirmPassword) {\n      toast({ variant: \"destructive\", title: \"كلمتا المرور غير متطابقتان\" });\n      return;\n    }\n    if (passwordForm.newPassword.length < 6) {\n      toast({ variant: \"destructive\", title: \"كلمة المرور الجديدة يجب أن تكون 6 أحرف على الأقل\" });\n      return;\n    }\n    changePasswordMutation.mutate({\n      currentPassword: passwordForm.currentPassword,\n      newPassword: passwordForm.newPassword\n    });\n  };\n\n  return (\n    <DashboardLayout role=\"admin\">\n      <div className=\"space-y-8\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight font-display\">الإعدادات</h2>\n          <p className=\"text-muted-foreground mt-2\">إدارة إعدادات الحساب والمسؤولين</p>\n        </div>\n\n        <Tabs defaultValue=\"password\" className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-2 max-w-md\">\n            <TabsTrigger value=\"password\" className=\"gap-2\">\n              <Key className=\"w-4 h-4\" />\n              تغيير كلمة المرور\n            </TabsTrigger>\n            <TabsTrigger value=\"admins\" className=\"gap-2\">\n              <Users className=\"w-4 h-4\" />\n              المسؤولين\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"password\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Key className=\"w-5 h-5\" />\n                  تغيير كلمة المرور\n                </CardTitle>\n                <CardDescription>\n                  قم بتغيير كلمة المرور الخاصة بحسابك ({user?.email})\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <form onSubmit={handlePasswordChange} className=\"space-y-4 max-w-md\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"currentPassword\">كلمة المرور الحالية</Label>\n                    <Input\n                      id=\"currentPassword\"\n                      type=\"password\"\n                      placeholder=\"أدخل كلمة المرور الحالية\"\n                      value={passwordForm.currentPassword}\n                      onChange={(e) => setPasswordForm(prev => ({ ...prev, currentPassword: e.target.value }))}\n                      data-testid=\"input-current-password\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"newPassword\">كلمة المرور الجديدة</Label>\n                    <Input\n                      id=\"newPassword\"\n                      type=\"password\"\n                      placeholder=\"أدخل كلمة المرور الجديدة\"\n                      value={passwordForm.newPassword}\n                      onChange={(e) => setPasswordForm(prev => ({ ...prev, newPassword: e.target.value }))}\n                      data-testid=\"input-new-password\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"confirmPassword\">تأكيد كلمة المرور</Label>\n                    <Input\n                      id=\"confirmPassword\"\n                      type=\"password\"\n                      placeholder=\"أعد إدخال كلمة المرور الجديدة\"\n                      value={passwordForm.confirmPassword}\n                      onChange={(e) => setPasswordForm(prev => ({ ...prev, confirmPassword: e.target.value }))}\n                      data-testid=\"input-confirm-password\"\n                    />\n                  </div>\n                  <Button type=\"submit\" disabled={changePasswordMutation.isPending} data-testid=\"button-change-password\">\n                    {changePasswordMutation.isPending && <Loader2 className=\"w-4 h-4 animate-spin ml-2\" />}\n                    تغيير كلمة المرور\n                  </Button>\n                </form>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"admins\">\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between space-y-0\">\n                <div>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Users className=\"w-5 h-5\" />\n                    المسؤولين\n                  </CardTitle>\n                  <CardDescription className=\"mt-2\">\n                    إدارة حسابات مسؤولي لوحة التحكم\n                  </CardDescription>\n                </div>\n                <Dialog open={isAddOpen} onOpenChange={setIsAddOpen}>\n                  <DialogTrigger asChild>\n                    <Button className=\"gap-2\" data-testid=\"button-add-admin\">\n                      <UserPlus className=\"w-4 h-4\" />\n                      إضافة مسؤول\n                    </Button>\n                  </DialogTrigger>\n                  <DialogContent>\n                    <DialogHeader>\n                      <DialogTitle>إضافة مسؤول جديد</DialogTitle>\n                      <DialogDescription>أدخل بيانات المسؤول الجديد للوصول إلى لوحة التحكم</DialogDescription>\n                    </DialogHeader>\n                    <form onSubmit={handleSubmit} className=\"space-y-4\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"name\">الاسم</Label>\n                        <Input\n                          id=\"name\"\n                          placeholder=\"اسم المسؤول\"\n                          value={formData.name}\n                          onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}\n                          data-testid=\"input-admin-name\"\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"email\">البريد الإلكتروني</Label>\n                        <Input\n                          id=\"email\"\n                          type=\"email\"\n                          placeholder=\"admin@example.com\"\n                          value={formData.email}\n                          onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}\n                          data-testid=\"input-admin-email\"\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"password\">كلمة المرور</Label>\n                        <Input\n                          id=\"password\"\n                          type=\"password\"\n                          placeholder=\"كلمة مرور قوية\"\n                          value={formData.password}\n                          onChange={(e) => setFormData(prev => ({ ...prev, password: e.target.value }))}\n                          data-testid=\"input-admin-password\"\n                        />\n                      </div>\n                      <DialogFooter>\n                        <Button type=\"submit\" disabled={createMutation.isPending} data-testid=\"button-submit-admin\">\n                          {createMutation.isPending && <Loader2 className=\"w-4 h-4 animate-spin ml-2\" />}\n                          إضافة المسؤول\n                        </Button>\n                      </DialogFooter>\n                    </form>\n                  </DialogContent>\n                </Dialog>\n              </CardHeader>\n              <CardContent>\n                {isLoading ? (\n                  <div className=\"flex justify-center py-12\">\n                    <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n                  </div>\n                ) : admins.length === 0 ? (\n                  <div className=\"text-center py-12 border rounded-lg bg-muted/20\">\n                    <Shield className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n                    <h3 className=\"font-semibold text-lg\">لا يوجد مسؤولين</h3>\n                    <p className=\"text-muted-foreground\">قم بإضافة مسؤول جديد للبدء</p>\n                  </div>\n                ) : (\n                  <div className=\"rounded-md border\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead className=\"text-right\">المسؤول</TableHead>\n                          <TableHead className=\"text-right\">البريد الإلكتروني</TableHead>\n                          <TableHead className=\"text-right\">تاريخ الإضافة</TableHead>\n                          <TableHead className=\"text-right\">إجراءات</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {admins.map((admin) => (\n                          <TableRow key={admin.id} data-testid={`row-admin-${admin.id}`}>\n                            <TableCell>\n                              <div className=\"flex items-center gap-3\">\n                                <Avatar className=\"h-9 w-9\">\n                                  <AvatarFallback className=\"bg-primary/10 text-primary\">\n                                    {admin.name.charAt(0)}\n                                  </AvatarFallback>\n                                </Avatar>\n                                <span className=\"font-medium\">{admin.name}</span>\n                              </div>\n                            </TableCell>\n                            <TableCell className=\"font-mono text-sm\">{admin.email}</TableCell>\n                            <TableCell className=\"font-mono text-sm\">\n                              {new Date(admin.createdAt).toLocaleDateString('ar-SA')}\n                            </TableCell>\n                            <TableCell>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"icon\"\n                                className=\"text-destructive hover:text-destructive hover:bg-destructive/10\"\n                                onClick={() => deleteMutation.mutate(admin.id)}\n                                disabled={deleteMutation.isPending || admin.id === user?.id}\n                                data-testid={`button-delete-admin-${admin.id}`}\n                              >\n                                <Trash2 className=\"w-4 h-4\" />\n                              </Button>\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":16034,"size_tokens":null},"client/src/pages/admin/Customers.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport { Users, Search, Loader2, MapPin, Phone, Mail, Calendar } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport { format } from \"date-fns\";\nimport { ar } from \"date-fns/locale\";\n\ninterface Customer {\n  id: number;\n  name: string;\n  email: string | null;\n  mobile: string;\n  city: string | null;\n  createdAt: string;\n}\n\nexport default function AdminCustomers() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  const { data: customers = [], isLoading } = useQuery<Customer[]>({\n    queryKey: [\"/api/admin/customers\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/customers\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch customers\");\n      return res.json();\n    }\n  });\n\n  const filteredCustomers = customers.filter(customer => \n    customer.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    customer.mobile.includes(searchQuery) ||\n    (customer.email && customer.email.toLowerCase().includes(searchQuery.toLowerCase())) ||\n    (customer.city && customer.city.toLowerCase().includes(searchQuery.toLowerCase()))\n  );\n\n  return (\n    <DashboardLayout role=\"admin\">\n      <div className=\"space-y-8\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight font-display\">العملاء</h2>\n            <p className=\"text-muted-foreground mt-2\">جميع العملاء المسجلين في التطبيق</p>\n          </div>\n          <Badge variant=\"secondary\" className=\"text-lg px-4 py-2\">\n            {customers.length} عميل\n          </Badge>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Users className=\"w-5 h-5\" />\n              قائمة العملاء\n            </CardTitle>\n            <CardDescription>\n              العملاء الذين سجلوا في التطبيق\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"mb-6\">\n              <div className=\"relative max-w-sm\">\n                <Search className=\"absolute right-3 top-3 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"بحث بالاسم، الجوال، البريد أو المدينة...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"pr-9\"\n                  data-testid=\"input-search-customers\"\n                />\n              </div>\n            </div>\n\n            {isLoading ? (\n              <div className=\"flex justify-center py-12\" data-testid=\"loading-customers\">\n                <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n              </div>\n            ) : filteredCustomers.length === 0 ? (\n              <div className=\"text-center py-12 border rounded-lg bg-muted/20\" data-testid=\"empty-customers\">\n                <Users className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n                <h3 className=\"font-semibold text-lg\">لا يوجد عملاء</h3>\n                <p className=\"text-muted-foreground\">\n                  {searchQuery ? \"لا توجد نتائج للبحث\" : \"لم يتم تسجيل أي عملاء بعد\"}\n                </p>\n              </div>\n            ) : (\n              <div className=\"rounded-md border\" data-testid=\"table-customers\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead className=\"text-right\">#</TableHead>\n                      <TableHead className=\"text-right\">الاسم</TableHead>\n                      <TableHead className=\"text-right\">رقم الجوال</TableHead>\n                      <TableHead className=\"text-right\">البريد الإلكتروني</TableHead>\n                      <TableHead className=\"text-right\">المدينة</TableHead>\n                      <TableHead className=\"text-right\">تاريخ التسجيل</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {filteredCustomers.map((customer, index) => (\n                      <TableRow key={customer.id} data-testid={`row-customer-${customer.id}`}>\n                        <TableCell className=\"font-medium\" data-testid={`text-index-${customer.id}`}>{index + 1}</TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <div className=\"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center\">\n                              <span className=\"text-sm font-medium text-primary\">\n                                {customer.name.charAt(0)}\n                              </span>\n                            </div>\n                            <span className=\"font-medium\" data-testid={`text-name-${customer.id}`}>{customer.name}</span>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-1 text-muted-foreground\">\n                            <Phone className=\"w-3 h-3\" />\n                            <span className=\"font-mono\" data-testid={`text-mobile-${customer.id}`}>{customer.mobile}</span>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          {customer.email ? (\n                            <div className=\"flex items-center gap-1 text-muted-foreground\">\n                              <Mail className=\"w-3 h-3\" />\n                              <span className=\"font-mono text-sm\" data-testid={`text-email-${customer.id}`}>{customer.email}</span>\n                            </div>\n                          ) : (\n                            <span className=\"text-muted-foreground\" data-testid={`text-email-${customer.id}`}>-</span>\n                          )}\n                        </TableCell>\n                        <TableCell>\n                          {customer.city ? (\n                            <div className=\"flex items-center gap-1\">\n                              <MapPin className=\"w-3 h-3 text-muted-foreground\" />\n                              <span data-testid={`text-city-${customer.id}`}>{customer.city}</span>\n                            </div>\n                          ) : (\n                            <span className=\"text-muted-foreground\" data-testid={`text-city-${customer.id}`}>-</span>\n                          )}\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-1 text-muted-foreground text-sm\">\n                            <Calendar className=\"w-3 h-3\" />\n                            <span data-testid={`text-date-${customer.id}`}>{format(new Date(customer.createdAt), \"dd MMM yyyy\", { locale: ar })}</span>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":7724,"size_tokens":null},"client/src/pages/admin/Orders.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { ShoppingBag, Search, Loader2, Eye, User, Store, Package, MapPin, Phone, Calendar, CreditCard } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport { format } from \"date-fns\";\nimport { ar } from \"date-fns/locale\";\n\ninterface OrderWithDetails {\n  id: number;\n  orderNumber: string;\n  customerId: number;\n  merchantId: number;\n  productId: number;\n  quantity: number;\n  totalAmount: number;\n  status: string;\n  customerNote: string | null;\n  deliveryAddress: string | null;\n  deliveryMethod: string;\n  isPaid: boolean;\n  createdAt: string;\n  updatedAt: string;\n  customer: {\n    id: number;\n    name: string;\n    mobile: string;\n    city: string | null;\n  } | null;\n  merchant: {\n    id: number;\n    storeName: string;\n    ownerName: string;\n  } | null;\n  product: {\n    id: number;\n    name: string;\n    price: number;\n    images: string[] | null;\n  } | null;\n}\n\nconst statusMap: Record<string, { label: string; variant: \"default\" | \"secondary\" | \"destructive\" | \"outline\" }> = {\n  pending: { label: \"قيد الانتظار\", variant: \"secondary\" },\n  processing: { label: \"قيد التجهيز\", variant: \"default\" },\n  shipped: { label: \"تم الشحن\", variant: \"default\" },\n  delivered: { label: \"تم التسليم\", variant: \"default\" },\n  completed: { label: \"مكتمل\", variant: \"default\" },\n  cancelled: { label: \"ملغي\", variant: \"destructive\" },\n  rescheduled: { label: \"إعادة جدولة\", variant: \"outline\" },\n  not_received: { label: \"عدم استلام الطلب\", variant: \"destructive\" },\n};\n\nexport default function AdminOrders() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedOrder, setSelectedOrder] = useState<OrderWithDetails | null>(null);\n\n  const { data: orders = [], isLoading } = useQuery<OrderWithDetails[]>({\n    queryKey: [\"/api/admin/orders\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/orders\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch orders\");\n      return res.json();\n    }\n  });\n\n  const filteredOrders = orders.filter(order => \n    order.orderNumber.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    (order.customer?.name && order.customer.name.toLowerCase().includes(searchQuery.toLowerCase())) ||\n    (order.merchant?.storeName && order.merchant.storeName.toLowerCase().includes(searchQuery.toLowerCase())) ||\n    (order.product?.name && order.product.name.toLowerCase().includes(searchQuery.toLowerCase()))\n  );\n\n  return (\n    <DashboardLayout role=\"admin\">\n      <div className=\"space-y-8\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight font-display\">الطلبات</h2>\n            <p className=\"text-muted-foreground mt-2\">جميع الطلبات في النظام</p>\n          </div>\n          <Badge variant=\"secondary\" className=\"text-lg px-4 py-2\">\n            {orders.length} طلب\n          </Badge>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <ShoppingBag className=\"w-5 h-5\" />\n              قائمة الطلبات\n            </CardTitle>\n            <CardDescription>\n              جميع الطلبات مع تفاصيل العميل والمتجر والمنتج\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"mb-6\">\n              <div className=\"relative max-w-sm\">\n                <Search className=\"absolute right-3 top-3 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"بحث برقم الطلب، العميل، المتجر أو المنتج...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"pr-9\"\n                  data-testid=\"input-search-orders\"\n                />\n              </div>\n            </div>\n\n            {isLoading ? (\n              <div className=\"flex justify-center py-12\" data-testid=\"loading-orders\">\n                <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n              </div>\n            ) : filteredOrders.length === 0 ? (\n              <div className=\"text-center py-12 border rounded-lg bg-muted/20\" data-testid=\"empty-orders\">\n                <ShoppingBag className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n                <h3 className=\"font-semibold text-lg\">لا يوجد طلبات</h3>\n                <p className=\"text-muted-foreground\">\n                  {searchQuery ? \"لا توجد نتائج للبحث\" : \"لم يتم إنشاء أي طلبات بعد\"}\n                </p>\n              </div>\n            ) : (\n              <div className=\"rounded-md border\" data-testid=\"table-orders\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead className=\"text-right\">رقم الطلب</TableHead>\n                      <TableHead className=\"text-right\">العميل</TableHead>\n                      <TableHead className=\"text-right\">المتجر</TableHead>\n                      <TableHead className=\"text-right\">المنتج</TableHead>\n                      <TableHead className=\"text-right\">المبلغ</TableHead>\n                      <TableHead className=\"text-right\">الحالة</TableHead>\n                      <TableHead className=\"text-right\">الدفع</TableHead>\n                      <TableHead className=\"text-right\">التاريخ</TableHead>\n                      <TableHead className=\"text-right\">إجراءات</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {filteredOrders.map((order) => (\n                      <TableRow key={order.id} data-testid={`row-order-${order.id}`}>\n                        <TableCell className=\"font-mono font-medium\" data-testid={`text-order-number-${order.id}`}>\n                          #{order.orderNumber}\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <User className=\"w-4 h-4 text-muted-foreground\" />\n                            <span data-testid={`text-customer-${order.id}`}>{order.customer?.name || \"-\"}</span>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <Store className=\"w-4 h-4 text-muted-foreground\" />\n                            <span data-testid={`text-merchant-${order.id}`}>{order.merchant?.storeName || \"-\"}</span>\n                          </div>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex items-center gap-2\">\n                            <Package className=\"w-4 h-4 text-muted-foreground\" />\n                            <span className=\"max-w-[150px] truncate\" data-testid={`text-product-${order.id}`}>{order.product?.name || \"-\"}</span>\n                          </div>\n                        </TableCell>\n                        <TableCell className=\"font-medium\" data-testid={`text-amount-${order.id}`}>\n                          {order.totalAmount} ر.س\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant={statusMap[order.status]?.variant || \"secondary\"} data-testid={`status-order-${order.id}`}>\n                            {statusMap[order.status]?.label || order.status}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          <Badge variant={order.isPaid ? \"default\" : \"outline\"} data-testid={`status-paid-${order.id}`}>\n                            {order.isPaid ? \"مدفوع\" : \"غير مدفوع\"}\n                          </Badge>\n                        </TableCell>\n                        <TableCell className=\"text-muted-foreground text-sm\" data-testid={`text-date-${order.id}`}>\n                          {format(new Date(order.createdAt), \"dd/MM/yyyy\", { locale: ar })}\n                        </TableCell>\n                        <TableCell>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => setSelectedOrder(order)}\n                            data-testid={`button-view-order-${order.id}`}\n                          >\n                            <Eye className=\"w-4 h-4\" />\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        <Dialog open={!!selectedOrder} onOpenChange={() => setSelectedOrder(null)}>\n          <DialogContent className=\"max-w-2xl\" dir=\"rtl\">\n            <DialogHeader>\n              <DialogTitle>تفاصيل الطلب #{selectedOrder?.orderNumber}</DialogTitle>\n            </DialogHeader>\n            {selectedOrder && (\n              <div className=\"space-y-6\">\n                <div className=\"grid md:grid-cols-2 gap-6\">\n                  <div className=\"space-y-4\">\n                    <h4 className=\"font-semibold flex items-center gap-2\">\n                      <User className=\"w-4 h-4\" />\n                      بيانات العميل\n                    </h4>\n                    <div className=\"p-4 rounded-lg bg-muted/50 space-y-2\">\n                      <p><strong>الاسم:</strong> {selectedOrder.customer?.name || \"-\"}</p>\n                      <p className=\"flex items-center gap-2\">\n                        <Phone className=\"w-3 h-3\" />\n                        {selectedOrder.customer?.mobile || \"-\"}\n                      </p>\n                      <p className=\"flex items-center gap-2\">\n                        <MapPin className=\"w-3 h-3\" />\n                        {selectedOrder.customer?.city || \"-\"}\n                      </p>\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-4\">\n                    <h4 className=\"font-semibold flex items-center gap-2\">\n                      <Store className=\"w-4 h-4\" />\n                      بيانات المتجر\n                    </h4>\n                    <div className=\"p-4 rounded-lg bg-muted/50 space-y-2\">\n                      <p><strong>اسم المتجر:</strong> {selectedOrder.merchant?.storeName || \"-\"}</p>\n                      <p><strong>المالك:</strong> {selectedOrder.merchant?.ownerName || \"-\"}</p>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"space-y-4\">\n                  <h4 className=\"font-semibold flex items-center gap-2\">\n                    <Package className=\"w-4 h-4\" />\n                    بيانات المنتج\n                  </h4>\n                  <div className=\"p-4 rounded-lg bg-muted/50 flex items-start gap-4\">\n                    {selectedOrder.product?.images && selectedOrder.product.images[0] && (\n                      <img\n                        src={selectedOrder.product.images[0]}\n                        alt={selectedOrder.product.name}\n                        className=\"w-20 h-20 object-cover rounded-lg\"\n                      />\n                    )}\n                    <div className=\"space-y-2\">\n                      <p><strong>المنتج:</strong> {selectedOrder.product?.name || \"-\"}</p>\n                      <p><strong>السعر:</strong> {selectedOrder.product?.price} ر.س</p>\n                      <p><strong>الكمية:</strong> {selectedOrder.quantity}</p>\n                      <p><strong>الإجمالي:</strong> {selectedOrder.totalAmount} ر.س</p>\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"grid md:grid-cols-2 gap-4\">\n                  <div className=\"p-4 rounded-lg border space-y-2\">\n                    <h4 className=\"font-semibold flex items-center gap-2\">\n                      <CreditCard className=\"w-4 h-4\" />\n                      حالة الدفع\n                    </h4>\n                    <Badge variant={selectedOrder.isPaid ? \"default\" : \"outline\"} className=\"text-sm\">\n                      {selectedOrder.isPaid ? \"مدفوع\" : \"غير مدفوع\"}\n                    </Badge>\n                  </div>\n                  <div className=\"p-4 rounded-lg border space-y-2\">\n                    <h4 className=\"font-semibold flex items-center gap-2\">\n                      <Calendar className=\"w-4 h-4\" />\n                      تاريخ الطلب\n                    </h4>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {format(new Date(selectedOrder.createdAt), \"dd MMMM yyyy - HH:mm\", { locale: ar })}\n                    </p>\n                  </div>\n                </div>\n\n                {selectedOrder.customerNote && (\n                  <div className=\"p-4 rounded-lg border\">\n                    <h4 className=\"font-semibold mb-2\">ملاحظات العميل</h4>\n                    <p className=\"text-muted-foreground\">{selectedOrder.customerNote}</p>\n                  </div>\n                )}\n\n                {selectedOrder.deliveryAddress && (\n                  <div className=\"p-4 rounded-lg border\">\n                    <h4 className=\"font-semibold mb-2 flex items-center gap-2\">\n                      <MapPin className=\"w-4 h-4\" />\n                      عنوان التوصيل\n                    </h4>\n                    <p className=\"text-muted-foreground\">{selectedOrder.deliveryAddress}</p>\n                  </div>\n                )}\n              </div>\n            )}\n          </DialogContent>\n        </Dialog>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":14605,"size_tokens":null},"client/src/constants/saudiCities.ts":{"content":"export interface SaudiCity {\n  nameAr: string;\n  nameEn: string;\n}\n\nconst unsortedCities: SaudiCity[] = [\n  { nameAr: \"الرياض\", nameEn: \"Riyadh\" },\n  { nameAr: \"جدة\", nameEn: \"Jeddah\" },\n  { nameAr: \"مكة المكرمة\", nameEn: \"Makkah\" },\n  { nameAr: \"المدينة المنورة\", nameEn: \"Madinah\" },\n  { nameAr: \"الدمام\", nameEn: \"Dammam\" },\n  { nameAr: \"الخبر\", nameEn: \"Khobar\" },\n  { nameAr: \"الظهران\", nameEn: \"Dhahran\" },\n  { nameAr: \"الطائف\", nameEn: \"Taif\" },\n  { nameAr: \"تبوك\", nameEn: \"Tabuk\" },\n  { nameAr: \"بريدة\", nameEn: \"Buraidah\" },\n  { nameAr: \"خميس مشيط\", nameEn: \"Khamis Mushait\" },\n  { nameAr: \"أبها\", nameEn: \"Abha\" },\n  { nameAr: \"القطيف\", nameEn: \"Qatif\" },\n  { nameAr: \"الجبيل\", nameEn: \"Jubail\" },\n  { nameAr: \"حائل\", nameEn: \"Hail\" },\n  { nameAr: \"نجران\", nameEn: \"Najran\" },\n  { nameAr: \"جازان\", nameEn: \"Jazan\" },\n  { nameAr: \"ينبع\", nameEn: \"Yanbu\" },\n  { nameAr: \"الأحساء\", nameEn: \"Al-Ahsa\" },\n  { nameAr: \"القصيم\", nameEn: \"Qassim\" },\n  { nameAr: \"الخرج\", nameEn: \"Al-Kharj\" },\n  { nameAr: \"عرعر\", nameEn: \"Arar\" },\n  { nameAr: \"سكاكا\", nameEn: \"Sakaka\" },\n  { nameAr: \"الباحة\", nameEn: \"Al-Baha\" },\n  { nameAr: \"بيشة\", nameEn: \"Bisha\" },\n  { nameAr: \"الدوادمي\", nameEn: \"Dawadmi\" },\n  { nameAr: \"المجمعة\", nameEn: \"Al-Majma'ah\" },\n  { nameAr: \"الزلفي\", nameEn: \"Zulfi\" },\n  { nameAr: \"شقراء\", nameEn: \"Shaqra\" },\n  { nameAr: \"عنيزة\", nameEn: \"Unaizah\" },\n  { nameAr: \"الرس\", nameEn: \"Ar-Rass\" },\n  { nameAr: \"المذنب\", nameEn: \"Al-Mithnab\" },\n  { nameAr: \"البكيرية\", nameEn: \"Al-Bukayriyah\" },\n  { nameAr: \"رفحاء\", nameEn: \"Rafha\" },\n  { nameAr: \"طريف\", nameEn: \"Turaif\" },\n  { nameAr: \"القريات\", nameEn: \"Qurayyat\" },\n  { nameAr: \"دومة الجندل\", nameEn: \"Dumat Al-Jandal\" },\n  { nameAr: \"وادي الدواسر\", nameEn: \"Wadi ad-Dawasir\" },\n  { nameAr: \"السليل\", nameEn: \"As-Sulayyil\" },\n  { nameAr: \"الأفلاج\", nameEn: \"Al-Aflaj\" },\n  { nameAr: \"حوطة بني تميم\", nameEn: \"Howtat Bani Tamim\" },\n  { nameAr: \"المزاحمية\", nameEn: \"Al-Muzahmiyya\" },\n  { nameAr: \"ضرما\", nameEn: \"Dirma\" },\n  { nameAr: \"رماح\", nameEn: \"Rumah\" },\n  { nameAr: \"ثادق\", nameEn: \"Thadiq\" },\n  { nameAr: \"حريملاء\", nameEn: \"Huraymila\" },\n  { nameAr: \"عفيف\", nameEn: \"Afif\" },\n  { nameAr: \"ساجر\", nameEn: \"Sajir\" },\n  { nameAr: \"القويعية\", nameEn: \"Al-Quwai'iyah\" },\n  { nameAr: \"رابغ\", nameEn: \"Rabigh\" },\n  { nameAr: \"الليث\", nameEn: \"Al-Lith\" },\n  { nameAr: \"القنفذة\", nameEn: \"Al-Qunfudhah\" },\n  { nameAr: \"الكامل\", nameEn: \"Al-Kamil\" },\n  { nameAr: \"خليص\", nameEn: \"Khulais\" },\n  { nameAr: \"المويه\", nameEn: \"Al-Muwayh\" },\n  { nameAr: \"تربة\", nameEn: \"Turbah\" },\n  { nameAr: \"الخرمة\", nameEn: \"Al-Khurma\" },\n  { nameAr: \"رنية\", nameEn: \"Ranyah\" },\n  { nameAr: \"محايل عسير\", nameEn: \"Muhayil Asir\" },\n  { nameAr: \"النماص\", nameEn: \"An-Namas\" },\n  { nameAr: \"تنومة\", nameEn: \"Tanumah\" },\n  { nameAr: \"سراة عبيدة\", nameEn: \"Sarat Abidah\" },\n  { nameAr: \"رجال ألمع\", nameEn: \"Rijal Alma\" },\n  { nameAr: \"ظهران الجنوب\", nameEn: \"Dhahran Al-Janub\" },\n  { nameAr: \"بلقرن\", nameEn: \"Balqarn\" },\n  { nameAr: \"المجاردة\", nameEn: \"Al-Majardah\" },\n  { nameAr: \"البرك\", nameEn: \"Al-Birk\" },\n  { nameAr: \"أحد المسارحة\", nameEn: \"Ahad Al-Masarihah\" },\n  { nameAr: \"صبيا\", nameEn: \"Sabya\" },\n  { nameAr: \"أبو عريش\", nameEn: \"Abu Arish\" },\n  { nameAr: \"صامطة\", nameEn: \"Samtah\" },\n  { nameAr: \"فيفا\", nameEn: \"Fayfa\" },\n  { nameAr: \"الدرب\", nameEn: \"Ad-Darb\" },\n  { nameAr: \"العارضة\", nameEn: \"Al-Aridah\" },\n  { nameAr: \"الحرث\", nameEn: \"Al-Harith\" },\n  { nameAr: \"شرورة\", nameEn: \"Sharurah\" },\n  { nameAr: \"حبونا\", nameEn: \"Hubuna\" },\n  { nameAr: \"بدر الجنوب\", nameEn: \"Badr Al-Janub\" },\n  { nameAr: \"يدمة\", nameEn: \"Yadamah\" },\n  { nameAr: \"ثار\", nameEn: \"Thar\" },\n  { nameAr: \"الحناكية\", nameEn: \"Al-Hanakiyah\" },\n  { nameAr: \"العلا\", nameEn: \"Al-Ula\" },\n  { nameAr: \"مهد الذهب\", nameEn: \"Mahd adh-Dhahab\" },\n  { nameAr: \"بدر\", nameEn: \"Badr\" },\n  { nameAr: \"خيبر\", nameEn: \"Khaybar\" },\n  { nameAr: \"وادي الفرع\", nameEn: \"Wadi Al-Far'\" },\n  { nameAr: \"ضباء\", nameEn: \"Duba\" },\n  { nameAr: \"تيماء\", nameEn: \"Tayma\" },\n  { nameAr: \"أملج\", nameEn: \"Umluj\" },\n  { nameAr: \"الوجه\", nameEn: \"Al-Wajh\" },\n  { nameAr: \"حقل\", nameEn: \"Haql\" },\n  { nameAr: \"البدع\", nameEn: \"Al-Bada'\" },\n  { nameAr: \"رأس تنورة\", nameEn: \"Ras Tanura\" },\n  { nameAr: \"بقيق\", nameEn: \"Buqayq\" },\n  { nameAr: \"العيون\", nameEn: \"Al-Oyun\" },\n  { nameAr: \"النعيرية\", nameEn: \"An-Nu'ayriyah\" },\n  { nameAr: \"قرية العليا\", nameEn: \"Qaryat Al-Ulya\" },\n  { nameAr: \"حفر الباطن\", nameEn: \"Hafar Al-Batin\" },\n  { nameAr: \"الخفجي\", nameEn: \"Khafji\" },\n  { nameAr: \"المندق\", nameEn: \"Al-Mandaq\" },\n  { nameAr: \"قلوة\", nameEn: \"Qilwah\" },\n  { nameAr: \"العقيق\", nameEn: \"Al-Aqiq\" },\n  { nameAr: \"بلجرشي\", nameEn: \"Baljurashi\" },\n  { nameAr: \"غامد الزناد\", nameEn: \"Ghamid Az-Zinad\" },\n  { nameAr: \"الجموم\", nameEn: \"Al-Jumum\" },\n  { nameAr: \"الشرائع\", nameEn: \"Ash-Sharai\" },\n  { nameAr: \"العزيزية\", nameEn: \"Al-Aziziyah\" },\n  { nameAr: \"الجعرانة\", nameEn: \"Al-Ji'ranah\" },\n  { nameAr: \"الكر\", nameEn: \"Al-Kar\" },\n  { nameAr: \"ميسان\", nameEn: \"Maysan\" },\n  { nameAr: \"بحرة\", nameEn: \"Bahrah\" },\n  { nameAr: \"الحرة\", nameEn: \"Al-Harrah\" },\n  { nameAr: \"أضم\", nameEn: \"Adham\" },\n  { nameAr: \"العرضيات\", nameEn: \"Al-Ardiyat\" },\n  { nameAr: \"القرى\", nameEn: \"Al-Qura\" },\n  { nameAr: \"الموية\", nameEn: \"Al-Muwayah\" },\n  { nameAr: \"الحائط\", nameEn: \"Al-Ha'it\" },\n  { nameAr: \"الغزالة\", nameEn: \"Al-Ghazalah\" },\n  { nameAr: \"الشنان\", nameEn: \"Ash-Shinan\" },\n  { nameAr: \"موقق\", nameEn: \"Mawqaq\" },\n  { nameAr: \"بقعاء\", nameEn: \"Buqa'a\" },\n  { nameAr: \"الشملي\", nameEn: \"Ash-Shamli\" },\n  { nameAr: \"السليمي\", nameEn: \"As-Sulaymi\" },\n  { nameAr: \"تربة حائل\", nameEn: \"Turbat Hail\" },\n  { nameAr: \"سميراء\", nameEn: \"Sumayra\" },\n  { nameAr: \"الحليفة\", nameEn: \"Al-Hulayfah\" },\n  { nameAr: \"جبة\", nameEn: \"Jubbah\" },\n  { nameAr: \"الروضة\", nameEn: \"Ar-Rawdah\" },\n  { nameAr: \"الشيحية\", nameEn: \"Ash-Shiyhiyah\" },\n  { nameAr: \"الخطة\", nameEn: \"Al-Khuttah\" },\n  { nameAr: \"قفار\", nameEn: \"Qifar\" },\n  { nameAr: \"النبهانية\", nameEn: \"An-Nabhaniyah\" },\n  { nameAr: \"عيون الجواء\", nameEn: \"Uyun Al-Jiwa\" },\n  { nameAr: \"الأسياح\", nameEn: \"Al-Asyah\" },\n  { nameAr: \"البدائع\", nameEn: \"Al-Badai\" },\n  { nameAr: \"رياض الخبراء\", nameEn: \"Riyad Al-Khabra\" },\n  { nameAr: \"الشماسية\", nameEn: \"Ash-Shamasiyah\" },\n  { nameAr: \"عقلة الصقور\", nameEn: \"Uqlat As-Suqur\" },\n  { nameAr: \"ضرية\", nameEn: \"Dariyah\" },\n  { nameAr: \"دخنة\", nameEn: \"Dukhnah\" },\n  { nameAr: \"الخبراء\", nameEn: \"Al-Khabra\" },\n  { nameAr: \"الفوارة\", nameEn: \"Al-Fawwarah\" },\n  { nameAr: \"البطين\", nameEn: \"Al-Butayn\" },\n  { nameAr: \"المطيوي\", nameEn: \"Al-Mutaywi\" },\n  { nameAr: \"الهلالية\", nameEn: \"Al-Hilaliyah\" },\n  { nameAr: \"صفينة\", nameEn: \"Sufaynah\" },\n  { nameAr: \"صلبوخ\", nameEn: \"Salbukh\" },\n  { nameAr: \"العيينة\", nameEn: \"Al-Uyaynah\" },\n  { nameAr: \"الجبيلة\", nameEn: \"Al-Jubaylah\" },\n  { nameAr: \"العمارية\", nameEn: \"Al-Ammariyah\" },\n  { nameAr: \"الحائر\", nameEn: \"Al-Ha'ir\" },\n  { nameAr: \"بنبان\", nameEn: \"Banban\" },\n  { nameAr: \"الغاط\", nameEn: \"Al-Ghat\" },\n  { nameAr: \"مرات\", nameEn: \"Marat\" },\n  { nameAr: \"حرمة\", nameEn: \"Harmah\" },\n  { nameAr: \"تمير\", nameEn: \"Tumair\" },\n  { nameAr: \"جلاجل\", nameEn: \"Jalajil\" },\n  { nameAr: \"ملهم\", nameEn: \"Malham\" },\n  { nameAr: \"الحريق\", nameEn: \"Al-Hariq\" },\n  { nameAr: \"نعجان\", nameEn: \"Na'jan\" },\n  { nameAr: \"الدلم\", nameEn: \"Ad-Dilam\" },\n  { nameAr: \"السيح\", nameEn: \"As-Sayh\" },\n  { nameAr: \"الهياثم\", nameEn: \"Al-Hayathem\" },\n  { nameAr: \"اليمامة\", nameEn: \"Al-Yamamah\" },\n  { nameAr: \"ليلى\", nameEn: \"Layla\" },\n  { nameAr: \"البديع\", nameEn: \"Al-Badi\" },\n  { nameAr: \"نفي\", nameEn: \"Nafi\" },\n  { nameAr: \"هجرة تمرة\", nameEn: \"Hijrat Tamra\" },\n  { nameAr: \"الرين\", nameEn: \"Ar-Rayn\" },\n  { nameAr: \"البجادية\", nameEn: \"Al-Bijadiyah\" },\n  { nameAr: \"الشعراء\", nameEn: \"Ash-Sha'ra\" },\n  { nameAr: \"مشرفة\", nameEn: \"Mushrifah\" },\n  { nameAr: \"نفى\", nameEn: \"Nafa\" },\n  { nameAr: \"السر\", nameEn: \"As-Sirr\" },\n  { nameAr: \"الجفر\", nameEn: \"Al-Jafr\" },\n  { nameAr: \"الحوطة\", nameEn: \"Al-Hawtah\" },\n  { nameAr: \"الطرف\", nameEn: \"At-Taraf\" },\n  { nameAr: \"العقير\", nameEn: \"Al-Uqayr\" },\n  { nameAr: \"العمران\", nameEn: \"Al-Omran\" },\n  { nameAr: \"الجشة\", nameEn: \"Al-Jishah\" },\n  { nameAr: \"المبرز\", nameEn: \"Al-Mubarraz\" },\n  { nameAr: \"الهفوف\", nameEn: \"Al-Hofuf\" },\n  { nameAr: \"العيون\", nameEn: \"Al-Uyun\" },\n  { nameAr: \"الشهارين\", nameEn: \"Ash-Shaharin\" },\n  { nameAr: \"جوادا\", nameEn: \"Jawatha\" },\n  { nameAr: \"سيهات\", nameEn: \"Sayhat\" },\n  { nameAr: \"عوامية\", nameEn: \"Awamiyah\" },\n  { nameAr: \"صفوى\", nameEn: \"Safwa\" },\n  { nameAr: \"تاروت\", nameEn: \"Tarut\" },\n  { nameAr: \"الدغيمية\", nameEn: \"Ad-Dughaimiyyah\" },\n  { nameAr: \"العديد\", nameEn: \"Al-Adid\" },\n  { nameAr: \"الملاحة\", nameEn: \"Al-Malahah\" },\n  { nameAr: \"أم الساهك\", nameEn: \"Umm As-Sahik\" },\n  { nameAr: \"الدريدي\", nameEn: \"Ad-Duraidi\" },\n  { nameAr: \"الحنابجة\", nameEn: \"Al-Hanabjah\" },\n  { nameAr: \"الجرذاوية\", nameEn: \"Al-Jardhawiyyah\" },\n  { nameAr: \"الوسيطاء\", nameEn: \"Al-Wusayta\" },\n  { nameAr: \"المرقاب\", nameEn: \"Al-Murqab\" },\n  { nameAr: \"الناصرية\", nameEn: \"An-Nasiriyah\" },\n  { nameAr: \"السكاك\", nameEn: \"As-Sikkak\" },\n  { nameAr: \"القارة\", nameEn: \"Al-Qara\" },\n  { nameAr: \"طبرجل\", nameEn: \"Tabarjal\" },\n  { nameAr: \"صوير\", nameEn: \"Suwayr\" },\n  { nameAr: \"العويقيلة\", nameEn: \"Al-Uwayqilah\" },\n  { nameAr: \"عين دار\", nameEn: \"Ain Dar\" },\n  { nameAr: \"العضيلية\", nameEn: \"Al-Udayliyyah\" },\n  { nameAr: \"عين الدار\", nameEn: \"Ayn ad-Dar\" },\n  { nameAr: \"أحد رفيدة\", nameEn: \"Ahad Rufaydah\" },\n  { nameAr: \"الحرجة\", nameEn: \"Al-Harjah\" },\n  { nameAr: \"المضة\", nameEn: \"Al-Madd'ah\" },\n  { nameAr: \"قنا\", nameEn: \"Qana\" },\n  { nameAr: \"طريب\", nameEn: \"Turayb\" },\n  { nameAr: \"البشائر\", nameEn: \"Al-Basha'ir\" },\n  { nameAr: \"تثليث\", nameEn: \"Tathlith\" },\n  { nameAr: \"الواديين\", nameEn: \"Al-Wadiyayn\" },\n  { nameAr: \"مربة\", nameEn: \"Marbah\" },\n  { nameAr: \"الفرشة\", nameEn: \"Al-Farshah\" },\n  { nameAr: \"عبس\", nameEn: \"Abs\" },\n  { nameAr: \"الحقو\", nameEn: \"Al-Haqw\" },\n  { nameAr: \"بيش\", nameEn: \"Baysh\" },\n  { nameAr: \"الطوال\", nameEn: \"At-Tuwal\" },\n  { nameAr: \"هروب\", nameEn: \"Harub\" },\n  { nameAr: \"الريث\", nameEn: \"Ar-Rayth\" },\n  { nameAr: \"فرسان\", nameEn: \"Farasan\" },\n  { nameAr: \"القحمة\", nameEn: \"Al-Qahmah\" },\n  { nameAr: \"الموسم\", nameEn: \"Al-Mawsim\" },\n  { nameAr: \"خباش\", nameEn: \"Khubash\" },\n  { nameAr: \"الشقيق\", nameEn: \"Ash-Shiqiq\" },\n  { nameAr: \"ضمد\", nameEn: \"Damad\" },\n  { nameAr: \"الخوبة\", nameEn: \"Al-Khawbah\" },\n  { nameAr: \"الدائر\", nameEn: \"Ad-Da'ir\" },\n  { nameAr: \"العيدابي\", nameEn: \"Al-Aydabi\" },\n  { nameAr: \"المسارحة\", nameEn: \"Al-Masarihah\" },\n  { nameAr: \"أحد بني زيد\", nameEn: \"Ahad Bani Zayd\" },\n  { nameAr: \"غزالة\", nameEn: \"Ghazalah\" },\n  { nameAr: \"الحجرة\", nameEn: \"Al-Hajrah\" },\n  { nameAr: \"القرن\", nameEn: \"Al-Qarn\" },\n  { nameAr: \"الساحل\", nameEn: \"As-Sahil\" },\n  { nameAr: \"غميقة\", nameEn: \"Ghumaiqah\" },\n  { nameAr: \"الحازمي\", nameEn: \"Al-Hazmi\" },\n  { nameAr: \"المظيلف\", nameEn: \"Al-Muzaylif\" },\n  { nameAr: \"الحوية\", nameEn: \"Al-Hawiyah\" },\n  { nameAr: \"السيل الكبير\", nameEn: \"As-Sayl Al-Kabir\" },\n  { nameAr: \"بني سعد\", nameEn: \"Bani Sa'd\" },\n  { nameAr: \"ثقيف\", nameEn: \"Thaqif\" },\n  { nameAr: \"العرفاء\", nameEn: \"Al-Arfa\" },\n  { nameAr: \"الشفا\", nameEn: \"Ash-Shafa\" },\n  { nameAr: \"الهدا\", nameEn: \"Al-Hada\" },\n  { nameAr: \"البهيتة\", nameEn: \"Al-Buhaytah\" },\n  { nameAr: \"نخال\", nameEn: \"Nakhal\" },\n  { nameAr: \"عشيرة\", nameEn: \"Ushayrah\" },\n  { nameAr: \"الصالحية\", nameEn: \"As-Salihiyyah\" },\n  { nameAr: \"الفويلق\", nameEn: \"Al-Fuwayliq\" },\n  { nameAr: \"البرابر\", nameEn: \"Al-Barabir\" },\n  { nameAr: \"دارين\", nameEn: \"Darin\" },\n  { nameAr: \"الجش\", nameEn: \"Al-Jish\" },\n  { nameAr: \"حزم الجلاميد\", nameEn: \"Hazm Al-Jalamid\" },\n  { nameAr: \"لينة\", nameEn: \"Linah\" },\n  { nameAr: \"الشحمة\", nameEn: \"Ash-Shahmah\" },\n  { nameAr: \"الكهفة\", nameEn: \"Al-Kahfah\" },\n  { nameAr: \"نجود\", nameEn: \"Nujud\" },\n  { nameAr: \"الرقعي\", nameEn: \"Ar-Ruq'i\" },\n  { nameAr: \"الصرار\", nameEn: \"As-Sarrar\" },\n  { nameAr: \"أم رضمة\", nameEn: \"Umm Radmah\" },\n  { nameAr: \"عين بن فهيد\", nameEn: \"Ayn Bin Fuhayd\" },\n  { nameAr: \"الثنية\", nameEn: \"Ath-Thuniyah\" },\n  { nameAr: \"القيصومة\", nameEn: \"Al-Qaysumah\" },\n  { nameAr: \"الحماد\", nameEn: \"Al-Hammad\" },\n  { nameAr: \"الزهراء\", nameEn: \"Az-Zahra\" },\n  { nameAr: \"سدير\", nameEn: \"Sudayr\" },\n  { nameAr: \"روضة سدير\", nameEn: \"Rawdat Sudayr\" },\n  { nameAr: \"حوطة سدير\", nameEn: \"Hawtat Sudayr\" },\n  { nameAr: \"عودة سدير\", nameEn: \"Awdat Sudayr\" },\n  { nameAr: \"الدرعية\", nameEn: \"Diriyah\" },\n  { nameAr: \"الملز\", nameEn: \"Al-Malaz\" },\n  { nameAr: \"الشميسي\", nameEn: \"Ash-Shimaysi\" },\n  { nameAr: \"النسيم\", nameEn: \"An-Nasim\" },\n  { nameAr: \"الورود\", nameEn: \"Al-Wurud\" },\n  { nameAr: \"السويدي\", nameEn: \"As-Suwaydi\" },\n  { nameAr: \"العليا\", nameEn: \"Al-Olaya\" },\n  { nameAr: \"النخيل\", nameEn: \"An-Nakhil\" },\n  { nameAr: \"الربوة\", nameEn: \"Ar-Rabwah\" },\n  { nameAr: \"السلام\", nameEn: \"As-Salam\" },\n  { nameAr: \"الروابي\", nameEn: \"Ar-Rawabi\" },\n  { nameAr: \"الفلاح\", nameEn: \"Al-Falah\" },\n  { nameAr: \"العزيزية\", nameEn: \"Al-Aziziyah\" },\n  { nameAr: \"الحمراء\", nameEn: \"Al-Hamra\" },\n  { nameAr: \"الصحافة\", nameEn: \"As-Sahafah\" },\n  { nameAr: \"الملقا\", nameEn: \"Al-Malqa\" },\n  { nameAr: \"الياسمين\", nameEn: \"Al-Yasmin\" },\n  { nameAr: \"النرجس\", nameEn: \"An-Narjis\" },\n  { nameAr: \"العارض\", nameEn: \"Al-Arid\" },\n  { nameAr: \"خشم العان\", nameEn: \"Khashm Al-An\" },\n  { nameAr: \"البطحاء\", nameEn: \"Al-Batha\" },\n  { nameAr: \"الفاخرية\", nameEn: \"Al-Fakhriyah\" },\n  { nameAr: \"السلي\", nameEn: \"As-Sulay\" },\n  { nameAr: \"الشفاء\", nameEn: \"Ash-Shifa\" },\n  { nameAr: \"المرسلات\", nameEn: \"Al-Mursalat\" },\n  { nameAr: \"الإسكان\", nameEn: \"Al-Iskan\" },\n  { nameAr: \"نمار\", nameEn: \"Namar\" },\n  { nameAr: \"الصفراء\", nameEn: \"As-Safra\" },\n  { nameAr: \"بني مالك\", nameEn: \"Bani Malik\" },\n  { nameAr: \"الداير\", nameEn: \"Ad-Dayir\" },\n];\n\nexport const saudiCities: SaudiCity[] = unsortedCities.sort((a, b) => \n  a.nameAr.localeCompare(b.nameAr, 'ar')\n);\n\nexport const cityNamesAr = saudiCities.map(city => city.nameAr);\n","path":null,"size_bytes":15724,"size_tokens":null},"client/src/pages/admin/Cities.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport { \n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogTrigger,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from \"@/components/ui/command\";\nimport { MapPin, Plus, Trash2, Loader2, Edit, ChevronsUpDown, Check } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport { saudiCities } from \"@/constants/saudiCities\";\nimport { cn } from \"@/lib/utils\";\n\ninterface City {\n  id: number;\n  name: string;\n  nameEn: string | null;\n  isActive: boolean;\n  sortOrder: number;\n  createdAt: string;\n}\n\nexport default function AdminCities() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [isAddOpen, setIsAddOpen] = useState(false);\n  const [editingCity, setEditingCity] = useState<City | null>(null);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    nameEn: \"\",\n    isActive: true,\n    sortOrder: 0\n  });\n\n  const { data: cities = [], isLoading } = useQuery<City[]>({\n    queryKey: [\"/api/admin/cities\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/cities\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch cities\");\n      return res.json();\n    }\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const res = await fetch(\"/api/admin/cities\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify(data)\n      });\n      if (!res.ok) throw new Error(\"Failed to create city\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/cities\"] });\n      toast({ title: \"تم إضافة المدينة بنجاح\", className: \"bg-emerald-50 border-emerald-200 text-emerald-800\" });\n      setIsAddOpen(false);\n      resetForm();\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"فشل إضافة المدينة\" });\n    }\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: number; data: Partial<typeof formData> }) => {\n      const res = await fetch(`/api/admin/cities/${id}`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify(data)\n      });\n      if (!res.ok) throw new Error(\"Failed to update city\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/cities\"] });\n      toast({ title: \"تم تحديث المدينة بنجاح\" });\n      setEditingCity(null);\n      resetForm();\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"فشل تحديث المدينة\" });\n    }\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const res = await fetch(`/api/admin/cities/${id}`, {\n        method: \"DELETE\",\n        credentials: \"include\"\n      });\n      if (!res.ok) throw new Error(\"Failed to delete city\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/cities\"] });\n      toast({ title: \"تم حذف المدينة\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"فشل حذف المدينة\" });\n    }\n  });\n\n  const resetForm = () => {\n    setFormData({ name: \"\", nameEn: \"\", isActive: true, sortOrder: 0 });\n  };\n\n  const handleEdit = (city: City) => {\n    setEditingCity(city);\n    setFormData({\n      name: city.name,\n      nameEn: city.nameEn || \"\",\n      isActive: city.isActive,\n      sortOrder: city.sortOrder\n    });\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!formData.name) {\n      toast({ variant: \"destructive\", title: \"اسم المدينة مطلوب\" });\n      return;\n    }\n    if (editingCity) {\n      updateMutation.mutate({ id: editingCity.id, data: formData });\n    } else {\n      createMutation.mutate(formData);\n    }\n  };\n\n  return (\n    <DashboardLayout role=\"admin\">\n      <div className=\"space-y-8\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold tracking-tight font-display\">المدن</h2>\n            <p className=\"text-muted-foreground mt-2\">إدارة المدن المتاحة في التطبيق</p>\n          </div>\n          \n          <Dialog open={isAddOpen || !!editingCity} onOpenChange={(open) => {\n            if (!open) {\n              setIsAddOpen(false);\n              setEditingCity(null);\n              resetForm();\n            }\n          }}>\n            <DialogTrigger asChild>\n              <Button className=\"gap-2\" onClick={() => setIsAddOpen(true)} data-testid=\"button-add-city\">\n                <Plus className=\"w-4 h-4\" />\n                إضافة مدينة\n              </Button>\n            </DialogTrigger>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>{editingCity ? \"تعديل المدينة\" : \"إضافة مدينة جديدة\"}</DialogTitle>\n                <DialogDescription>\n                  {editingCity ? \"قم بتعديل بيانات المدينة\" : \"أضف مدينة جديدة للتطبيق\"}\n                </DialogDescription>\n              </DialogHeader>\n              <form onSubmit={handleSubmit} className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label>اختر المدينة</Label>\n                  <Popover>\n                    <PopoverTrigger asChild>\n                      <Button\n                        variant=\"outline\"\n                        role=\"combobox\"\n                        className={cn(\n                          \"w-full justify-between\",\n                          !formData.name && \"text-muted-foreground\"\n                        )}\n                        data-testid=\"select-city\"\n                      >\n                        {formData.name\n                          ? formData.name + \" - \" + formData.nameEn\n                          : \"اختر مدينة من القائمة\"}\n                        <ChevronsUpDown className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n                      </Button>\n                    </PopoverTrigger>\n                    <PopoverContent className=\"w-full p-0\" align=\"start\" dir=\"rtl\">\n                      <Command dir=\"rtl\">\n                        <CommandInput placeholder=\"ابحث عن مدينة...\" className=\"text-right\" />\n                        <CommandList>\n                          <CommandEmpty>لم يتم العثور على مدينة</CommandEmpty>\n                          <CommandGroup className=\"max-h-[300px] overflow-y-auto\">\n                            {saudiCities.map((city) => (\n                              <CommandItem\n                                value={city.nameAr + \" \" + city.nameEn}\n                                key={city.nameAr}\n                                onSelect={() => {\n                                  setFormData(prev => ({\n                                    ...prev,\n                                    name: city.nameAr,\n                                    nameEn: city.nameEn\n                                  }));\n                                }}\n                              >\n                                <Check\n                                  className={cn(\n                                    \"ml-2 h-4 w-4\",\n                                    city.nameAr === formData.name ? \"opacity-100\" : \"opacity-0\"\n                                  )}\n                                />\n                                {city.nameAr} - {city.nameEn}\n                              </CommandItem>\n                            ))}\n                          </CommandGroup>\n                        </CommandList>\n                      </Command>\n                    </PopoverContent>\n                  </Popover>\n                </div>\n                {formData.name && (\n                  <div className=\"p-3 rounded-lg bg-muted/50 border space-y-1\">\n                    <p className=\"text-sm\"><span className=\"text-muted-foreground\">العربي:</span> {formData.name}</p>\n                    <p className=\"text-sm\"><span className=\"text-muted-foreground\">الإنجليزي:</span> {formData.nameEn}</p>\n                  </div>\n                )}\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"sortOrder\">ترتيب العرض</Label>\n                  <Input\n                    id=\"sortOrder\"\n                    type=\"number\"\n                    placeholder=\"0\"\n                    value={formData.sortOrder}\n                    onChange={(e) => setFormData(prev => ({ ...prev, sortOrder: parseInt(e.target.value) || 0 }))}\n                    data-testid=\"input-city-order\"\n                  />\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Switch\n                    checked={formData.isActive}\n                    onCheckedChange={(checked) => setFormData(prev => ({ ...prev, isActive: checked }))}\n                  />\n                  <Label>نشط</Label>\n                </div>\n                <DialogFooter>\n                  <Button type=\"submit\" disabled={createMutation.isPending || updateMutation.isPending} data-testid=\"button-submit-city\">\n                    {(createMutation.isPending || updateMutation.isPending) && <Loader2 className=\"w-4 h-4 animate-spin ml-2\" />}\n                    {editingCity ? \"حفظ التعديلات\" : \"إضافة المدينة\"}\n                  </Button>\n                </DialogFooter>\n              </form>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <MapPin className=\"w-5 h-5\" />\n              قائمة المدن\n            </CardTitle>\n            <CardDescription>\n              المدن المتاحة للعملاء والتجار في التطبيق\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {isLoading ? (\n              <div className=\"flex justify-center py-12\">\n                <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n              </div>\n            ) : cities.length === 0 ? (\n              <div className=\"text-center py-12 border rounded-lg bg-muted/20\">\n                <MapPin className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n                <h3 className=\"font-semibold text-lg\">لا توجد مدن</h3>\n                <p className=\"text-muted-foreground\">قم بإضافة مدينة جديدة للبدء</p>\n              </div>\n            ) : (\n              <div className=\"rounded-md border\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead className=\"text-right\">الاسم (عربي)</TableHead>\n                      <TableHead className=\"text-right\">الاسم (إنجليزي)</TableHead>\n                      <TableHead className=\"text-right\">الترتيب</TableHead>\n                      <TableHead className=\"text-right\">الحالة</TableHead>\n                      <TableHead className=\"text-right\">إجراءات</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {cities.map((city) => (\n                      <TableRow key={city.id} data-testid={`row-city-${city.id}`}>\n                        <TableCell className=\"font-medium\">{city.name}</TableCell>\n                        <TableCell className=\"text-muted-foreground\">{city.nameEn || \"-\"}</TableCell>\n                        <TableCell>{city.sortOrder}</TableCell>\n                        <TableCell>\n                          <Badge variant={city.isActive ? \"default\" : \"secondary\"}>\n                            {city.isActive ? \"نشط\" : \"معطل\"}\n                          </Badge>\n                        </TableCell>\n                        <TableCell>\n                          <div className=\"flex gap-2\">\n                            <Button variant=\"ghost\" size=\"icon\" onClick={() => handleEdit(city)}>\n                              <Edit className=\"w-4 h-4\" />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              className=\"text-destructive hover:text-destructive hover:bg-destructive/10\"\n                              onClick={() => deleteMutation.mutate(city.id)}\n                              disabled={deleteMutation.isPending}\n                              data-testid={`button-delete-city-${city.id}`}\n                            >\n                              <Trash2 className=\"w-4 h-4\" />\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":14073,"size_tokens":null},"client/src/pages/admin/Withdrawals.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport { \n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogDescription,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Wallet, Store, CreditCard, Loader2, Check, X, Eye, Building2, Clock, CheckCircle2, XCircle } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\n\ninterface Merchant {\n  id: number;\n  ownerName: string;\n  storeName: string;\n  email: string;\n  mobile: string;\n  bankName: string | null;\n  iban: string | null;\n  accountHolderName: string | null;\n  balance: number;\n  status: string;\n  city: string;\n}\n\ninterface Transaction {\n  id: number;\n  merchantId: number;\n  type: string;\n  amount: number;\n  status: string;\n  description: string;\n  createdAt: string;\n}\n\ninterface WithdrawalWithMerchant extends Transaction {\n  merchant?: Merchant;\n}\n\nexport default function AdminWithdrawals() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [selectedWithdrawal, setSelectedWithdrawal] = useState<WithdrawalWithMerchant | null>(null);\n  const [selectedMerchant, setSelectedMerchant] = useState<Merchant | null>(null);\n\n  const { data: merchants = [], isLoading: loadingMerchants } = useQuery<Merchant[]>({\n    queryKey: [\"/api/admin/merchants\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/merchants\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch merchants\");\n      return res.json();\n    }\n  });\n\n  const { data: withdrawals = [], isLoading: loadingWithdrawals } = useQuery<Transaction[]>({\n    queryKey: [\"/api/admin/withdrawals\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/withdrawals\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch withdrawals\");\n      return res.json();\n    }\n  });\n\n  const { data: allTransactions = [] } = useQuery<Transaction[]>({\n    queryKey: [\"/api/admin/transactions\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/transactions\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch transactions\");\n      return res.json();\n    }\n  });\n\n  const updateWithdrawalMutation = useMutation({\n    mutationFn: async ({ id, status }: { id: number; status: string }) => {\n      const res = await fetch(`/api/admin/withdrawals/${id}`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ status })\n      });\n      if (!res.ok) throw new Error(\"Failed to update withdrawal\");\n      return res.json();\n    },\n    onSuccess: (_, { status }) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/withdrawals\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/transactions\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/merchants\"] });\n      toast({ \n        title: status === \"completed\" ? \"تم الموافقة على طلب السحب\" : \"تم رفض طلب السحب\",\n        className: status === \"completed\" ? \"bg-emerald-50 border-emerald-200 text-emerald-800\" : \"\"\n      });\n      setSelectedWithdrawal(null);\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"فشل تحديث طلب السحب\" });\n    }\n  });\n\n  const withdrawalsWithMerchants: WithdrawalWithMerchant[] = withdrawals.map(w => ({\n    ...w,\n    merchant: merchants.find(m => m.id === w.merchantId)\n  }));\n\n  const activeMerchants = merchants.filter(m => m.status === \"active\");\n  const totalBalance = activeMerchants.reduce((sum, m) => sum + m.balance, 0);\n  const pendingWithdrawalsAmount = withdrawals.reduce((sum, w) => sum + Math.abs(w.amount), 0);\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('ar-SA', { style: 'currency', currency: 'SAR' }).format(Math.abs(amount));\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"pending\":\n        return <Badge variant=\"outline\" className=\"bg-amber-50 text-amber-700 border-amber-200\"><Clock className=\"w-3 h-3 ml-1\" /> قيد المراجعة</Badge>;\n      case \"completed\":\n        return <Badge variant=\"outline\" className=\"bg-emerald-50 text-emerald-700 border-emerald-200\"><CheckCircle2 className=\"w-3 h-3 ml-1\" /> مكتمل</Badge>;\n      case \"rejected\":\n        return <Badge variant=\"outline\" className=\"bg-red-50 text-red-700 border-red-200\"><XCircle className=\"w-3 h-3 ml-1\" /> مرفوض</Badge>;\n      default:\n        return <Badge variant=\"secondary\">{status}</Badge>;\n    }\n  };\n\n  return (\n    <DashboardLayout role=\"admin\">\n      <div className=\"space-y-8\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight font-display\">المحافظ وطلبات السحب</h2>\n          <p className=\"text-muted-foreground mt-2\">إدارة محافظ التجار وطلبات سحب الأرصدة</p>\n        </div>\n\n        <div className=\"grid gap-4 md:grid-cols-3\">\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">إجمالي الأرصدة</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-primary\">{formatCurrency(totalBalance)}</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">{activeMerchants.length} تاجر نشط</p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">طلبات السحب المعلقة</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-amber-600\">{formatCurrency(pendingWithdrawalsAmount)}</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">{withdrawals.length} طلب</p>\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">إجمالي المعاملات</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{allTransactions.length}</div>\n              <p className=\"text-xs text-muted-foreground mt-1\">معاملة مالية</p>\n            </CardContent>\n          </Card>\n        </div>\n\n        <Tabs defaultValue=\"withdrawals\" className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-2 max-w-md\">\n            <TabsTrigger value=\"withdrawals\" className=\"gap-2\">\n              <CreditCard className=\"w-4 h-4\" />\n              طلبات السحب\n              {withdrawals.length > 0 && (\n                <Badge variant=\"destructive\" className=\"mr-2 h-5 w-5 p-0 text-xs flex items-center justify-center\">\n                  {withdrawals.length}\n                </Badge>\n              )}\n            </TabsTrigger>\n            <TabsTrigger value=\"wallets\" className=\"gap-2\">\n              <Wallet className=\"w-4 h-4\" />\n              محافظ التجار\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"withdrawals\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <CreditCard className=\"w-5 h-5\" />\n                  طلبات السحب المعلقة\n                </CardTitle>\n                <CardDescription>\n                  طلبات سحب الأرصدة من التجار بانتظار الموافقة\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                {loadingWithdrawals ? (\n                  <div className=\"flex justify-center py-12\">\n                    <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n                  </div>\n                ) : withdrawalsWithMerchants.length === 0 ? (\n                  <div className=\"text-center py-12 border rounded-lg bg-muted/20\">\n                    <CreditCard className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n                    <h3 className=\"font-semibold text-lg\">لا توجد طلبات سحب معلقة</h3>\n                    <p className=\"text-muted-foreground\">ستظهر هنا طلبات السحب من التجار</p>\n                  </div>\n                ) : (\n                  <div className=\"rounded-md border\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead className=\"text-right\">المتجر</TableHead>\n                          <TableHead className=\"text-right\">المبلغ</TableHead>\n                          <TableHead className=\"text-right\">التاريخ</TableHead>\n                          <TableHead className=\"text-right\">الحالة</TableHead>\n                          <TableHead className=\"text-right\">إجراءات</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {withdrawalsWithMerchants.map((withdrawal) => (\n                          <TableRow key={withdrawal.id} data-testid={`row-withdrawal-${withdrawal.id}`}>\n                            <TableCell>\n                              <div className=\"flex items-center gap-3\">\n                                <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center\">\n                                  <Store className=\"w-5 h-5 text-primary\" />\n                                </div>\n                                <div>\n                                  <div className=\"font-medium\">{withdrawal.merchant?.storeName || \"غير معروف\"}</div>\n                                  <div className=\"text-sm text-muted-foreground\">{withdrawal.merchant?.ownerName}</div>\n                                </div>\n                              </div>\n                            </TableCell>\n                            <TableCell>\n                              <span className=\"font-bold text-lg\">{formatCurrency(withdrawal.amount)}</span>\n                            </TableCell>\n                            <TableCell className=\"text-muted-foreground\">\n                              {new Date(withdrawal.createdAt).toLocaleDateString('ar-SA')}\n                            </TableCell>\n                            <TableCell>\n                              {getStatusBadge(withdrawal.status)}\n                            </TableCell>\n                            <TableCell>\n                              <div className=\"flex gap-2\">\n                                <Button \n                                  variant=\"outline\" \n                                  size=\"sm\"\n                                  onClick={() => setSelectedWithdrawal(withdrawal)}\n                                  data-testid={`button-view-withdrawal-${withdrawal.id}`}\n                                >\n                                  <Eye className=\"w-4 h-4 ml-1\" />\n                                  التفاصيل\n                                </Button>\n                                <Button \n                                  size=\"sm\"\n                                  className=\"bg-emerald-600 hover:bg-emerald-700\"\n                                  onClick={() => updateWithdrawalMutation.mutate({ id: withdrawal.id, status: \"completed\" })}\n                                  disabled={updateWithdrawalMutation.isPending}\n                                  data-testid={`button-approve-withdrawal-${withdrawal.id}`}\n                                >\n                                  <Check className=\"w-4 h-4\" />\n                                </Button>\n                                <Button \n                                  variant=\"destructive\"\n                                  size=\"sm\"\n                                  onClick={() => updateWithdrawalMutation.mutate({ id: withdrawal.id, status: \"rejected\" })}\n                                  disabled={updateWithdrawalMutation.isPending}\n                                  data-testid={`button-reject-withdrawal-${withdrawal.id}`}\n                                >\n                                  <X className=\"w-4 h-4\" />\n                                </Button>\n                              </div>\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"wallets\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Wallet className=\"w-5 h-5\" />\n                  محافظ التجار\n                </CardTitle>\n                <CardDescription>\n                  عرض أرصدة جميع التجار والبيانات البنكية\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                {loadingMerchants ? (\n                  <div className=\"flex justify-center py-12\">\n                    <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\n                  </div>\n                ) : activeMerchants.length === 0 ? (\n                  <div className=\"text-center py-12 border rounded-lg bg-muted/20\">\n                    <Wallet className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n                    <h3 className=\"font-semibold text-lg\">لا يوجد تجار نشطين</h3>\n                    <p className=\"text-muted-foreground\">ستظهر هنا محافظ التجار عند تفعيلهم</p>\n                  </div>\n                ) : (\n                  <div className=\"rounded-md border\">\n                    <Table>\n                      <TableHeader>\n                        <TableRow>\n                          <TableHead className=\"text-right\">المتجر</TableHead>\n                          <TableHead className=\"text-right\">الرصيد</TableHead>\n                          <TableHead className=\"text-right\">البنك</TableHead>\n                          <TableHead className=\"text-right\">المدينة</TableHead>\n                          <TableHead className=\"text-right\">إجراءات</TableHead>\n                        </TableRow>\n                      </TableHeader>\n                      <TableBody>\n                        {activeMerchants.map((merchant) => (\n                          <TableRow key={merchant.id} data-testid={`row-wallet-${merchant.id}`}>\n                            <TableCell>\n                              <div className=\"flex items-center gap-3\">\n                                <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center\">\n                                  <Store className=\"w-5 h-5 text-primary\" />\n                                </div>\n                                <div>\n                                  <div className=\"font-medium\">{merchant.storeName}</div>\n                                  <div className=\"text-sm text-muted-foreground\">{merchant.ownerName}</div>\n                                </div>\n                              </div>\n                            </TableCell>\n                            <TableCell>\n                              <span className={`font-bold text-lg ${merchant.balance > 0 ? 'text-emerald-600' : ''}`}>\n                                {formatCurrency(merchant.balance)}\n                              </span>\n                            </TableCell>\n                            <TableCell>\n                              {merchant.bankName ? (\n                                <div className=\"flex items-center gap-2\">\n                                  <Building2 className=\"w-4 h-4 text-muted-foreground\" />\n                                  <span>{merchant.bankName}</span>\n                                </div>\n                              ) : (\n                                <span className=\"text-muted-foreground\">غير محدد</span>\n                              )}\n                            </TableCell>\n                            <TableCell className=\"text-muted-foreground\">{merchant.city}</TableCell>\n                            <TableCell>\n                              <Button \n                                variant=\"outline\" \n                                size=\"sm\"\n                                onClick={() => setSelectedMerchant(merchant)}\n                                data-testid={`button-view-merchant-${merchant.id}`}\n                              >\n                                <Eye className=\"w-4 h-4 ml-1\" />\n                                التفاصيل\n                              </Button>\n                            </TableCell>\n                          </TableRow>\n                        ))}\n                      </TableBody>\n                    </Table>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n\n      <Dialog open={!!selectedWithdrawal} onOpenChange={() => setSelectedWithdrawal(null)}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>تفاصيل طلب السحب</DialogTitle>\n            <DialogDescription>معلومات الطلب والبيانات البنكية للتاجر</DialogDescription>\n          </DialogHeader>\n          \n          {selectedWithdrawal && (\n            <div className=\"space-y-6\">\n              <div className=\"grid grid-cols-3 gap-4\">\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground\">المبلغ المطلوب</p>\n                  <p className=\"text-2xl font-bold text-primary\">{formatCurrency(selectedWithdrawal.amount)}</p>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground\">رصيد المحفظة</p>\n                  <p className={`text-2xl font-bold ${(selectedWithdrawal.merchant?.balance || 0) >= Math.abs(selectedWithdrawal.amount) ? 'text-emerald-600' : 'text-red-600'}`}>\n                    {formatCurrency(selectedWithdrawal.merchant?.balance || 0)}\n                  </p>\n                </div>\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm text-muted-foreground\">الحالة</p>\n                  <div>{getStatusBadge(selectedWithdrawal.status)}</div>\n                </div>\n              </div>\n\n              {(selectedWithdrawal.merchant?.balance || 0) < Math.abs(selectedWithdrawal.amount) && selectedWithdrawal.status === \"pending\" && (\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-3 text-red-700 text-sm flex items-center gap-2\">\n                  <XCircle className=\"w-4 h-4\" />\n                  تحذير: رصيد المحفظة أقل من المبلغ المطلوب للسحب\n                </div>\n              )}\n\n              <div className=\"border rounded-lg p-4 space-y-3 bg-muted/20\">\n                <h4 className=\"font-semibold flex items-center gap-2\">\n                  <Store className=\"w-4 h-4\" />\n                  بيانات المتجر\n                </h4>\n                <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                  <div>\n                    <p className=\"text-muted-foreground\">اسم المتجر</p>\n                    <p className=\"font-medium\">{selectedWithdrawal.merchant?.storeName}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">المالك</p>\n                    <p className=\"font-medium\">{selectedWithdrawal.merchant?.ownerName}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">الجوال</p>\n                    <p className=\"font-medium font-mono\" dir=\"ltr\">{selectedWithdrawal.merchant?.mobile}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">البريد</p>\n                    <p className=\"font-medium font-mono text-xs\">{selectedWithdrawal.merchant?.email}</p>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"border rounded-lg p-4 space-y-3 bg-muted/20\">\n                <h4 className=\"font-semibold flex items-center gap-2\">\n                  <Building2 className=\"w-4 h-4\" />\n                  البيانات البنكية\n                </h4>\n                {selectedWithdrawal.merchant?.bankName ? (\n                  <div className=\"space-y-3 text-sm\">\n                    <div>\n                      <p className=\"text-muted-foreground\">اسم البنك</p>\n                      <p className=\"font-medium\">{selectedWithdrawal.merchant.bankName}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-muted-foreground\">صاحب الحساب</p>\n                      <p className=\"font-medium\">{selectedWithdrawal.merchant.accountHolderName}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-muted-foreground\">رقم الآيبان (IBAN)</p>\n                      <p className=\"font-mono text-sm bg-background p-2 rounded border\" dir=\"ltr\">\n                        {selectedWithdrawal.merchant.iban}\n                      </p>\n                    </div>\n                  </div>\n                ) : (\n                  <p className=\"text-muted-foreground text-sm\">لم يتم إضافة البيانات البنكية بعد</p>\n                )}\n              </div>\n\n              <DialogFooter className=\"gap-2\">\n                <Button variant=\"outline\" onClick={() => setSelectedWithdrawal(null)}>\n                  إغلاق\n                </Button>\n                {selectedWithdrawal.status === \"pending\" && (\n                  <>\n                    <Button \n                      variant=\"destructive\"\n                      onClick={() => updateWithdrawalMutation.mutate({ id: selectedWithdrawal.id, status: \"rejected\" })}\n                      disabled={updateWithdrawalMutation.isPending}\n                    >\n                      <X className=\"w-4 h-4 ml-1\" />\n                      رفض\n                    </Button>\n                    <Button \n                      className=\"bg-emerald-600 hover:bg-emerald-700\"\n                      onClick={() => updateWithdrawalMutation.mutate({ id: selectedWithdrawal.id, status: \"completed\" })}\n                      disabled={updateWithdrawalMutation.isPending}\n                    >\n                      {updateWithdrawalMutation.isPending ? (\n                        <Loader2 className=\"w-4 h-4 animate-spin ml-1\" />\n                      ) : (\n                        <Check className=\"w-4 h-4 ml-1\" />\n                      )}\n                      موافقة وتحويل\n                    </Button>\n                  </>\n                )}\n              </DialogFooter>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={!!selectedMerchant} onOpenChange={() => setSelectedMerchant(null)}>\n        <DialogContent className=\"max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>تفاصيل المحفظة</DialogTitle>\n            <DialogDescription>معلومات التاجر والبيانات البنكية</DialogDescription>\n          </DialogHeader>\n          \n          {selectedMerchant && (\n            <div className=\"space-y-6\">\n              <div className=\"text-center p-4 bg-primary/5 rounded-lg\">\n                <p className=\"text-sm text-muted-foreground mb-1\">الرصيد الحالي</p>\n                <p className=\"text-3xl font-bold text-primary\">{formatCurrency(selectedMerchant.balance)}</p>\n              </div>\n\n              <div className=\"border rounded-lg p-4 space-y-3 bg-muted/20\">\n                <h4 className=\"font-semibold flex items-center gap-2\">\n                  <Store className=\"w-4 h-4\" />\n                  بيانات المتجر\n                </h4>\n                <div className=\"grid grid-cols-2 gap-3 text-sm\">\n                  <div>\n                    <p className=\"text-muted-foreground\">اسم المتجر</p>\n                    <p className=\"font-medium\">{selectedMerchant.storeName}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">المالك</p>\n                    <p className=\"font-medium\">{selectedMerchant.ownerName}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">الجوال</p>\n                    <p className=\"font-medium font-mono\" dir=\"ltr\">{selectedMerchant.mobile}</p>\n                  </div>\n                  <div>\n                    <p className=\"text-muted-foreground\">المدينة</p>\n                    <p className=\"font-medium\">{selectedMerchant.city}</p>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"border rounded-lg p-4 space-y-3 bg-muted/20\">\n                <h4 className=\"font-semibold flex items-center gap-2\">\n                  <Building2 className=\"w-4 h-4\" />\n                  البيانات البنكية\n                </h4>\n                {selectedMerchant.bankName ? (\n                  <div className=\"space-y-3 text-sm\">\n                    <div>\n                      <p className=\"text-muted-foreground\">اسم البنك</p>\n                      <p className=\"font-medium\">{selectedMerchant.bankName}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-muted-foreground\">صاحب الحساب</p>\n                      <p className=\"font-medium\">{selectedMerchant.accountHolderName}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-muted-foreground\">رقم الآيبان (IBAN)</p>\n                      <p className=\"font-mono text-sm bg-background p-2 rounded border\" dir=\"ltr\">\n                        {selectedMerchant.iban}\n                      </p>\n                    </div>\n                  </div>\n                ) : (\n                  <p className=\"text-muted-foreground text-sm\">لم يتم إضافة البيانات البنكية بعد</p>\n                )}\n              </div>\n\n              <DialogFooter>\n                <Button variant=\"outline\" onClick={() => setSelectedMerchant(null)}>\n                  إغلاق\n                </Button>\n              </DialogFooter>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":27429,"size_tokens":null},"client/src/pages/merchant/Messages.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { MessageCircle, Search, Loader2, Send, User, Package, ArrowLeft } from \"lucide-react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState, useEffect, useRef } from \"react\";\nimport { format } from \"date-fns\";\nimport { ar } from \"date-fns/locale\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useSearch, useLocation } from \"wouter\";\n\ninterface Conversation {\n  id: number;\n  orderNumber: string;\n  status: string;\n  customer: {\n    id: number;\n    name: string;\n    mobile: string;\n  } | null;\n  product: {\n    id: number;\n    name: string;\n  } | null;\n  messagesCount: number;\n  lastMessage: {\n    id: number;\n    message: string;\n    senderType: string;\n    createdAt: string;\n  } | null;\n}\n\ninterface Message {\n  id: number;\n  orderId: number;\n  senderId: number;\n  senderType: string;\n  message: string;\n  createdAt: string;\n}\n\nexport default function MerchantMessages() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedConversation, setSelectedConversation] = useState<Conversation | null>(null);\n  const [newMessage, setNewMessage] = useState(\"\");\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const searchString = useSearch();\n  const [, setLocation] = useLocation();\n\n  const { data: conversations = [], isLoading } = useQuery<Conversation[]>({\n    queryKey: [\"/api/merchant/conversations\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/merchant/conversations\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch conversations\");\n      return res.json();\n    }\n  });\n\n  useEffect(() => {\n    if (conversations.length > 0 && searchString) {\n      const params = new URLSearchParams(searchString);\n      const orderId = params.get(\"orderId\");\n      if (orderId) {\n        const conversation = conversations.find(c => c.id === parseInt(orderId));\n        if (conversation) {\n          setSelectedConversation(conversation);\n          setLocation(\"/dashboard/messages\", { replace: true });\n        }\n      }\n    }\n  }, [conversations, searchString, setLocation]);\n\n  const { data: messages = [], isLoading: isLoadingMessages } = useQuery<Message[]>({\n    queryKey: [\"/api/merchant/orders\", selectedConversation?.id, \"messages\"],\n    queryFn: async () => {\n      if (!selectedConversation) return [];\n      const res = await fetch(`/api/merchant/orders/${selectedConversation.id}/messages`, { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch messages\");\n      return res.json();\n    },\n    enabled: !!selectedConversation,\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async ({ orderId, message }: { orderId: number; message: string }) => {\n      const res = await fetch(`/api/merchant/orders/${orderId}/messages`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify({ message })\n      });\n      if (!res.ok) throw new Error(\"Failed to send message\");\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/merchant/orders\", selectedConversation?.id, \"messages\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/merchant/conversations\"] });\n      setNewMessage(\"\");\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"فشل إرسال الرسالة\" });\n    }\n  });\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  const filteredConversations = conversations.filter(conv => \n    conv.orderNumber.toLowerCase().includes(searchQuery.toLowerCase()) ||\n    (conv.customer?.name && conv.customer.name.toLowerCase().includes(searchQuery.toLowerCase())) ||\n    (conv.product?.name && conv.product.name.toLowerCase().includes(searchQuery.toLowerCase()))\n  );\n\n  const handleSendMessage = () => {\n    if (!newMessage.trim() || !selectedConversation) return;\n    sendMessageMutation.mutate({\n      orderId: selectedConversation.id,\n      message: newMessage.trim()\n    });\n  };\n\n  return (\n    <DashboardLayout role=\"merchant\">\n      <div className=\"space-y-8\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight font-display\">الرسائل</h2>\n          <p className=\"text-muted-foreground mt-2\">تواصل مع العملاء بخصوص طلباتهم</p>\n        </div>\n\n        <div className=\"grid md:grid-cols-3 gap-6 h-[calc(100vh-250px)]\">\n          <Card className=\"md:col-span-1\">\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"flex items-center gap-2 text-lg\">\n                <MessageCircle className=\"w-5 h-5\" />\n                المحادثات\n              </CardTitle>\n              <div className=\"relative\">\n                <Search className=\"absolute right-3 top-3 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"بحث...\"\n                  value={searchQuery}\n                  onChange={(e) => setSearchQuery(e.target.value)}\n                  className=\"pr-9\"\n                  data-testid=\"input-search-conversations\"\n                />\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              <ScrollArea className=\"h-[calc(100vh-400px)]\" data-testid=\"conversations-list\">\n                {isLoading ? (\n                  <div className=\"flex justify-center py-12\" data-testid=\"loading-conversations\">\n                    <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n                  </div>\n                ) : filteredConversations.length === 0 ? (\n                  <div className=\"text-center py-12 px-4\" data-testid=\"empty-conversations\">\n                    <MessageCircle className=\"w-10 h-10 text-muted-foreground mx-auto mb-3\" />\n                    <p className=\"text-sm text-muted-foreground\">لا توجد محادثات</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-1 p-2\">\n                    {filteredConversations.map((conv) => (\n                      <button\n                        key={conv.id}\n                        onClick={() => setSelectedConversation(conv)}\n                        className={`w-full p-3 rounded-lg text-right transition-colors ${\n                          selectedConversation?.id === conv.id\n                            ? \"bg-primary/10 border border-primary/20\"\n                            : \"hover:bg-muted/50\"\n                        }`}\n                        data-testid={`button-conversation-${conv.id}`}\n                      >\n                        <div className=\"flex items-start justify-between gap-2\">\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center gap-2\">\n                              <User className=\"w-4 h-4 text-muted-foreground shrink-0\" />\n                              <span className=\"font-medium truncate\" data-testid={`text-customer-name-${conv.id}`}>{conv.customer?.name || \"عميل\"}</span>\n                            </div>\n                            <div className=\"flex items-center gap-2 mt-1\">\n                              <Package className=\"w-3 h-3 text-muted-foreground shrink-0\" />\n                              <span className=\"text-xs text-muted-foreground truncate\" data-testid={`text-order-info-${conv.id}`}>\n                                #{conv.orderNumber} - {conv.product?.name}\n                              </span>\n                            </div>\n                            {conv.lastMessage && (\n                              <p className=\"text-xs text-muted-foreground mt-2 truncate\" data-testid={`text-last-message-${conv.id}`}>\n                                {conv.lastMessage.senderType === \"merchant\" ? \"أنت: \" : \"\"}\n                                {conv.lastMessage.message}\n                              </p>\n                            )}\n                          </div>\n                          {conv.messagesCount > 0 && (\n                            <Badge variant=\"secondary\" className=\"shrink-0\" data-testid={`badge-count-${conv.id}`}>\n                              {conv.messagesCount}\n                            </Badge>\n                          )}\n                        </div>\n                      </button>\n                    ))}\n                  </div>\n                )}\n              </ScrollArea>\n            </CardContent>\n          </Card>\n\n          <Card className=\"md:col-span-2 flex flex-col\">\n            {selectedConversation ? (\n              <>\n                <CardHeader className=\"border-b pb-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"md:hidden\"\n                        onClick={() => setSelectedConversation(null)}\n                      >\n                        <ArrowLeft className=\"w-4 h-4\" />\n                      </Button>\n                      <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center\">\n                        <User className=\"w-5 h-5 text-primary\" />\n                      </div>\n                      <div>\n                        <CardTitle className=\"text-base\">{selectedConversation.customer?.name}</CardTitle>\n                        <CardDescription className=\"text-xs\">\n                          طلب #{selectedConversation.orderNumber} - {selectedConversation.product?.name}\n                        </CardDescription>\n                      </div>\n                    </div>\n                    <Badge variant=\"outline\">{selectedConversation.status}</Badge>\n                  </div>\n                </CardHeader>\n                <CardContent className=\"flex-1 p-0 flex flex-col\">\n                  <ScrollArea className=\"flex-1 p-4\" data-testid=\"messages-area\">\n                    {isLoadingMessages ? (\n                      <div className=\"flex justify-center py-12\" data-testid=\"loading-messages\">\n                        <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\n                      </div>\n                    ) : messages.length === 0 ? (\n                      <div className=\"text-center py-12\" data-testid=\"empty-messages\">\n                        <MessageCircle className=\"w-10 h-10 text-muted-foreground mx-auto mb-3\" />\n                        <p className=\"text-sm text-muted-foreground\">لا توجد رسائل بعد</p>\n                        <p className=\"text-xs text-muted-foreground mt-1\">ابدأ المحادثة مع العميل</p>\n                      </div>\n                    ) : (\n                      <div className=\"space-y-4\" data-testid=\"messages-list\">\n                        {messages.map((msg) => (\n                          <div\n                            key={msg.id}\n                            className={`flex ${msg.senderType === \"merchant\" ? \"justify-start\" : \"justify-end\"}`}\n                            data-testid={`message-${msg.id}`}\n                          >\n                            <div\n                              className={`max-w-[70%] p-3 rounded-2xl ${\n                                msg.senderType === \"merchant\"\n                                  ? \"bg-primary text-primary-foreground rounded-tr-sm\"\n                                  : \"bg-muted rounded-tl-sm\"\n                              }`}\n                            >\n                              <p className=\"text-sm\" data-testid={`text-message-content-${msg.id}`}>{msg.message}</p>\n                              <p className={`text-[10px] mt-1 ${\n                                msg.senderType === \"merchant\" ? \"text-primary-foreground/70\" : \"text-muted-foreground\"\n                              }`} data-testid={`text-message-time-${msg.id}`}>\n                                {format(new Date(msg.createdAt), \"HH:mm\", { locale: ar })}\n                              </p>\n                            </div>\n                          </div>\n                        ))}\n                        <div ref={messagesEndRef} />\n                      </div>\n                    )}\n                  </ScrollArea>\n                  <div className=\"p-4 border-t\">\n                    <div className=\"flex gap-2\">\n                      <Textarea\n                        placeholder=\"اكتب رسالتك...\"\n                        value={newMessage}\n                        onChange={(e) => setNewMessage(e.target.value)}\n                        onKeyDown={(e) => {\n                          if (e.key === \"Enter\" && !e.shiftKey) {\n                            e.preventDefault();\n                            handleSendMessage();\n                          }\n                        }}\n                        className=\"min-h-[44px] max-h-[120px] resize-none\"\n                        data-testid=\"input-message\"\n                      />\n                      <Button\n                        size=\"icon\"\n                        onClick={handleSendMessage}\n                        disabled={!newMessage.trim() || sendMessageMutation.isPending}\n                        data-testid=\"button-send-message\"\n                      >\n                        {sendMessageMutation.isPending ? (\n                          <Loader2 className=\"w-4 h-4 animate-spin\" />\n                        ) : (\n                          <Send className=\"w-4 h-4\" />\n                        )}\n                      </Button>\n                    </div>\n                  </div>\n                </CardContent>\n              </>\n            ) : (\n              <div className=\"flex-1 flex items-center justify-center\">\n                <div className=\"text-center\">\n                  <MessageCircle className=\"w-16 h-16 text-muted-foreground mx-auto mb-4\" />\n                  <h3 className=\"font-semibold text-lg\">اختر محادثة</h3>\n                  <p className=\"text-muted-foreground text-sm\">اختر محادثة من القائمة للبدء</p>\n                </div>\n              </div>\n            )}\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":14796,"size_tokens":null},"client/src/pages/merchant/Settings.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Store, Camera, Loader2, Save, User, Instagram, Facebook, Twitter, Globe, MapPin, Wallet, Building2, CreditCard, UserCircle, Mail, Phone, FileText, ChevronLeft } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useState, useRef, useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Merchant } from \"@shared/schema\";\n\ninterface City {\n  id: number;\n  name: string;\n  nameEn: string | null;\n  isActive: boolean;\n}\n\ninterface SocialLinks {\n  instagram?: string;\n  twitter?: string;\n  facebook?: string;\n  website?: string;\n  tiktok?: string;\n}\n\nexport default function MerchantSettings() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  \n  const [storeName, setStoreName] = useState(\"\");\n  const [username, setUsername] = useState(\"\");\n  const [bio, setBio] = useState(\"\");\n  const [city, setCity] = useState(\"\");\n  const [storeImage, setStoreImage] = useState<string | null>(null);\n  const [isUploading, setIsUploading] = useState(false);\n  const [socialLinks, setSocialLinks] = useState<SocialLinks>({\n    instagram: \"\",\n    twitter: \"\",\n    facebook: \"\",\n    website: \"\",\n    tiktok: \"\"\n  });\n  const [bankName, setBankName] = useState(\"\");\n  const [iban, setIban] = useState(\"\");\n  const [accountHolderName, setAccountHolderName] = useState(\"\");\n  const [ownerName, setOwnerName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [mobile, setMobile] = useState(\"\");\n\n  const { data: profile, isLoading } = useQuery<Merchant>({\n    queryKey: [\"/api/merchant/profile\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/merchant/profile\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch profile\");\n      return res.json();\n    }\n  });\n\n  const { data: cities = [] } = useQuery<City[]>({\n    queryKey: [\"/api/public/cities\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/public/cities\");\n      if (!res.ok) throw new Error(\"Failed to fetch cities\");\n      return res.json();\n    }\n  });\n\n  useEffect(() => {\n    if (profile) {\n      setStoreName(profile.storeName || \"\");\n      setUsername(profile.username || \"\");\n      setBio(profile.bio || \"\");\n      setCity(profile.city || \"\");\n      setStoreImage(profile.storeImage || null);\n      setBankName(profile.bankName || \"\");\n      setIban(profile.iban || \"\");\n      setAccountHolderName(profile.accountHolderName || \"\");\n      setOwnerName(profile.ownerName || \"\");\n      setEmail(profile.email || \"\");\n      setMobile(profile.mobile || \"\");\n      if (profile.socialLinks) {\n        setSocialLinks({\n          instagram: (profile.socialLinks as SocialLinks).instagram || \"\",\n          twitter: (profile.socialLinks as SocialLinks).twitter || \"\",\n          facebook: (profile.socialLinks as SocialLinks).facebook || \"\",\n          website: (profile.socialLinks as SocialLinks).website || \"\",\n          tiktok: (profile.socialLinks as SocialLinks).tiktok || \"\"\n        });\n      }\n    }\n  }, [profile]);\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: { \n      storeName?: string; \n      username?: string; \n      bio?: string; \n      storeImage?: string;\n      city?: string;\n      socialLinks?: SocialLinks;\n      bankName?: string;\n      iban?: string;\n      accountHolderName?: string;\n      ownerName?: string;\n      email?: string;\n      mobile?: string;\n    }) => {\n      const res = await fetch(\"/api/merchant/profile\", {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        credentials: \"include\",\n        body: JSON.stringify(data)\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to update profile\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/merchant/profile\"] });\n      toast({ title: \"تم حفظ التغييرات بنجاح\" });\n    },\n    onError: (error: any) => {\n      toast({ variant: \"destructive\", title: \"خطأ\", description: error.message });\n    }\n  });\n\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (file.size > 5 * 1024 * 1024) {\n      toast({ variant: \"destructive\", title: \"حجم الصورة كبير جداً\", description: \"الحد الأقصى 5 ميجابايت\" });\n      return;\n    }\n\n    setIsUploading(true);\n    const formData = new FormData();\n    formData.append(\"images\", file);\n\n    try {\n      const res = await fetch(\"/api/merchant/products/upload-images\", {\n        method: \"POST\",\n        credentials: \"include\",\n        body: formData\n      });\n\n      if (!res.ok) throw new Error(\"Failed to upload image\");\n      \n      const data = await res.json();\n      if (data.images && data.images.length > 0) {\n        setStoreImage(data.images[0]);\n        toast({ title: \"تم رفع الصورة بنجاح\" });\n      }\n    } catch (error) {\n      toast({ variant: \"destructive\", title: \"فشل رفع الصورة\" });\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const handleSave = () => {\n    const cleanLinks: SocialLinks = {};\n    if (socialLinks.instagram?.trim()) cleanLinks.instagram = socialLinks.instagram.trim();\n    if (socialLinks.twitter?.trim()) cleanLinks.twitter = socialLinks.twitter.trim();\n    if (socialLinks.facebook?.trim()) cleanLinks.facebook = socialLinks.facebook.trim();\n    if (socialLinks.website?.trim()) cleanLinks.website = socialLinks.website.trim();\n    if (socialLinks.tiktok?.trim()) cleanLinks.tiktok = socialLinks.tiktok.trim();\n\n    updateProfileMutation.mutate({\n      storeName,\n      username,\n      bio,\n      city,\n      storeImage: storeImage || undefined,\n      socialLinks: Object.keys(cleanLinks).length > 0 ? cleanLinks : undefined,\n      bankName: bankName.trim() || undefined,\n      iban: iban.trim() || undefined,\n      accountHolderName: accountHolderName.trim() || undefined,\n      ownerName: ownerName.trim() || undefined,\n      email: email.trim() || undefined,\n      mobile: mobile.trim() || undefined\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <DashboardLayout role=\"merchant\">\n        <div className=\"flex items-center justify-center min-h-[60vh]\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout role=\"merchant\">\n      <div className=\"space-y-8 max-w-2xl\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight font-display\">إعدادات المتجر</h2>\n          <p className=\"text-muted-foreground mt-2\">تعديل معلومات وصورة متجرك</p>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Store className=\"w-5 h-5\" />\n              الملف الشخصي للمتجر\n            </CardTitle>\n            <CardDescription>\n              هذه المعلومات ستظهر للعملاء في صفحة متجرك\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"flex flex-col items-center gap-4\">\n              <div className=\"relative\">\n                <Avatar className=\"w-32 h-32 border-4 border-background shadow-lg\">\n                  <AvatarImage src={storeImage || undefined} alt={storeName} />\n                  <AvatarFallback className=\"bg-primary/10 text-primary text-3xl\">\n                    <Store className=\"w-12 h-12\" />\n                  </AvatarFallback>\n                </Avatar>\n                <Button\n                  size=\"icon\"\n                  variant=\"secondary\"\n                  className=\"absolute bottom-0 left-0 rounded-full shadow-md\"\n                  onClick={() => fileInputRef.current?.click()}\n                  disabled={isUploading}\n                  data-testid=\"button-upload-image\"\n                >\n                  {isUploading ? (\n                    <Loader2 className=\"w-4 h-4 animate-spin\" />\n                  ) : (\n                    <Camera className=\"w-4 h-4\" />\n                  )}\n                </Button>\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  className=\"hidden\"\n                  onChange={handleImageUpload}\n                />\n              </div>\n              <p className=\"text-sm text-muted-foreground\">اضغط على الكاميرا لتغيير صورة المتجر</p>\n            </div>\n\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"storeName\">اسم المتجر</Label>\n                <Input\n                  id=\"storeName\"\n                  value={storeName}\n                  onChange={(e) => setStoreName(e.target.value)}\n                  placeholder=\"اسم متجرك\"\n                  data-testid=\"input-store-name\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"username\">اسم المستخدم</Label>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"flex-1 relative\">\n                    <User className=\"absolute right-3 top-2.5 h-4 w-4 text-muted-foreground\" />\n                    <Input\n                      id=\"username\"\n                      value={username}\n                      onChange={(e) => setUsername(e.target.value.toLowerCase().replace(/[^a-z0-9_]/g, ''))}\n                      placeholder=\"store_name\"\n                      className=\"pr-10 font-mono text-left\"\n                      dir=\"ltr\"\n                      data-testid=\"input-username\"\n                    />\n                  </div>\n                </div>\n                <p className=\"text-xs text-muted-foreground\">رابط متجرك: glorda.com/{username || \"username\"}</p>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"city\" className=\"flex items-center gap-2\">\n                  <MapPin className=\"w-4 h-4\" />\n                  المدينة\n                </Label>\n                <Select value={city} onValueChange={setCity}>\n                  <SelectTrigger data-testid=\"select-city\">\n                    <SelectValue placeholder=\"اختر المدينة\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {cities.map((c) => (\n                      <SelectItem key={c.id} value={c.name} data-testid={`option-city-${c.id}`}>\n                        {c.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"bio\">نبذة عن المتجر</Label>\n                <Textarea\n                  id=\"bio\"\n                  value={bio}\n                  onChange={(e) => setBio(e.target.value)}\n                  placeholder=\"اكتب نبذة قصيرة عن متجرك ومنتجاتك...\"\n                  rows={4}\n                  className=\"resize-none\"\n                  data-testid=\"input-bio\"\n                />\n                <p className=\"text-xs text-muted-foreground\">{bio.length}/500 حرف</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Globe className=\"w-5 h-5\" />\n              وسائل التواصل الاجتماعي\n            </CardTitle>\n            <CardDescription>\n              أدخل روابط حساباتك في المنصات المختلفة لتظهر للعملاء في التطبيق\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label className=\"flex items-center gap-2\">\n                <Instagram className=\"w-4 h-4 text-pink-600\" /> انستقرام\n              </Label>\n              <Input \n                placeholder=\"https://instagram.com/your-store\" \n                dir=\"ltr\"\n                value={socialLinks.instagram}\n                onChange={(e) => setSocialLinks(prev => ({ ...prev, instagram: e.target.value }))}\n                data-testid=\"input-instagram\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label className=\"flex items-center gap-2\">\n                <Twitter className=\"w-4 h-4 text-sky-500\" /> تويتر (X)\n              </Label>\n              <Input \n                placeholder=\"https://twitter.com/your-store\" \n                dir=\"ltr\"\n                value={socialLinks.twitter}\n                onChange={(e) => setSocialLinks(prev => ({ ...prev, twitter: e.target.value }))}\n                data-testid=\"input-twitter\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label className=\"flex items-center gap-2\">\n                <Facebook className=\"w-4 h-4 text-blue-600\" /> فيسبوك\n              </Label>\n              <Input \n                placeholder=\"https://facebook.com/your-store\" \n                dir=\"ltr\"\n                value={socialLinks.facebook}\n                onChange={(e) => setSocialLinks(prev => ({ ...prev, facebook: e.target.value }))}\n                data-testid=\"input-facebook\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label className=\"flex items-center gap-2\">\n                <Globe className=\"w-4 h-4 text-gray-600\" /> الموقع الإلكتروني\n              </Label>\n              <Input \n                placeholder=\"https://your-store.com\" \n                dir=\"ltr\"\n                value={socialLinks.website}\n                onChange={(e) => setSocialLinks(prev => ({ ...prev, website: e.target.value }))}\n                data-testid=\"input-website\"\n              />\n            </div>\n            \n            <div className=\"space-y-2\">\n              <Label className=\"flex items-center gap-2\">\n                <svg className=\"w-4 h-4\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                  <path d=\"M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z\"/>\n                </svg>\n                تيك توك\n              </Label>\n              <Input \n                placeholder=\"https://tiktok.com/@your-store\" \n                dir=\"ltr\"\n                value={socialLinks.tiktok}\n                onChange={(e) => setSocialLinks(prev => ({ ...prev, tiktok: e.target.value }))}\n                data-testid=\"input-tiktok\"\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Wallet className=\"w-5 h-5\" />\n              بيانات المحفظة البنكية\n            </CardTitle>\n            <CardDescription>\n              أدخل بياناتك البنكية لاستلام أرباحك عند طلب السحب\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"bankName\" className=\"flex items-center gap-2\">\n                <Building2 className=\"w-4 h-4 text-muted-foreground\" />\n                اسم البنك\n              </Label>\n              <Input\n                id=\"bankName\"\n                value={bankName}\n                onChange={(e) => setBankName(e.target.value)}\n                placeholder=\"مثال: البنك الأهلي السعودي\"\n                data-testid=\"input-bank-name\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"iban\" className=\"flex items-center gap-2\">\n                <CreditCard className=\"w-4 h-4 text-muted-foreground\" />\n                رقم الآيبان (IBAN)\n              </Label>\n              <Input\n                id=\"iban\"\n                value={iban}\n                onChange={(e) => setIban(e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, ''))}\n                placeholder=\"SA0000000000000000000000\"\n                className=\"font-mono text-left\"\n                dir=\"ltr\"\n                maxLength={24}\n                data-testid=\"input-iban\"\n              />\n              <p className=\"text-xs text-muted-foreground\">رقم الآيبان السعودي يتكون من 24 حرف ورقم</p>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"accountHolderName\" className=\"flex items-center gap-2\">\n                <UserCircle className=\"w-4 h-4 text-muted-foreground\" />\n                اسم المستفيد (صاحب الحساب)\n              </Label>\n              <Input\n                id=\"accountHolderName\"\n                value={accountHolderName}\n                onChange={(e) => setAccountHolderName(e.target.value)}\n                placeholder=\"الاسم كما هو مسجل في البنك\"\n                data-testid=\"input-account-holder\"\n              />\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <User className=\"w-5 h-5\" />\n              معلومات الحساب\n            </CardTitle>\n            <CardDescription>تعديل بيانات حسابك الشخصية</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"ownerName\" className=\"flex items-center gap-2\">\n                <User className=\"w-4 h-4 text-muted-foreground\" />\n                اسم المالك\n              </Label>\n              <Input\n                id=\"ownerName\"\n                value={ownerName}\n                onChange={(e) => setOwnerName(e.target.value)}\n                placeholder=\"الاسم الكامل\"\n                data-testid=\"input-owner-name\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"email\" className=\"flex items-center gap-2\">\n                <Mail className=\"w-4 h-4 text-muted-foreground\" />\n                البريد الإلكتروني\n              </Label>\n              <Input\n                id=\"email\"\n                type=\"email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                placeholder=\"name@example.com\"\n                className=\"font-mono text-left\"\n                dir=\"ltr\"\n                data-testid=\"input-email\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"mobile\" className=\"flex items-center gap-2\">\n                <Phone className=\"w-4 h-4 text-muted-foreground\" />\n                رقم الجوال\n              </Label>\n              <Input\n                id=\"mobile\"\n                value={mobile}\n                onChange={(e) => setMobile(e.target.value)}\n                placeholder=\"05xxxxxxxx\"\n                className=\"font-mono text-left\"\n                dir=\"ltr\"\n                data-testid=\"input-mobile\"\n              />\n            </div>\n\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <FileText className=\"w-5 h-5\" />\n              السياسات والشروط\n            </CardTitle>\n            <CardDescription>اطلع على سياسات وشروط استخدام منصة غلوردا</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Link href=\"/dashboard/terms\">\n              <Button variant=\"outline\" className=\"w-full justify-between h-14\" data-testid=\"button-view-policies\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center\">\n                    <FileText className=\"w-5 h-5 text-primary\" />\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"font-medium\">عرض السياسات والشروط</p>\n                    <p className=\"text-xs text-muted-foreground\">الشروط والأحكام، سياسة الخصوصية، من نحن</p>\n                  </div>\n                </div>\n                <ChevronLeft className=\"w-5 h-5 text-muted-foreground\" />\n              </Button>\n            </Link>\n          </CardContent>\n        </Card>\n\n        <Button\n          onClick={handleSave}\n          disabled={updateProfileMutation.isPending}\n          className=\"w-full\"\n          size=\"lg\"\n          data-testid=\"button-save\"\n        >\n          {updateProfileMutation.isPending ? (\n            <Loader2 className=\"w-4 h-4 animate-spin ml-2\" />\n          ) : (\n            <Save className=\"w-4 h-4 ml-2\" />\n          )}\n          حفظ جميع التغييرات\n        </Button>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":22119,"size_tokens":null},"server/db.ts":{"content":"import { drizzle } from \"drizzle-orm/node-postgres\";\nimport pg from \"pg\";\n\nconst { Pool } = pg;\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n});\n\nexport const db = drizzle(pool);\nexport { pool };\n","path":null,"size_bytes":222,"size_tokens":null},"client/src/lib/api.ts":{"content":"export async function apiRequest(url: string, options?: RequestInit): Promise<Response> {\n  return fetch(url, {\n    ...options,\n    credentials: \"include\",\n  });\n}\n","path":null,"size_bytes":164,"size_tokens":null},"client/src/pages/auth/VerifyOTP.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { InputOTP, InputOTPGroup, InputOTPSlot } from \"@/components/ui/input-otp\";\nimport { Link, useLocation, useSearch } from \"wouter\";\nimport { KeyRound, Loader2, ArrowRight, RefreshCw } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport logoUrl from \"@assets/شعار_غلوردا_1764881546720.jpg\";\n\nconst formSchema = z.object({\n  otp: z.string().length(6, { message: \"رمز التحقق يجب أن يكون 6 أرقام\" }),\n});\n\nexport default function VerifyOTP() {\n  const [, setLocation] = useLocation();\n  const searchString = useSearch();\n  const params = new URLSearchParams(searchString);\n  const email = params.get(\"email\") || \"\";\n  \n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [isResending, setIsResending] = useState(false);\n  const { toast } = useToast();\n\n  const form = useForm<z.infer<typeof formSchema>>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      otp: \"\",\n    },\n  });\n\n  async function onSubmit(values: z.infer<typeof formSchema>) {\n    setIsSubmitting(true);\n    \n    try {\n      const response = await fetch(\"/api/auth/verify-otp\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email, otp: values.otp }),\n      });\n      \n      const data = await response.json();\n      \n      if (!response.ok) {\n        toast({\n          variant: \"destructive\",\n          title: \"خطأ\",\n          description: data.error || \"رمز التحقق غير صحيح\",\n        });\n        return;\n      }\n      \n      toast({\n        title: \"تم التحقق بنجاح\",\n        description: \"يمكنك الآن إعادة تعيين كلمة المرور\",\n      });\n      \n      setLocation(`/reset-password?email=${encodeURIComponent(email)}&token=${data.token}`);\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"خطأ\",\n        description: \"فشل الاتصال بالخادم\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  }\n\n  async function resendOTP() {\n    setIsResending(true);\n    \n    try {\n      const response = await fetch(\"/api/auth/forgot-password\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ email }),\n      });\n      \n      if (response.ok) {\n        toast({\n          title: \"تم إعادة إرسال الرمز\",\n          description: \"تحقق من بريدك الإلكتروني\",\n        });\n      }\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"خطأ\",\n        description: \"فشل إعادة إرسال الرمز\",\n      });\n    } finally {\n      setIsResending(false);\n    }\n  }\n\n  if (!email) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-muted/30 p-4\" dir=\"rtl\">\n        <Card className=\"w-full max-w-md\">\n          <CardContent className=\"pt-6 text-center\">\n            <p className=\"text-muted-foreground mb-4\">لم يتم تحديد البريد الإلكتروني</p>\n            <Link href=\"/forgot-password\">\n              <Button>العودة</Button>\n            </Link>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-muted/30 p-4\" dir=\"rtl\">\n      <div className=\"w-full max-w-md space-y-8\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"flex justify-center\">\n            <div className=\"w-20 h-20 rounded-full overflow-hidden border-4 border-white shadow-lg\">\n              <img src={logoUrl} alt=\"Logo\" className=\"w-full h-full object-cover\" />\n            </div>\n          </div>\n          <h1 className=\"text-2xl font-bold tracking-tight font-display text-primary\">التحقق من الرمز</h1>\n          <p className=\"text-muted-foreground text-sm\">\n            أدخل الرمز المرسل إلى<br />\n            <span className=\"font-mono text-foreground\">{email}</span>\n          </p>\n        </div>\n\n        <Card className=\"border-none shadow-xl overflow-hidden\">\n          <div className=\"h-1 bg-primary w-full\" />\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <KeyRound className=\"w-5 h-5\" />\n              رمز التحقق\n            </CardTitle>\n            <CardDescription>أدخل الرمز المكون من 6 أرقام</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <FormField\n                  control={form.control}\n                  name=\"otp\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-col items-center\">\n                      <FormLabel>رمز التحقق</FormLabel>\n                      <FormControl>\n                        <InputOTP maxLength={6} {...field} data-testid=\"input-otp\">\n                          <InputOTPGroup dir=\"ltr\" className=\"gap-2\">\n                            <InputOTPSlot index={0} className=\"w-12 h-12 text-lg\" />\n                            <InputOTPSlot index={1} className=\"w-12 h-12 text-lg\" />\n                            <InputOTPSlot index={2} className=\"w-12 h-12 text-lg\" />\n                            <InputOTPSlot index={3} className=\"w-12 h-12 text-lg\" />\n                            <InputOTPSlot index={4} className=\"w-12 h-12 text-lg\" />\n                            <InputOTPSlot index={5} className=\"w-12 h-12 text-lg\" />\n                          </InputOTPGroup>\n                        </InputOTP>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <Button type=\"submit\" className=\"w-full\" disabled={isSubmitting} data-testid=\"button-verify\">\n                  {isSubmitting ? (\n                    <Loader2 className=\"w-4 h-4 animate-spin ml-2\" />\n                  ) : (\n                    <KeyRound className=\"w-4 h-4 ml-2\" />\n                  )}\n                  تحقق من الرمز\n                </Button>\n              </form>\n            </Form>\n            \n            <div className=\"mt-6 space-y-4\">\n              <Button \n                variant=\"outline\" \n                className=\"w-full\" \n                onClick={resendOTP}\n                disabled={isResending}\n                data-testid=\"button-resend\"\n              >\n                {isResending ? (\n                  <Loader2 className=\"w-4 h-4 animate-spin ml-2\" />\n                ) : (\n                  <RefreshCw className=\"w-4 h-4 ml-2\" />\n                )}\n                إعادة إرسال الرمز\n              </Button>\n              \n              <div className=\"text-center\">\n                <Link href=\"/\" className=\"text-sm text-primary hover:underline inline-flex items-center gap-1\">\n                  <ArrowRight className=\"w-4 h-4\" />\n                  العودة لتسجيل الدخول\n                </Link>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":7646,"size_tokens":null},"client/src/pages/auth/ForgotPassword.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Link, useLocation } from \"wouter\";\nimport { Mail, Loader2, ArrowRight } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport logoUrl from \"@assets/شعار_غلوردا_1764881546720.jpg\";\n\nconst formSchema = z.object({\n  email: z.string().email({ message: \"البريد الإلكتروني غير صالح\" }),\n});\n\nexport default function ForgotPassword() {\n  const [, setLocation] = useLocation();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const { toast } = useToast();\n\n  const form = useForm<z.infer<typeof formSchema>>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      email: \"\",\n    },\n  });\n\n  async function onSubmit(values: z.infer<typeof formSchema>) {\n    setIsSubmitting(true);\n    \n    try {\n      const response = await fetch(\"/api/auth/forgot-password\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(values),\n      });\n      \n      const data = await response.json();\n      \n      if (!response.ok) {\n        toast({\n          variant: \"destructive\",\n          title: \"خطأ\",\n          description: data.error || \"حدث خطأ ما\",\n        });\n        return;\n      }\n      \n      toast({\n        title: \"تم إرسال رمز التحقق\",\n        description: \"يرجى التحقق من بريدك الإلكتروني\",\n      });\n      \n      setLocation(`/verify-otp?email=${encodeURIComponent(values.email)}`);\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"خطأ\",\n        description: \"فشل الاتصال بالخادم\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-muted/30 p-4\" dir=\"rtl\">\n      <div className=\"w-full max-w-md space-y-8\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"flex justify-center\">\n            <div className=\"w-20 h-20 rounded-full overflow-hidden border-4 border-white shadow-lg\">\n              <img src={logoUrl} alt=\"Logo\" className=\"w-full h-full object-cover\" />\n            </div>\n          </div>\n          <h1 className=\"text-2xl font-bold tracking-tight font-display text-primary\">نسيت كلمة المرور؟</h1>\n          <p className=\"text-muted-foreground text-sm\">أدخل بريدك الإلكتروني لإرسال رمز التحقق</p>\n        </div>\n\n        <Card className=\"border-none shadow-xl overflow-hidden\">\n          <div className=\"h-1 bg-primary w-full\" />\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Mail className=\"w-5 h-5\" />\n              استعادة كلمة المرور\n            </CardTitle>\n            <CardDescription>سيتم إرسال رمز التحقق إلى بريدك الإلكتروني</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>البريد الإلكتروني</FormLabel>\n                      <FormControl>\n                        <Input \n                          placeholder=\"name@example.com\" \n                          {...field} \n                          className=\"bg-background/50 font-mono text-left\" \n                          dir=\"ltr\"\n                          data-testid=\"input-email\" \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <Button type=\"submit\" className=\"w-full\" disabled={isSubmitting} data-testid=\"button-submit\">\n                  {isSubmitting ? (\n                    <Loader2 className=\"w-4 h-4 animate-spin ml-2\" />\n                  ) : (\n                    <Mail className=\"w-4 h-4 ml-2\" />\n                  )}\n                  إرسال رمز التحقق\n                </Button>\n              </form>\n            </Form>\n            \n            <div className=\"mt-6 text-center\">\n              <Link href=\"/\" className=\"text-sm text-primary hover:underline inline-flex items-center gap-1\">\n                <ArrowRight className=\"w-4 h-4\" />\n                العودة لتسجيل الدخول\n              </Link>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":5094,"size_tokens":null},"DEPLOYMENT.md":{"content":"# Glorda - دليل النشر والتشغيل\n\n## نظرة عامة\n\nغلوردا هي منصة تجارة إلكترونية متعددة المستأجرين مبنية باستخدام React و Express و PostgreSQL.\n\n## متطلبات النظام\n\n- Node.js 18+ أو 20+\n- PostgreSQL 14+\n- npm أو yarn\n\n## التقنيات المستخدمة\n\n### الواجهة الأمامية (Frontend)\n- React 19 + TypeScript\n- Vite (أداة البناء)\n- TailwindCSS (التنسيق)\n- shadcn/ui + Radix UI (مكونات الواجهة)\n- TanStack Query (إدارة البيانات)\n- React Hook Form + Zod (النماذج والتحقق)\n- Wouter (التوجيه)\n\n### الواجهة الخلفية (Backend)\n- Node.js + Express\n- express-session + connect-pg-simple (إدارة الجلسات)\n- Passport.js (المصادقة)\n- bcryptjs (تشفير كلمات المرور)\n- Multer (رفع الملفات)\n\n### قاعدة البيانات\n- PostgreSQL\n- Drizzle ORM\n- drizzle-zod (التحقق من البيانات)\n\n## خطوات التثبيت\n\n### 1. استنساخ المشروع\n\n```bash\ngit clone <repository-url>\ncd glorda\n```\n\n### 2. تثبيت التبعيات\n\n```bash\nnpm install\n```\n\n### 3. إعداد متغيرات البيئة\n\nانسخ ملف `.env.example` إلى `.env`:\n\n```bash\ncp .env.example .env\n```\n\nعدّل الملف `.env` بالقيم الصحيحة:\n\n```env\n# قاعدة البيانات (مطلوب)\nDATABASE_URL=postgresql://username:password@localhost:5432/glorda\n\n# مفتاح الجلسات (مطلوب للإنتاج)\nSESSION_SECRET=your-super-secret-key-here\n\n# إعدادات الخادم\nPORT=5000\nNODE_ENV=production\n```\n\n### 4. إعداد قاعدة البيانات\n\nإنشاء قاعدة البيانات:\n\n```bash\ncreatedb glorda\n```\n\nتطبيق الجداول:\n\n```bash\nnpm run db:push\n```\n\n### 5. بناء المشروع\n\n```bash\nnpm run build\n```\n\n### 6. تشغيل المشروع\n\n```bash\nnpm start\n```\n\nالتطبيق سيعمل على: `http://localhost:5000`\n\n## هيكل المشروع\n\n```\nglorda/\n├── client/                 # الواجهة الأمامية (React)\n│   ├── src/\n│   │   ├── components/    # مكونات UI\n│   │   ├── pages/         # صفحات التطبيق\n│   │   ├── hooks/         # React hooks\n│   │   └── lib/           # أدوات مساعدة\n├── server/                 # الواجهة الخلفية (Express)\n│   ├── index.ts           # نقطة الدخول\n│   ├── routes.ts          # مسارات API\n│   └── storage.ts         # طبقة قاعدة البيانات\n├── shared/                 # كود مشترك\n│   └── schema.ts          # مخطط قاعدة البيانات\n├── uploads/               # مجلد الملفات المرفوعة\n└── dist/                  # ملفات البناء\n```\n\n## الأوامر المتاحة\n\n| الأمر | الوصف |\n|-------|-------|\n| `npm run dev` | تشغيل بيئة التطوير |\n| `npm run build` | بناء المشروع للإنتاج |\n| `npm start` | تشغيل الخادم (الإنتاج) |\n| `npm run db:push` | تحديث قاعدة البيانات |\n| `npm run db:studio` | فتح واجهة Drizzle Studio |\n\n## نقاط API الرئيسية\n\n### المصادقة\n- `POST /api/auth/register` - تسجيل تاجر جديد\n- `POST /api/auth/login/merchant` - دخول التاجر\n- `POST /api/auth/login/admin` - دخول المسؤول\n- `POST /api/auth/logout` - تسجيل الخروج\n- `GET /api/auth/me` - معلومات المستخدم الحالي\n\n### التاجر\n- `GET /api/merchant/profile` - الملف الشخصي\n- `PATCH /api/merchant/profile` - تحديث الملف الشخصي\n- `GET /api/merchant/products` - المنتجات\n- `GET /api/merchant/orders` - الطلبات\n- `GET /api/merchant/transactions` - المعاملات\n\n### المسؤول\n- `GET /api/admin/merchants` - قائمة التجار\n- `GET /api/admin/orders` - جميع الطلبات\n- `GET /api/admin/transactions` - جميع المعاملات\n\n## ملاحظات للإنتاج\n\n### 1. تخزين الملفات\nحالياً يتم تخزين الملفات محلياً في مجلد `uploads/`. للإنتاج، يُنصح باستخدام:\n- AWS S3\n- Cloudinary\n- أي خدمة تخزين سحابية\n\n### 2. خدمة البريد الإلكتروني\nلتفعيل إرسال رموز OTP، أضف:\n- SendGrid\n- Resend\n- أي خدمة SMTP\n\n### 3. الأمان\n- استخدم HTTPS في الإنتاج\n- قم بتعيين `SESSION_SECRET` قوي\n- فعّل جدار الحماية\n\n### 4. النسخ الاحتياطي\n- قم بعمل نسخ احتياطي دوري لقاعدة البيانات\n- احتفظ بنسخة من مجلد `uploads/`\n\n## استكشاف الأخطاء\n\n### خطأ في الاتصال بقاعدة البيانات\nتأكد من:\n- قاعدة البيانات تعمل\n- `DATABASE_URL` صحيح\n- الصلاحيات كافية\n\n### مشاكل الجلسات\nتأكد من:\n- `SESSION_SECRET` معيّن\n- الكوكيز مفعلة في المتصفح\n\n### أخطاء رفع الملفات\nتأكد من:\n- مجلد `uploads/` موجود وقابل للكتابة\n- حجم الملف لا يتجاوز 5MB\n\n## الدعم\n\nللمساعدة أو الإبلاغ عن مشاكل، تواصل عبر [contact@glorda.com]\n","path":null,"size_bytes":5432,"size_tokens":null},"client/src/pages/merchant/Terms.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Button } from \"@/components/ui/button\";\nimport { Loader2, FileText, Shield, BookOpen, AlertCircle, RefreshCw, ArrowRight } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\n\ninterface SettingData {\n  key: string;\n  value: string | null;\n}\n\nexport default function MerchantTerms() {\n  const { data: termsData, isLoading: termsLoading, error: termsError, refetch: refetchTerms } = useQuery<SettingData>({\n    queryKey: [\"/api/public/settings/merchant_terms_conditions\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/public/settings/merchant_terms_conditions\");\n      if (!res.ok) throw new Error(\"Failed to fetch terms\");\n      return res.json();\n    },\n    staleTime: 0,\n    refetchOnMount: \"always\"\n  });\n\n  const { data: privacyData, isLoading: privacyLoading } = useQuery<SettingData>({\n    queryKey: [\"/api/public/settings/merchant_privacy_policy\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/public/settings/merchant_privacy_policy\");\n      if (!res.ok) throw new Error(\"Failed to fetch privacy\");\n      return res.json();\n    },\n    staleTime: 0,\n    refetchOnMount: \"always\"\n  });\n\n  const { data: aboutData, isLoading: aboutLoading } = useQuery<SettingData>({\n    queryKey: [\"/api/public/settings/merchant_about_us\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/public/settings/merchant_about_us\");\n      if (!res.ok) throw new Error(\"Failed to fetch about\");\n      return res.json();\n    },\n    staleTime: 0,\n    refetchOnMount: \"always\"\n  });\n\n  const isLoading = termsLoading || privacyLoading || aboutLoading;\n\n  if (isLoading) {\n    return (\n      <DashboardLayout role=\"merchant\">\n        <div className=\"flex items-center justify-center min-h-[60vh]\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-primary\" data-testid=\"loading-spinner\" />\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  if (termsError) {\n    return (\n      <DashboardLayout role=\"merchant\">\n        <div className=\"flex flex-col items-center justify-center min-h-[60vh] gap-4\">\n          <AlertCircle className=\"w-12 h-12 text-destructive\" />\n          <p className=\"text-muted-foreground\">حدث خطأ أثناء تحميل البيانات</p>\n          <Button onClick={() => refetchTerms()} variant=\"outline\" data-testid=\"button-retry\">\n            <RefreshCw className=\"w-4 h-4 ml-2\" />\n            إعادة المحاولة\n          </Button>\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  const termsContent = termsData?.value || \"لا توجد شروط وأحكام متاحة حالياً.\";\n  const privacyContent = privacyData?.value || \"لا توجد سياسة خصوصية متاحة حالياً.\";\n  const aboutContent = aboutData?.value || \"لا توجد معلومات متاحة حالياً.\";\n\n  return (\n    <DashboardLayout role=\"merchant\">\n      <div className=\"space-y-6 max-w-2xl\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold font-display\" data-testid=\"text-page-title\">السياسات والشروط</h1>\n            <p className=\"text-muted-foreground mt-1\">اطلع على سياسات وشروط استخدام منصة غلوردا</p>\n          </div>\n          <Link href=\"/dashboard/settings\">\n            <Button variant=\"outline\" size=\"sm\" className=\"gap-2\">\n              <ArrowRight className=\"w-4 h-4\" />\n              العودة للإعدادات\n            </Button>\n          </Link>\n        </div>\n\n        <Tabs defaultValue=\"terms\" className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-3\">\n            <TabsTrigger value=\"terms\" className=\"gap-2\" data-testid=\"tab-terms\">\n              <FileText className=\"w-4 h-4\" />\n              <span className=\"hidden sm:inline\">الشروط والأحكام</span>\n              <span className=\"sm:hidden\">الشروط</span>\n            </TabsTrigger>\n            <TabsTrigger value=\"privacy\" className=\"gap-2\" data-testid=\"tab-privacy\">\n              <Shield className=\"w-4 h-4\" />\n              <span className=\"hidden sm:inline\">سياسة الخصوصية</span>\n              <span className=\"sm:hidden\">الخصوصية</span>\n            </TabsTrigger>\n            <TabsTrigger value=\"about\" className=\"gap-2\" data-testid=\"tab-about\">\n              <BookOpen className=\"w-4 h-4\" />\n              من نحن\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"terms\">\n            <Card data-testid=\"card-terms\">\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center\">\n                    <FileText className=\"w-6 h-6 text-primary\" />\n                  </div>\n                  <div>\n                    <CardTitle>الشروط والأحكام</CardTitle>\n                    <CardDescription>شروط وأحكام استخدام منصة غلوردا للتجار</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"bg-muted/30 rounded-lg p-6 border min-h-[300px]\">\n                  <div \n                    className=\"prose prose-sm max-w-none text-foreground leading-relaxed whitespace-pre-wrap\"\n                    data-testid=\"text-terms-content\"\n                  >\n                    {termsContent}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"privacy\">\n            <Card data-testid=\"card-privacy\">\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-12 h-12 rounded-full bg-emerald-500/10 flex items-center justify-center\">\n                    <Shield className=\"w-6 h-6 text-emerald-600\" />\n                  </div>\n                  <div>\n                    <CardTitle>سياسة الخصوصية</CardTitle>\n                    <CardDescription>كيف نحمي بياناتك ونحافظ على خصوصيتك</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"bg-muted/30 rounded-lg p-6 border min-h-[300px]\">\n                  <div \n                    className=\"prose prose-sm max-w-none text-foreground leading-relaxed whitespace-pre-wrap\"\n                    data-testid=\"text-privacy-content\"\n                  >\n                    {privacyContent}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"about\">\n            <Card data-testid=\"card-about\">\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-12 h-12 rounded-full bg-blue-500/10 flex items-center justify-center\">\n                    <BookOpen className=\"w-6 h-6 text-blue-600\" />\n                  </div>\n                  <div>\n                    <CardTitle>من نحن</CardTitle>\n                    <CardDescription>تعرف على منصة غلوردا ورؤيتنا</CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"bg-muted/30 rounded-lg p-6 border min-h-[300px]\">\n                  <div \n                    className=\"prose prose-sm max-w-none text-foreground leading-relaxed whitespace-pre-wrap\"\n                    data-testid=\"text-about-content\"\n                  >\n                    {aboutContent}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":8176,"size_tokens":null},"client/src/pages/auth/ResetPassword.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport * as z from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Link, useLocation, useSearch } from \"wouter\";\nimport { Lock, Loader2, CheckCircle, Eye, EyeOff } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport logoUrl from \"@assets/شعار_غلوردا_1764881546720.jpg\";\n\nconst formSchema = z.object({\n  password: z.string().min(6, { message: \"كلمة المرور يجب أن تكون 6 أحرف على الأقل\" }),\n  confirmPassword: z.string(),\n}).refine((data) => data.password === data.confirmPassword, {\n  message: \"كلمات المرور غير متطابقة\",\n  path: [\"confirmPassword\"],\n});\n\nexport default function ResetPassword() {\n  const [, setLocation] = useLocation();\n  const searchString = useSearch();\n  const params = new URLSearchParams(searchString);\n  const email = params.get(\"email\") || \"\";\n  const token = params.get(\"token\") || \"\";\n  \n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [showPassword, setShowPassword] = useState(false);\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\n  const [isSuccess, setIsSuccess] = useState(false);\n  const { toast } = useToast();\n\n  const form = useForm<z.infer<typeof formSchema>>({\n    resolver: zodResolver(formSchema),\n    defaultValues: {\n      password: \"\",\n      confirmPassword: \"\",\n    },\n  });\n\n  async function onSubmit(values: z.infer<typeof formSchema>) {\n    setIsSubmitting(true);\n    \n    try {\n      const response = await fetch(\"/api/auth/reset-password\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ \n          email, \n          token,\n          password: values.password \n        }),\n      });\n      \n      const data = await response.json();\n      \n      if (!response.ok) {\n        toast({\n          variant: \"destructive\",\n          title: \"خطأ\",\n          description: data.error || \"فشل إعادة تعيين كلمة المرور\",\n        });\n        return;\n      }\n      \n      setIsSuccess(true);\n      toast({\n        title: \"تم بنجاح\",\n        description: \"تم إعادة تعيين كلمة المرور بنجاح\",\n      });\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"خطأ\",\n        description: \"فشل الاتصال بالخادم\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  }\n\n  if (!email || !token) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-muted/30 p-4\" dir=\"rtl\">\n        <Card className=\"w-full max-w-md\">\n          <CardContent className=\"pt-6 text-center\">\n            <p className=\"text-muted-foreground mb-4\">رابط غير صالح أو منتهي الصلاحية</p>\n            <Link href=\"/forgot-password\">\n              <Button>طلب رابط جديد</Button>\n            </Link>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (isSuccess) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-muted/30 p-4\" dir=\"rtl\">\n        <Card className=\"w-full max-w-md border-none shadow-xl\">\n          <CardContent className=\"pt-8 pb-8 text-center space-y-6\">\n            <div className=\"w-20 h-20 mx-auto rounded-full bg-green-100 flex items-center justify-center\">\n              <CheckCircle className=\"w-10 h-10 text-green-600\" />\n            </div>\n            <div>\n              <h2 className=\"text-2xl font-bold text-foreground mb-2\">تم بنجاح!</h2>\n              <p className=\"text-muted-foreground\">تم إعادة تعيين كلمة المرور بنجاح</p>\n            </div>\n            <Link href=\"/\">\n              <Button className=\"w-full\" data-testid=\"button-login\">\n                تسجيل الدخول\n              </Button>\n            </Link>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-muted/30 p-4\" dir=\"rtl\">\n      <div className=\"w-full max-w-md space-y-8\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"flex justify-center\">\n            <div className=\"w-20 h-20 rounded-full overflow-hidden border-4 border-white shadow-lg\">\n              <img src={logoUrl} alt=\"Logo\" className=\"w-full h-full object-cover\" />\n            </div>\n          </div>\n          <h1 className=\"text-2xl font-bold tracking-tight font-display text-primary\">إعادة تعيين كلمة المرور</h1>\n          <p className=\"text-muted-foreground text-sm\">أدخل كلمة المرور الجديدة</p>\n        </div>\n\n        <Card className=\"border-none shadow-xl overflow-hidden\">\n          <div className=\"h-1 bg-primary w-full\" />\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Lock className=\"w-5 h-5\" />\n              كلمة مرور جديدة\n            </CardTitle>\n            <CardDescription>اختر كلمة مرور قوية لا تقل عن 6 أحرف</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                <FormField\n                  control={form.control}\n                  name=\"password\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>كلمة المرور الجديدة</FormLabel>\n                      <FormControl>\n                        <div className=\"relative\">\n                          <Input \n                            type={showPassword ? \"text\" : \"password\"} \n                            placeholder=\"••••••••\" \n                            {...field} \n                            className=\"bg-background/50 pl-10\" \n                            data-testid=\"input-password\" \n                          />\n                          <Button\n                            type=\"button\"\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            className=\"absolute left-1 top-0 h-full px-3 hover:bg-transparent\"\n                            onClick={() => setShowPassword(!showPassword)}\n                          >\n                            {showPassword ? <EyeOff className=\"w-4 h-4 text-muted-foreground\" /> : <Eye className=\"w-4 h-4 text-muted-foreground\" />}\n                          </Button>\n                        </div>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <FormField\n                  control={form.control}\n                  name=\"confirmPassword\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>تأكيد كلمة المرور</FormLabel>\n                      <FormControl>\n                        <div className=\"relative\">\n                          <Input \n                            type={showConfirmPassword ? \"text\" : \"password\"} \n                            placeholder=\"••••••••\" \n                            {...field} \n                            className=\"bg-background/50 pl-10\" \n                            data-testid=\"input-confirm-password\" \n                          />\n                          <Button\n                            type=\"button\"\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            className=\"absolute left-1 top-0 h-full px-3 hover:bg-transparent\"\n                            onClick={() => setShowConfirmPassword(!showConfirmPassword)}\n                          >\n                            {showConfirmPassword ? <EyeOff className=\"w-4 h-4 text-muted-foreground\" /> : <Eye className=\"w-4 h-4 text-muted-foreground\" />}\n                          </Button>\n                        </div>\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n                \n                <Button type=\"submit\" className=\"w-full\" disabled={isSubmitting} data-testid=\"button-reset\">\n                  {isSubmitting ? (\n                    <Loader2 className=\"w-4 h-4 animate-spin ml-2\" />\n                  ) : (\n                    <Lock className=\"w-4 h-4 ml-2\" />\n                  )}\n                  إعادة تعيين كلمة المرور\n                </Button>\n              </form>\n            </Form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":9046,"size_tokens":null},"client/src/pages/merchant/Reviews.tsx":{"content":"import DashboardLayout from \"@/components/layout/DashboardLayout\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Star, Loader2, Package, User, Calendar } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { format } from \"date-fns\";\nimport { ar } from \"date-fns/locale\";\n\ninterface Review {\n  id: number;\n  orderId: number;\n  customerId: number;\n  productId: number;\n  rating: number;\n  comment: string | null;\n  createdAt: string;\n  customer?: {\n    name: string;\n    mobile: string;\n  };\n  product?: {\n    name: string;\n    images: string[];\n  };\n}\n\nexport default function MerchantReviews() {\n  const { data: reviews = [], isLoading } = useQuery<Review[]>({\n    queryKey: [\"/api/merchant/reviews\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/merchant/reviews\", { credentials: \"include\" });\n      if (!res.ok) throw new Error(\"Failed to fetch reviews\");\n      return res.json();\n    }\n  });\n\n  const averageRating = reviews.length > 0\n    ? (reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length).toFixed(1)\n    : \"0\";\n\n  const ratingCounts = [5, 4, 3, 2, 1].map(rating => ({\n    rating,\n    count: reviews.filter(r => r.rating === rating).length,\n    percentage: reviews.length > 0 \n      ? Math.round((reviews.filter(r => r.rating === rating).length / reviews.length) * 100)\n      : 0\n  }));\n\n  const renderStars = (rating: number) => {\n    return (\n      <div className=\"flex gap-0.5\">\n        {[1, 2, 3, 4, 5].map((star) => (\n          <Star\n            key={star}\n            className={`w-4 h-4 ${star <= rating ? \"fill-yellow-400 text-yellow-400\" : \"text-gray-300\"}`}\n          />\n        ))}\n      </div>\n    );\n  };\n\n  if (isLoading) {\n    return (\n      <DashboardLayout role=\"merchant\">\n        <div className=\"flex items-center justify-center min-h-[60vh]\">\n          <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\n        </div>\n      </DashboardLayout>\n    );\n  }\n\n  return (\n    <DashboardLayout role=\"merchant\">\n      <div className=\"space-y-8\">\n        <div>\n          <h2 className=\"text-3xl font-bold tracking-tight font-display\">التقييمات</h2>\n          <p className=\"text-muted-foreground mt-2\">تقييمات العملاء على منتجاتك</p>\n        </div>\n\n        <div className=\"grid md:grid-cols-3 gap-6\">\n          <Card className=\"md:col-span-1\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Star className=\"w-5 h-5 fill-yellow-400 text-yellow-400\" />\n                ملخص التقييمات\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"text-center\">\n                <div className=\"text-5xl font-bold text-primary\">{averageRating}</div>\n                <div className=\"flex justify-center mt-2\">\n                  {renderStars(Math.round(parseFloat(averageRating)))}\n                </div>\n                <p className=\"text-muted-foreground mt-2\">{reviews.length} تقييم</p>\n              </div>\n\n              <div className=\"space-y-2\">\n                {ratingCounts.map(({ rating, count, percentage }) => (\n                  <div key={rating} className=\"flex items-center gap-2\">\n                    <span className=\"w-3 text-sm\">{rating}</span>\n                    <Star className=\"w-3 h-3 fill-yellow-400 text-yellow-400\" />\n                    <div className=\"flex-1 h-2 bg-muted rounded-full overflow-hidden\">\n                      <div \n                        className=\"h-full bg-yellow-400 rounded-full transition-all\"\n                        style={{ width: `${percentage}%` }}\n                      />\n                    </div>\n                    <span className=\"w-8 text-xs text-muted-foreground\">{count}</span>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"md:col-span-2\">\n            <CardHeader>\n              <CardTitle>جميع التقييمات</CardTitle>\n              <CardDescription>آراء العملاء حول منتجاتك</CardDescription>\n            </CardHeader>\n            <CardContent>\n              {reviews.length === 0 ? (\n                <div className=\"text-center py-12\">\n                  <Star className=\"w-16 h-16 mx-auto text-muted-foreground/30 mb-4\" />\n                  <h3 className=\"text-lg font-semibold mb-2\">لا توجد تقييمات بعد</h3>\n                  <p className=\"text-muted-foreground\">\n                    ستظهر تقييمات العملاء هنا عندما يقومون بتقييم منتجاتك\n                  </p>\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  {reviews.map((review) => (\n                    <div \n                      key={review.id} \n                      className=\"p-4 rounded-lg border bg-card hover:bg-muted/50 transition-colors\"\n                      data-testid={`review-card-${review.id}`}\n                    >\n                      <div className=\"flex items-start gap-4\">\n                        <Avatar className=\"w-10 h-10 border\">\n                          <AvatarFallback className=\"bg-primary/10 text-primary\">\n                            <User className=\"w-5 h-5\" />\n                          </AvatarFallback>\n                        </Avatar>\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center justify-between gap-2 mb-1\">\n                            <div className=\"flex items-center gap-2\">\n                              <span className=\"font-medium\">\n                                {review.customer?.name || \"عميل\"}\n                              </span>\n                              {renderStars(review.rating)}\n                            </div>\n                            <span className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                              <Calendar className=\"w-3 h-3\" />\n                              {format(new Date(review.createdAt), \"d MMM yyyy\", { locale: ar })}\n                            </span>\n                          </div>\n                          \n                          {review.product && (\n                            <div className=\"flex items-center gap-2 mb-2\">\n                              <Badge variant=\"outline\" className=\"gap-1 text-xs\">\n                                <Package className=\"w-3 h-3\" />\n                                {review.product.name}\n                              </Badge>\n                            </div>\n                          )}\n                          \n                          {review.comment && (\n                            <p className=\"text-sm text-muted-foreground\">\n                              {review.comment}\n                            </p>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </DashboardLayout>\n  );\n}\n","path":null,"size_bytes":7337,"size_tokens":null}},"version":2}